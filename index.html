<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MyHub ‚Äì Personal OS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#050816" />

  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0c1020;
      --bg-card: #11152a;
      --bg-card-soft: #181c35;
      --accent: #4f8dff;
      --accent-soft: rgba(79, 141, 255, 0.25);
      --accent-strong: #7bb0ff;
      --danger: #ff4d6a;
      --text: #f7f7ff;
      --text-soft: #b5b9d9;
      --border-subtle: #262a4a;
      --radius-card: 18px;
      --shadow-card: 0 18px 50px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #151b3d 0, #050816 55%);
      color: var(--text);
    }

    body {
      display: flex;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Layout */

    .app-shell {
      display: flex;
      width: 100%;
      height: 100vh;
      max-width: 1280px;
      margin: 0 auto;
    }

    .sidebar {
      width: 70px;
      background: linear-gradient(180deg, #050816 0, #050816 40%, #020510 100%);
      border-right: 1px solid rgba(255, 255, 255, 0.04);
      padding: 12px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      position: relative;
    }

    .sidebar-title {
      font-weight: 800;
      letter-spacing: 0.08em;
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .sidebar-section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: var(--text-soft);
      margin-top: 6px;
      margin-bottom: 2px;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 4px;
    }

    .nav-item {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: radial-gradient(circle at 30% 0, #202749 0, #080b18 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text);
      font-size: 22px;
      position: relative;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.55);
      transition:
        transform 0.18s ease,
        box-shadow 0.18s ease,
        border-color 0.18s ease,
        background 0.18s ease;
    }

    .nav-item::after {
      content: attr(data-label);
      position: absolute;
      left: 54px;
      white-space: nowrap;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(8, 10, 26, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.07);
      color: var(--text-soft);
      opacity: 0;
      pointer-events: none;
      transform: translateX(-4px);
      transition:
        opacity 0.18s ease,
        transform 0.18s ease;
      z-index: 10;
    }

    .nav-item:hover::after {
      opacity: 1;
      transform: translateX(0);
    }

    .nav-item:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.55);
      border-color: var(--accent-soft);
    }

    .nav-active {
      border-color: var(--accent);
      box-shadow:
        0 0 0 3px rgba(79, 141, 255, 0.25),
        0 12px 30px rgba(12, 22, 65, 0.9);
      background: radial-gradient(circle at 25% 0, #3354a8 0, #0b1638 55%);
    }

    .sidebar-bottom {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      font-size: 10px;
      color: var(--text-soft);
    }

    .version-pill {
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(8, 12, 32, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    /* Main content */

    .main {
      flex: 1;
      padding: 14px 16px 18px;
      overflow-y: auto;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .topbar-title {
      font-size: 18px;
      font-weight: 700;
    }

    .topbar-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .topbar-chip {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 9, 24, 0.9);
      padding: 7px 12px;
      font-size: 11px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .topbar-chip span {
      font-size: 14px;
    }

    /* Cards */

    .card {
      background: radial-gradient(circle at top left, #202747 0, #11152a 45%);
      border-radius: var(--radius-card);
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: var(--shadow-card);
      padding: 14px 14px 16px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      font-weight: 600;
    }

    .card-title-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #4f8dff 0, #1b2147 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .card-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge-soft {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(8, 10, 26, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--text-soft);
    }

    .icon-btn {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(9, 13, 32, 0.9);
      color: var(--text);
      padding: 6px;
      font-size: 15px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 30px;
      transition:
        background 0.16s ease,
        transform 0.16s ease,
        border-color 0.16s ease;
    }

    .icon-btn:hover {
      background: rgba(18, 24, 58, 0.95);
      transform: translateY(-1px);
      border-color: var(--accent-soft);
    }

    .icon-btn.danger {
      border-color: rgba(255, 77, 106, 0.6);
      color: #ffcfd9;
      background: rgba(61, 10, 21, 0.9);
    }

    .icon-btn.danger:hover {
      background: rgba(101, 18, 36, 0.95);
    }

    /* Inputs */

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .input {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 8, 23, 0.96);
      color: var(--text);
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
    }

    .input::placeholder {
      color: rgba(181, 185, 217, 0.6);
    }

    select.input {
      padding-right: 32px;
      appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, #6972b8 50%),
        linear-gradient(135deg, #6972b8 50%, transparent 50%);
      background-position:
        calc(100% - 14px) 52%,
        calc(100% - 9px) 52%;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #4f8dff, #7b9cff);
      color: white;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(24, 66, 153, 0.8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-width: 80px;
      transition:
        transform 0.16s ease,
        box-shadow 0.16s ease,
        filter 0.16s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(24, 66, 153, 0.95);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 6px 16px rgba(24, 66, 153, 0.8);
    }

    .align-right {
      margin-left: auto;
    }

    /* Lists */

    .item {
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(120deg, #11152a 0, #171b33 45%, #101425 100%);
      padding: 9px 9px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }

    .item-main {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 0;
    }

    .item-checkbox {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .item-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
      cursor: pointer;
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-width: 0;
    }

    .item-title {
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .item-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 11px;
    }

    .item-actions {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tag {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(10, 13, 34, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--text-soft);
    }

    .tag-income {
      border-color: rgba(53, 199, 119, 0.6);
      color: #d6ffe7;
      background: rgba(10, 49, 31, 0.92);
    }

    .tag-expense {
      border-color: rgba(255, 77, 106, 0.6);
      color: #ffd6de;
      background: rgba(61, 10, 21, 0.9);
    }

    .selected-account {
      box-shadow:
        0 0 0 2px rgba(79, 141, 255, 0.9),
        0 12px 34px rgba(12, 22, 65, 0.9);
    }

    .empty-msg {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }

    .mt-8 {
      margin-top: 8px;
    }

    .mt-12 {
      margin-top: 12px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      .app-shell {
        max-width: 100%;
      }

      .sidebar {
        width: 60px;
        padding-inline: 6px;
      }

      .main {
        padding-inline: 10px;
      }

      .card {
        padding-inline: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-title">MYHUB</div>

      <div class="sidebar-section-label">CORE</div>
      <div class="sidebar-nav">
        <div class="nav-item nav-active" data-page="home" data-label="Home">
          üè†
        </div>
        <div class="nav-item" data-page="todo" data-label="To-Do">
          ‚úÖ
        </div>
        <div class="nav-item" data-page="shopping" data-label="Shopping">
          üõí
        </div>
        <div class="nav-item" data-page="workouts" data-label="Workouts">
          üèãÔ∏è
        </div>
        <div class="nav-item" data-page="finance" data-label="Finances">
          üí∞
        </div>
      </div>

      <div class="sidebar-section-label">NEXT</div>
      <div class="sidebar-nav">
        <div class="nav-item" data-page="notes" data-label="Notes">
          üìù
        </div>
        <div class="nav-item" data-page="meals" data-label="Meals">
          üçΩÔ∏è
        </div>
        <div class="nav-item" data-page="calendar" data-label="Calendar">
          üìÖ
        </div>
        <div class="nav-item" data-page="analytics" data-label="Analytics">
          üìä
        </div>
      </div>

      <div class="sidebar-bottom">
        <div class="version-pill">
          v<span id="appVersion">0.5.1</span>
        </div>
        <div>Local only</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <div class="topbar-left">
          <div class="topbar-title" id="pageTitle">Home</div>
          <div class="topbar-sub">Your personal hub</div>
        </div>
        <div class="topbar-chip">
          <span>‚ö°</span> PWA ¬∑ Offline-first
        </div>
      </header>

      <!-- HOME PAGE -->
      <section class="page active" data-page="home">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìÜ</div>
                <span>Today</span>
              </div>
              <div class="card-subtitle">
                Quick entry to your main list.
              </div>
            </div>
          </div>

          <div class="mt-8">
            <div class="input-row">
              <input
                id="homeQuickTaskInput"
                class="input"
                placeholder="Quick task (goes to Personal list)‚Ä¶"
              />
              <button id="homeQuickTaskBtn" class="btn-primary">
                + Add
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- TO-DO PAGE -->
      <section class="page hidden" data-page="todo">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">‚úÖ</div>
                <span>To-Do</span>
              </div>
              <div class="card-subtitle">
                Multiple lists with priorities & dates.
              </div>
            </div>
            <div class="card-actions">
              <span class="badge-soft">v0.5.1</span>
            </div>
          </div>

          <!-- List selector & new list -->
          <div class="input-row">
            <select id="todoListSelect" class="input"></select>
          </div>
          <div class="input-row">
            <input
              id="todoListName"
              class="input"
              placeholder="New list name‚Ä¶"
            />
            <button id="todoNewListBtn" class="btn-primary">+ List</button>
          </div>

          <!-- Task input (stacked) -->
          <div class="input-row">
            <input
              id="todoTitleInput"
              class="input"
              placeholder="New task‚Ä¶"
            />
          </div>
          <div class="input-row">
            <select id="todoPrioritySelect" class="input">
              <option value="medium">Medium priority</option>
              <option value="high">High priority</option>
              <option value="low">Low priority</option>
            </select>
            <input
              id="todoDueDate"
              type="date"
              class="input"
            />
            <button id="addTodoBtn" class="btn-primary align-right">
              + Add
            </button>
          </div>

          <!-- Filters -->
          <div class="input-row">
            <input
              id="todoSearchInput"
              class="input"
              placeholder="Search tasks‚Ä¶"
            />
          </div>
          <div class="input-row">
            <select id="todoFilterPriority" class="input">
              <option value="all">All priorities</option>
              <option value="high">High only</option>
              <option value="medium">Medium only</option>
              <option value="low">Low only</option>
            </select>
            <select id="todoFilterStatus" class="input">
              <option value="all">All statuses</option>
              <option value="open">Open only</option>
              <option value="inprogress">In progress only</option>
              <option value="done">Done only</option>
            </select>
            <select id="todoFilterList" class="input">
              <option value="all">All lists</option>
            </select>
          </div>

          <div id="todoList" class="mt-8"></div>
          <div id="noTodosMsg" class="empty-msg">
            No tasks yet. Add your first one above.
          </div>
        </div>
      </section>

      <!-- SHOPPING PAGE -->
      <section class="page hidden" data-page="shopping">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üõí</div>
                <span>Shopping</span>
              </div>
              <div class="card-subtitle">
                Lists with notes & drag-and-drop.
              </div>
            </div>
            <div class="card-actions">
              <span class="badge-soft">Tap üìù on an item for notes</span>
            </div>
          </div>

          <div class="input-row">
            <select id="shoppingListSelect" class="input"></select>
          </div>
          <div class="input-row">
            <input
              id="shoppingItemInput"
              class="input"
              placeholder="New item‚Ä¶ (Enter to add)"
            />
          </div>
          <div class="input-row">
            <button id="addShoppingBtn" class="btn-primary align-right">
              + Add
            </button>
          </div>

          <div id="shoppingList" class="mt-8"></div>
          <div id="shoppingEmptyMsg" class="empty-msg">
            This list is empty. Add your first item above.
          </div>
        </div>
      </section>

      <!-- WORKOUTS PAGE -->
      <section class="page hidden" data-page="workouts">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üèãÔ∏è</div>
                <span>Workouts</span>
              </div>
              <div class="card-subtitle">
                Simple workout log (detailed table in a future version).
              </div>
            </div>
            <div class="card-actions">
              <span class="badge-soft">Log by day</span>
            </div>
          </div>

          <div class="input-row">
            <input
              id="workoutName"
              class="input"
              placeholder="Workout name (Push, Legs, Pull)‚Ä¶"
            />
          </div>
          <div class="input-row">
            <input
              id="workoutNotes"
              class="input"
              placeholder="Notes (optional)‚Ä¶"
            />
            <button id="addWorkoutBtn" class="btn-primary">
              + Add workout
            </button>
          </div>

          <div id="workoutList" class="mt-8"></div>
          <div id="noWorkoutMsg" class="empty-msg">
            No workouts logged yet.
          </div>
        </div>
      </section>

      <!-- FINANCE PAGE -->
      <section class="page hidden" data-page="finance">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üí∞</div>
                <span>Finances</span>
              </div>
              <div class="card-subtitle">
                Quick inputs now, analysis later.
              </div>
            </div>
            <div class="card-actions">
              <span class="badge-soft">v0.5.1</span>
            </div>
          </div>
        </div>

        <!-- New transaction card -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">‚û°Ô∏è</div>
                <span>New transaction</span>
              </div>
            </div>
          </div>

          <div class="input-row">
            <select id="financeAccount" class="input"></select>
          </div>
          <div class="input-row">
            <select id="financeType" class="input">
              <option value="expense">Expense (-)</option>
              <option value="income">Income (+)</option>
            </select>
            <input
              id="financeAmount"
              class="input"
              type="number"
              step="0.01"
              placeholder="Amount‚Ä¶"
            />
          </div>
          <div class="input-row">
            <input
              id="financeCategory"
              class="input"
              placeholder="Category (e.g. Food, Transport)‚Ä¶"
            />
            <input
              id="financeMethod"
              class="input"
              placeholder="Method (cash, card, scan)‚Ä¶"
            />
          </div>
          <div class="input-row">
            <input
              id="financeDate"
              class="input"
              type="date"
            />
            <input
              id="financeNote"
              class="input"
              placeholder="Note (optional)‚Ä¶"
            />
          </div>
          <div class="input-row">
            <button id="addFinanceBtn" class="btn-primary align-right">
              + Add
            </button>
          </div>
        </div>

        <!-- Accounts summary -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üè¶</div>
                <span>Accounts</span>
              </div>
            </div>
            <div class="card-actions">
              <button id="addAccountBtn" class="btn-primary">
                + Account
              </button>
            </div>
          </div>

          <div id="accountsList" class="mt-8"></div>
          <div id="noAccountsMsg" class="empty-msg">
            No accounts yet. Add one with the button above.
          </div>
        </div>

        <!-- Transactions -->
        <div class="card" style="margin-bottom:0">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìú</div>
                <span>Transactions (selected account)</span>
              </div>
            </div>
          </div>
          <div id="financeList" class="mt-8"></div>
          <div id="noFinanceMsg" class="empty-msg">
            No transactions for this account yet.
          </div>
        </div>
      </section>

      <!-- PLACEHOLDER PAGES -->
      <section class="page hidden" data-page="notes">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìù</div>
                <span>Notes</span>
              </div>
              <div class="card-subtitle">
                Text & sketch notes coming in a future version.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="page hidden" data-page="meals">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üçΩÔ∏è</div>
                <span>Meals</span>
              </div>
              <div class="card-subtitle">
                Placeholder for meal tracking & macros.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="page hidden" data-page="calendar">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìÖ</div>
                <span>Calendar</span>
              </div>
              <div class="card-subtitle">
                Future light calendar, linked to tasks & bills.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="page hidden" data-page="analytics">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìä</div>
                <span>Analytics</span>
              </div>
              <div class="card-subtitle">
                Future cross-analysis of tasks, expenses, workouts, etc.
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <script>
    // MyHub v0.5.1 ‚Äì single-file front-end logic

    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const STORAGE_KEY = "myhub-state-v04";

    function formatDate(iso) {
      if (!iso) return "No date";
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "No date";
      return d.toLocaleDateString();
    }

    function confirmDelete() {
      return confirm("Delete this item? This action cannot be undone.");
    }

    // ---------- State ----------
    const defaultState = {
      theme: "dark",
      currentPage: "home",
      // To-do
      todoLists: [
        { id: "list-personal", name: "Personal", createdAt: new Date().toISOString() }
      ],
      todos: [],
      // Shopping
      shoppingLists: [
        { id: "shop-main", name: "Main list", createdAt: new Date().toISOString() }
      ],
      shoppingItems: [],
      // Workouts
      workouts: [],
      // Finance
      accounts: [],
      finance: [],
      activeFinanceAccountId: null
    };

    let state;

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          state = structuredClone(defaultState);
          return;
        }
        const parsed = JSON.parse(raw);
        state = Object.assign(structuredClone(defaultState), parsed);
      } catch (e) {
        console.error("Error loading state", e);
        state = structuredClone(defaultState);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("Error saving state", e);
      }
    }

    // ---------- Navigation ----------
    function setPage(page) {
      state.currentPage = page;
      saveState();

      $$(".page").forEach((el) => {
        if (el.dataset.page === page) {
          el.classList.remove("hidden");
          el.classList.add("active");
        } else {
          el.classList.add("hidden");
          el.classList.remove("active");
        }
      });

      $$(".nav-item").forEach((el) => {
        if (el.dataset.page === page) {
          el.classList.add("nav-active");
        } else {
          el.classList.remove("nav-active");
        }
      });

      const headerTitle = $("pageTitle");
      if (headerTitle) {
        const mapping = {
          home: "Home",
          todo: "To-Do",
          shopping: "Shopping",
          workouts: "Workouts",
          finance: "Finances",
          notes: "Notes",
          meals: "Meals",
          calendar: "Calendar",
          analytics: "Analytics"
        };
        headerTitle.textContent = mapping[page] || "MyHub";
      }
    }

    function setupNav() {
      $$(".nav-item").forEach((btn) => {
        btn.addEventListener("click", () => {
          const page = btn.dataset.page;
          if (page) setPage(page);
        });
      });

      const homeQuick = $("homeQuickTaskBtn");
      if (homeQuick) {
        homeQuick.addEventListener("click", () => {
          const input = $("homeQuickTaskInput");
          if (!input) return;
          const text = input.value.trim();
          if (!text) return;
          addTodoFromHome(text);
          input.value = "";
        });
      }

      $("homeQuickTaskInput")?.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          const text = e.target.value.trim();
          if (!text) return;
          addTodoFromHome(text);
          e.target.value = "";
        }
      });
    }

    // ---------- To-do Lists ----------
    const todoListSelect = $("todoListSelect");
    const todoListNameInput = $("todoListName");
    const todoNewListBtn = $("todoNewListBtn");
    const todoTitleInput = $("todoTitleInput");
    const todoPrioritySelect = $("todoPrioritySelect");
    const todoDueDateInput = $("todoDueDate");
    const todoListContainer = $("todoList");
    const todoEmptyMsg = $("noTodosMsg");
    const todoSearchInput = $("todoSearchInput");
    const todoFilterPriority = $("todoFilterPriority");
    const todoFilterStatus = $("todoFilterStatus");
    const todoFilterList = $("todoFilterList");

    function getActiveTodoListId() {
      return todoListSelect?.value || (state.todoLists[0] && state.todoLists[0].id);
    }

    function renderTodoListOptions() {
      const selects = [todoListSelect, todoFilterList].filter(Boolean);
      selects.forEach((sel) => {
        sel.innerHTML = "";
        state.todoLists.forEach((list) => {
          const opt = document.createElement("option");
          opt.value = list.id;
          opt.textContent = list.name;
          sel.appendChild(opt);
        });
      });

      if (!state.todoLists.length) return;
      if (todoListSelect && !todoListSelect.value) {
        todoListSelect.value = state.todoLists[0].id;
      }
    }

    function addTodoList() {
      const name = todoListNameInput.value.trim();
      if (!name) return;
      const id = "list-" + Date.now();
      state.todoLists.push({ id, name, createdAt: new Date().toISOString() });
      saveState();
      todoListNameInput.value = "";
      renderTodoListOptions();
      if (todoListSelect) todoListSelect.value = id;
      renderTodos();
    }

    todoNewListBtn?.addEventListener("click", addTodoList);

    function addTodo() {
      const title = todoTitleInput.value.trim();
      if (!title) return;
      const listId = getActiveTodoListId();
      const priority = todoPrioritySelect.value || "medium";
      let dueIso = null;
      if (todoDueDateInput.value) {
        dueIso = new Date(todoDueDateInput.value + "T00:00:00").toISOString();
      }
      const todo = {
        id: "todo-" + Date.now(),
        listId,
        title,
        priority,
        dueDate: dueIso,
        status: "open",
        createdAt: new Date().toISOString(),
        completedAt: null
      };
      state.todos.unshift(todo);
      saveState();
      todoTitleInput.value = "";
      renderTodos();
    }

    todoTitleInput?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addTodo();
      }
    });
    $("addTodoBtn")?.addEventListener("click", addTodo);

    function updateTodoStatus(id, newStatus) {
      const t = state.todos.find((x) => x.id === id);
      if (!t) return;
      t.status = newStatus;
      t.completedAt = newStatus === "done" ? new Date().toISOString() : null;
      saveState();
      renderTodos();
    }

    function openEditTodo(todo) {
      const newTitle = prompt("Edit task title:", todo.title);
      if (newTitle === null) return;
      const trimmed = newTitle.trim();
      if (trimmed) todo.title = trimmed;

      const newDate = prompt(
        "Edit due date (YYYY-MM-DD) or leave blank:",
        todo.dueDate ? todo.dueDate.slice(0, 10) : ""
      );
      if (newDate !== null) {
        if (newDate.trim()) {
          todo.dueDate = new Date(newDate.trim() + "T00:00:00").toISOString();
        } else {
          todo.dueDate = null;
        }
      }
      saveState();
      renderTodos();
    }

    function deleteTodo(id) {
      if (!confirmDelete()) return;
      state.todos = state.todos.filter((t) => t.id !== id);
      saveState();
      renderTodos();
    }

    function applyTodoFilters(arr) {
      let result = [...arr];

      const q = (todoSearchInput?.value || "").trim().toLowerCase();
      if (q) {
        result = result.filter((t) => t.title.toLowerCase().includes(q));
      }

      const prio = todoFilterPriority?.value || "all";
      if (prio !== "all") {
        result = result.filter((t) => t.priority === prio);
      }

      const stat = todoFilterStatus?.value || "all";
      if (stat !== "all") {
        result = result.filter((t) => t.status === stat);
      }

      const listId = todoFilterList?.value || "all";
      if (listId !== "all") {
        result = result.filter((t) => t.listId === listId);
      }

      result.sort((a, b) => {
        const prioOrder = { high: 0, medium: 1, low: 2 };
        const pa = prioOrder[a.priority] ?? 1;
        const pb = prioOrder[b.priority] ?? 1;
        if (pa !== pb) return pa - pb;

        const da = a.dueDate ? new Date(a.dueDate).getTime() : Infinity;
        const db = b.dueDate ? new Date(b.dueDate).getTime() : Infinity;
        if (da !== db) return da - db;

        const statusOrder = { open: 0, inprogress: 1, done: 2 };
        return (statusOrder[a.status] ?? 0) - (statusOrder[b.status] ?? 0);
      });

      return result;
    }

    function renderTodos() {
      if (!todoListContainer) return;
      const all = state.todos;
      const filtered = applyTodoFilters(all);

      if (!filtered.length) {
        todoListContainer.innerHTML = "";
        if (todoEmptyMsg) todoEmptyMsg.style.display = "block";
        return;
      }
      if (todoEmptyMsg) todoEmptyMsg.style.display = "none";

      todoListContainer.innerHTML = "";
      filtered.forEach((t) => {
        const row = document.createElement("div");
        row.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const left = document.createElement("div");
        left.className = "item-checkbox";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = t.status === "done";
        cb.addEventListener("change", () => {
          updateTodoStatus(t.id, cb.checked ? "done" : "open");
        });
        left.appendChild(cb);

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = t.title;
        if (t.status === "done") {
          title.style.textDecoration = "line-through";
          title.style.opacity = "0.7";
        }
        title.addEventListener("click", () => openEditTodo(t));

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const prioTag = document.createElement("span");
        prioTag.className = "tag";
        prioTag.textContent =
          t.priority === "high"
            ? "High"
            : t.priority === "low"
            ? "Low"
            : "Medium";
        meta.appendChild(prioTag);

        if (t.dueDate) {
          const due = document.createElement("span");
          due.className = "tag";
          due.textContent = "Due " + formatDate(t.dueDate);
          meta.appendChild(due);
        }

        const listRef = state.todoLists.find((l) => l.id === t.listId);
        if (listRef) {
          const listTag = document.createElement("span");
          listTag.className = "tag";
          listTag.textContent = listRef.name;
          meta.appendChild(listTag);
        }

        if (t.status === "inprogress") {
          const st = document.createElement("span");
          st.className = "tag";
          st.textContent = "In progress";
          meta.appendChild(st);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);

        main.appendChild(left);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const inProgBtn = document.createElement("button");
        inProgBtn.className = "icon-btn";
        inProgBtn.textContent = "‚è≥";
        inProgBtn.title = "Mark in progress";
        inProgBtn.addEventListener("click", () =>
          updateTodoStatus(t.id, "inprogress")
        );

        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit";
        editBtn.addEventListener("click", () => openEditTodo(t));

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () => deleteTodo(t.id));

        actions.appendChild(inProgBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(actions);

        todoListContainer.appendChild(row);
      });
    }

    todoListSelect?.addEventListener("change", () => renderTodos());
    todoSearchInput?.addEventListener("input", renderTodos);
    todoFilterPriority?.addEventListener("change", renderTodos);
    todoFilterStatus?.addEventListener("change", renderTodos);
    todoFilterList?.addEventListener("change", renderTodos);

    function addTodoFromHome(text) {
      const listId = state.todoLists[0]?.id;
      if (!listId) return;
      const todo = {
        id: "todo-" + Date.now(),
        listId,
        title: text,
        priority: "medium",
        dueDate: null,
        status: "open",
        createdAt: new Date().toISOString(),
        completedAt: null
      };
      state.todos.unshift(todo);
      saveState();
      renderTodos();
    }

    // ---------- Shopping ----------
    const shoppingListSelect = $("shoppingListSelect");
    const shoppingListNameInput = $("shoppingListName"); // currently unused
    const shoppingNewListBtn = $("shoppingNewListBtn"); // currently unused
    const shoppingItemInput = $("shoppingItemInput");
    const shoppingListEl = $("shoppingList");
    const shoppingEmptyMsg = $("shoppingEmptyMsg");
    let draggingShoppingId = null;

    function getActiveShoppingListId() {
      return shoppingListSelect?.value || (state.shoppingLists[0] && state.shoppingLists[0].id);
    }

    function renderShoppingListOptions() {
      if (!shoppingListSelect) return;
      shoppingListSelect.innerHTML = "";
      state.shoppingLists.forEach((list) => {
        const opt = document.createElement("option");
        opt.value = list.id;
        opt.textContent = list.name;
        shoppingListSelect.appendChild(opt);
      });
      if (!state.shoppingLists.length) return;
      if (!shoppingListSelect.value) {
        shoppingListSelect.value = state.shoppingLists[0].id;
      }
    }

    function addShoppingItem() {
      const title = shoppingItemInput.value.trim();
      if (!title) return;
      const listId = getActiveShoppingListId();
      const item = {
        id: "shop-item-" + Date.now(),
        listId,
        title,
        checked: false,
        note: "",
        createdAt: new Date().toISOString()
      };
      state.shoppingItems.push(item);
      saveState();
      shoppingItemInput.value = "";
      renderShopping();
    }

    shoppingItemInput?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addShoppingItem();
      }
    });
    $("addShoppingBtn")?.addEventListener("click", addShoppingItem);

    function deleteShoppingItem(listId, itemId) {
      if (!confirmDelete()) return;
      state.shoppingItems = state.shoppingItems.filter(
        (i) => i.id !== itemId
      );
      saveState();
      renderShopping();
    }

    function toggleShoppingItem(id) {
      const item = state.shoppingItems.find((i) => i.id === id);
      if (!item) return;
      item.checked = !item.checked;
      saveState();
      renderShopping();
    }

    function openModalShoppingNote(item, listId) {
      const newNote = prompt("Note for this item:", item.note || "");
      if (newNote === null) return;
      item.note = newNote.trim();
      saveState();
      renderShopping();
    }

    function reorderShopping(listId, fromId, toId) {
      if (!fromId || !toId || fromId === toId) return;
      const arr = state.shoppingItems;
      const fromIdx = arr.findIndex(
        (i) => i.id === fromId && i.listId === listId
      );
      const toIdx = arr.findIndex(
        (i) => i.id === toId && i.listId === listId
      );
      if (fromIdx === -1 || toIdx === -1) return;
      const [moved] = arr.splice(fromIdx, 1);
      arr.splice(toIdx, 0, moved);
      saveState();
      renderShopping();
    }

    function renderShopping() {
      if (!shoppingListEl) return;
      const listId = getActiveShoppingListId();
      const items = state.shoppingItems.filter((i) => i.listId === listId);

      if (!items.length) {
        shoppingListEl.innerHTML = "";
        if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "block";
        return;
      }
      if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "none";

      shoppingListEl.innerHTML = "";
      items.forEach((item) => {
        const row = document.createElement("div");
        row.className = "item";
        row.dataset.itemId = item.id;
        row.draggable = true;

        row.addEventListener("dragstart", () => {
          draggingShoppingId = item.id;
        });
        row.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        row.addEventListener("drop", (e) => {
          e.preventDefault();
          const targetId = row.dataset.itemId;
          reorderShopping(listId, draggingShoppingId, targetId);
          draggingShoppingId = null;
        });

        const main = document.createElement("div");
        main.className = "item-main";

        const left = document.createElement("div");
        left.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.checked;
        cb.addEventListener("change", () => toggleShoppingItem(item.id));
        left.appendChild(cb);

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = item.title;
        if (item.checked) {
          title.style.textDecoration = "line-through";
          title.style.opacity = "0.7";
        }

        const meta = document.createElement("div");
        meta.className = "item-meta";
        if (item.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Note";
          meta.appendChild(noteTag);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);

        main.appendChild(left);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const noteBtn = document.createElement("button");
        noteBtn.className = "icon-btn";
        noteBtn.textContent = "üìù";
        noteBtn.title = "Add / edit note";
        noteBtn.addEventListener("click", () =>
          openModalShoppingNote(item, listId)
        );

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete item";
        delBtn.addEventListener("click", () =>
          deleteShoppingItem(listId, item.id)
        );

        actions.appendChild(noteBtn);
        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(actions);

        shoppingListEl.appendChild(row);
      });
    }

    shoppingListSelect?.addEventListener("change", renderShopping);

    // ---------- Workouts ----------
    const workoutListEl = $("workoutList");
    const noWorkoutMsg = $("noWorkoutMsg");

    function addWorkout() {
      const name = $("workoutName")?.value.trim();
      const notes = $("workoutNotes")?.value.trim();
      if (!name) return;
      const w = {
        id: "w-" + Date.now(),
        name,
        notes,
        date: new Date().toISOString()
      };
      state.workouts.unshift(w);
      $("workoutName").value = "";
      $("workoutNotes").value = "";
      saveState();
      renderWorkouts();
    }

    $("addWorkoutBtn")?.addEventListener("click", addWorkout);
    $("workoutName")?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addWorkout();
      }
    });

    function deleteWorkout(id) {
      if (!confirmDelete()) return;
      state.workouts = state.workouts.filter((w) => w.id !== id);
      saveState();
      renderWorkouts();
    }

    function renderWorkouts() {
      if (!workoutListEl) return;
      if (!state.workouts.length) {
        workoutListEl.innerHTML = "";
        if (noWorkoutMsg) noWorkoutMsg.style.display = "block";
        return;
      }
      if (noWorkoutMsg) noWorkoutMsg.style.display = "none";

      workoutListEl.innerHTML = "";
      state.workouts.forEach((w) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = w.name;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const d = document.createElement("span");
        d.className = "tag";
        d.textContent = formatDate(w.date);
        meta.appendChild(d);

        if (w.notes) {
          const n = document.createElement("span");
          n.className = "tag";
          n.textContent = "Notes";
          meta.appendChild(n);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete workout";
        delBtn.addEventListener("click", () => deleteWorkout(w.id));

        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        workoutListEl.appendChild(item);
      });
    }

    // ---------- Finance ----------
    const accountsListEl = $("accountsList");
    const noAccountsMsg = $("noAccountsMsg");
    const financeListEl = $("financeList");
    const noFinanceMsg = $("noFinanceMsg");
    const financeAccountSelect = $("financeAccount");

    function renderAccounts() {
      if (!accountsListEl || !financeAccountSelect) return;

      const accounts = state.accounts;
      accountsListEl.innerHTML = "";
      financeAccountSelect.innerHTML = "";

      if (!accounts.length) {
        if (noAccountsMsg) noAccountsMsg.style.display = "block";
        state.activeFinanceAccountId = null;
      } else {
        if (noAccountsMsg) noAccountsMsg.style.display = "none";
        if (!state.activeFinanceAccountId) {
          state.activeFinanceAccountId = accounts[0].id;
        }
      }

      accounts.forEach((acc) => {
        const balance = state.finance
          .filter((tx) => tx.accountId === acc.id)
          .reduce((sum, tx) => {
            return sum + (tx.type === "income" ? tx.amount : -tx.amount);
          }, 0);

        const row = document.createElement("div");
        row.className = "item";
        if (state.activeFinanceAccountId === acc.id) {
          row.classList.add("selected-account");
        }

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = acc.name;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const balTag = document.createElement("span");
        balTag.className = "tag";
        balTag.textContent = `Balance: ${balance.toFixed(2)}`;
        meta.appendChild(balTag);

        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete account";
        delBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteAccount(acc.id);
        });

        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(actions);

        row.addEventListener("click", () => {
          state.activeFinanceAccountId = acc.id;
          saveState();
          renderAccounts();
          renderFinance();
        });

        accountsListEl.appendChild(row);

        const opt = document.createElement("option");
        opt.value = acc.id;
        opt.textContent = acc.name;
        financeAccountSelect.appendChild(opt);
      });

      if (accounts.length) {
        financeAccountSelect.value =
          state.activeFinanceAccountId || accounts[0].id;
      }
    }

    function addAccount() {
      const name = prompt("Account name (e.g. THB main, BRL savings):");
      if (!name) return;
      const acc = {
        id: "acc-" + Date.now(),
        name: name.trim()
      };
      state.accounts.push(acc);
      saveState();
      renderAccounts();
    }

    $("addAccountBtn")?.addEventListener("click", addAccount);

    function deleteAccount(id) {
      const used = state.finance.some((tx) => tx.accountId === id);
      if (used) {
        alert("This account has transactions and can't be deleted yet.");
        return;
      }
      if (!confirmDelete()) return;
      state.accounts = state.accounts.filter((a) => a.id !== id);
      if (state.activeFinanceAccountId === id) {
        state.activeFinanceAccountId =
          state.accounts[0]?.id || null;
      }
      saveState();
      renderAccounts();
      renderFinance();
    }

    function addFinance() {
      const type = $("financeType")?.value || "expense";
      const amountVal = $("financeAmount")?.value;
      const amount = parseFloat(amountVal);
      if (!amount || Number.isNaN(amount)) return;

      const accountId =
        $("financeAccount")?.value ||
        state.activeFinanceAccountId ||
        (state.accounts[0] && state.accounts[0].id);

      if (!accountId) {
        alert("Please create an account first.");
        return;
      }

      const category = $("financeCategory")?.value.trim() || "";
      const method = $("financeMethod")?.value.trim() || "";

      let dateIso;
      const dateStr = $("financeDate")?.value;
      if (!dateStr) {
        dateIso = new Date().toISOString();
      } else {
        dateIso = new Date(dateStr + "T00:00:00").toISOString();
      }

      const note = $("financeNote")?.value.trim() || "";

      const tx = {
        id: "tx-" + Date.now(),
        type,
        amount,
        accountId,
        category,
        method,
        date: dateIso,
        note
      };

      state.finance.unshift(tx);

      $("financeAmount").value = "";
      $("financeCategory").value = "";
      $("financeMethod").value = "";
      $("financeDate").value = "";
      $("financeNote").value = "";

      saveState();
      renderAccounts();
      renderFinance();
    }

    $("addFinanceBtn")?.addEventListener("click", addFinance);
    $("financeAmount")?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addFinance();
      }
    });

    financeAccountSelect?.addEventListener("change", () => {
      state.activeFinanceAccountId = financeAccountSelect.value;
      saveState();
      renderAccounts();
      renderFinance();
    });

    function deleteFinance(id) {
      if (!confirmDelete()) return;
      state.finance = state.finance.filter((tx) => tx.id !== id);
      saveState();
      renderAccounts();
      renderFinance();
    }

    function renderFinance() {
      if (!financeListEl) return;

      let txs = state.finance;
      if (state.activeFinanceAccountId) {
        txs = txs.filter(
          (tx) => tx.accountId === state.activeFinanceAccountId
        );
      }

      if (!txs.length) {
        financeListEl.innerHTML = "";
        if (noFinanceMsg) noFinanceMsg.style.display = "block";
        return;
      }
      if (noFinanceMsg) noFinanceMsg.style.display = "none";

      const accountMap = {};
      state.accounts.forEach((a) => {
        accountMap[a.id] = a.name;
      });

      financeListEl.innerHTML = "";

      txs.forEach((tx) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        const sign = tx.type === "income" ? "+" : "-";
        title.textContent = `${sign}${tx.amount.toFixed(2)} (${tx.category || "No category"})`;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const typeTag = document.createElement("span");
        typeTag.className =
          "tag " + (tx.type === "income" ? "tag-income" : "tag-expense");
        typeTag.textContent = tx.type === "income" ? "Income" : "Expense";
        meta.appendChild(typeTag);

        const accTag = document.createElement("span");
        accTag.className = "tag";
        accTag.textContent = accountMap[tx.accountId] || "Unknown account";
        meta.appendChild(accTag);

        const methodTag = document.createElement("span");
        methodTag.className = "tag";
        methodTag.textContent = tx.method || "Method ?";
        meta.appendChild(methodTag);

        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = formatDate(tx.date);
        meta.appendChild(dateTag);

        if (tx.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Note";
          meta.appendChild(noteTag);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete transaction";
        delBtn.addEventListener("click", () => deleteFinance(tx.id));

        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        financeListEl.appendChild(item);
      });
    }

    // ---------- Init ----------
    function init() {
      loadState();

      const verEl = $("appVersion");
      if (verEl) verEl.textContent = "0.5.1";

      setupNav();

      renderTodoListOptions();
      renderTodos();

      renderShoppingListOptions();
      renderShopping();

      renderWorkouts();
      renderAccounts();
      renderFinance();

      setPage(state.currentPage || "home");
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
