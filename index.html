<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MyHub v0.4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0b1020;
      --bg-alt: #141a2a;
      --card: #1a2135;
      --accent: #4f9cff;
      --accent-soft: rgba(79, 156, 255, 0.15);
      --text: #f5f7ff;
      --text-soft: #b5bddb;
      --danger: #ff4f6a;
      --success: #4fe39c;
      --border: #252c42;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      background: radial-gradient(circle at top left, #20284a 0, #050713 45%, #02030a 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
    }

    /* Layout */

    .app {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    .sidebar {
      background: rgba(6, 10, 30, 0.96);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 0.75rem 0.4rem;
      transition: width 0.2s ease;
      width: 60px;
      position: sticky;
      top: 0;
      height: 100vh;
      z-index: 10;
    }

    .sidebar.expanded {
      width: 190px;
    }

    .sidebar-header {
      display: flex;
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    #sidebarToggle {
      background: transparent;
      border: none;
      color: var(--text-soft);
      font-size: 1.1rem;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 999px;
      transition: background 0.15s;
    }

    #sidebarToggle:hover {
      background: rgba(255,255,255,0.06);
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.25rem;
    }

    .nav-section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-soft);
      margin: 0.4rem 0.2rem 0.15rem;
      opacity: 0.8;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.5rem;
      border-radius: 999px;
      border: none;
      width: 100%;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.15s, color 0.15s, transform 0.05s;
      position: relative;
    }

    .nav-item span.label {
      opacity: 0;
      white-space: nowrap;
      transition: opacity 0.15s;
      font-size: 0.8rem;
    }

    .sidebar.expanded .nav-item span.label {
      opacity: 1;
    }

    .nav-item .icon {
      font-size: 1.1rem;
      width: 1.6rem;
      text-align: center;
    }

    .nav-item.active {
      background: linear-gradient(90deg, #4f9cff33, #4fe39c33);
      color: var(--text);
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.04);
      color: #ffffff;
    }

    .nav-item:active {
      transform: scale(0.97);
    }

    main {
      flex: 1;
      padding: 0.75rem;
      min-height: 100vh;
    }

    .page {
      display: none;
      max-width: 980px;
      margin: 0 auto;
    }

    .page.active {
      display: block;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.8rem;
    }

    .page-header h1 {
      font-size: 1.15rem;
      font-weight: 600;
    }

    .page-header small {
      color: var(--text-soft);
      font-size: 0.8rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin: 0.5rem 0 0.75rem;
    }

    .chip {
      border-radius: 999px;
      padding: 0.2rem 0.7rem;
      border: 1px solid var(--border);
      background: rgba(10, 14, 35, 0.92);
      color: var(--text-soft);
      font-size: 0.75rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .chip.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--text);
    }

    .chip .small-btn {
      font-size: 0.7rem;
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
    }

    /* Cards / containers */

    .card {
      background: rgba(9, 13, 32, 0.96);
      border-radius: 1rem;
      padding: 0.75rem 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.03);
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.6);
      margin-bottom: 0.8rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .card-header h2 {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .card-header small {
      color: var(--text-soft);
      font-size: 0.75rem;
    }

    .row {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .row > * {
      flex: 1;
      min-width: 0;
    }

    label {
      font-size: 0.75rem;
      color: var(--text-soft);
      display: block;
      margin-bottom: 0.15rem;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 0.35rem 0.45rem;
      border-radius: 0.6rem;
      border: 1px solid var(--border);
      background: #050713;
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6d7591;
    }

    button.primary {
      background: linear-gradient(135deg, #4f9cff, #4fe39c);
      border: none;
      color: #050713;
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    button.primary:active {
      transform: scale(0.97);
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      color: var(--text-soft);
      padding: 0.4rem 0.7rem;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
    }

    button.secondary:active {
      transform: scale(0.97);
    }

    .muted {
      color: var(--text-soft);
      font-size: 0.78rem;
    }

    /* Lists */

    .list {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .item {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.4rem;
      padding: 0.4rem 0.5rem;
      border-radius: 0.7rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
      font-size: 0.8rem;
    }

    .item-main {
      display: flex;
      gap: 0.4rem;
      align-items: flex-start;
      flex: 1;
      min-width: 0;
    }

    .item-main input[type="checkbox"] {
      margin-top: 0.2rem;
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      word-break: break-word;
    }

    .item-title.done {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .item-meta {
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .pill {
      border-radius: 999px;
      padding: 0.05rem 0.5rem;
      font-size: 0.68rem;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.3);
    }

    .pill-high {
      border-color: #ff9b5f;
      color: #ffcfaa;
    }

    .pill-medium {
      border-color: #4f9cff;
      color: #b6d4ff;
    }

    .pill-low {
      border-color: #4fe39c;
      color: #b6f4d2;
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .icon-btn {
      border: none;
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-soft);
      border-radius: 999px;
      width: 1.6rem;
      height: 1.6rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .icon-btn.danger {
      background: rgba(255, 79, 106, 0.08);
      color: #ff9fb0;
    }

    .icon-btn:active {
      transform: scale(0.95);
    }

    /* Simple two-column layout for some pages */

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 0.75rem;
    }

    @media (max-width: 800px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
      }
      main {
        margin-left: 60px;
      }
      .sidebar.expanded + main {
        margin-left: 190px;
      }
    }

    /* Modal */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: #070a16;
      border-radius: 0.9rem;
      padding: 0.8rem;
      border: 1px solid var(--border);
      max-width: 380px;
      width: 100%;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .modal-header h3 {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.6rem;
    }

    /* Small tags */

    .tag {
      font-size: 0.7rem;
      padding: 0.05rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--text-soft);
      background: rgba(255, 255, 255, 0.02);
    }

    .tag-income {
      border-color: var(--success);
      color: #a7f5cf;
    }

    .tag-expense {
      border-color: var(--danger);
      color: #ffc6d1;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button id="sidebarToggle" title="Toggle sidebar">‚ò∞</button>
      </div>
      <nav class="nav">
        <button class="nav-item active" data-page="home">
          <span class="icon">üè†</span>
          <span class="label">Home</span>
        </button>
        <div class="nav-section-label">Core</div>
        <button class="nav-item" data-page="todo">
          <span class="icon">üìù</span>
          <span class="label">To-do</span>
        </button>
        <button class="nav-item" data-page="shopping">
          <span class="icon">üõí</span>
          <span class="label">Shopping</span>
        </button>
        <button class="nav-item" data-page="workouts">
          <span class="icon">üèãÔ∏è</span>
          <span class="label">Workouts</span>
        </button>
        <button class="nav-item" data-page="finance">
          <span class="icon">üí∞</span>
          <span class="label">Finance</span>
        </button>

        <div class="nav-section-label">Next</div>
        <button class="nav-item" data-page="notes">
          <span class="icon">üóí</span>
          <span class="label">Notes</span>
        </button>
        <button class="nav-item" data-page="meals">
          <span class="icon">üçΩ</span>
          <span class="label">Meal Tracker</span>
        </button>
        <button class="nav-item" data-page="calendar">
          <span class="icon">üìÖ</span>
          <span class="label">Calendar</span>
        </button>
        <button class="nav-item" data-page="analytics">
          <span class="icon">üìä</span>
          <span class="label">Analytics</span>
        </button>
        <button class="nav-item" data-page="settings">
          <span class="icon">‚öôÔ∏è</span>
          <span class="label">Settings</span>
        </button>
      </nav>
    </aside>

    <main>
      <!-- HOME -->
      <section class="page active" id="page-home">
        <div class="page-header">
          <h1>MyHub Overview</h1>
          <small>v0.4 ‚Äì prototype build</small>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Today</h2>
              <small>Quick glance</small>
            </div>
            <p class="muted">
              This dashboard will later show your key info: today's tasks, today's
              expenses, and last workout. For now, use the sidebar to navigate.
            </p>
          </div>
          <div class="card">
            <div class="card-header">
              <h2>Sections</h2>
            </div>
            <p class="muted" style="margin-bottom:0.4rem;">
              Available now:
            </p>
            <ul class="muted" style="font-size:0.8rem; margin-left:1rem;">
              <li>To-do lists with priorities and due dates</li>
              <li>Shopping lists with notes</li>
              <li>Simple workouts log</li>
              <li>Finance tracking with accounts</li>
            </ul>
            <p class="muted" style="margin-top:0.4rem;">
              Coming soon: Notes, Meal tracker, Calendar, and Analytics pages.
            </p>
          </div>
        </div>
      </section>

      <!-- TODO -->
      <section class="page" id="page-todo">
        <div class="page-header">
          <h1>To-do</h1>
          <small>Lists, priorities, due dates</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Lists</h2>
            <div>
              <button class="secondary" id="addTodoListBtn">+ New list</button>
            </div>
          </div>
          <div class="chips" id="todoListsContainer">
            <!-- todo lists chips -->
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add task</h2>
          </div>
          <div class="row">
            <div>
              <label for="todoText">Task</label>
              <input type="text" id="todoText" placeholder="Example: Buy chicken, plan lesson, call mom..." />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="todoPriority">Priority</label>
              <select id="todoPriority">
                <option value="high">High</option>
                <option value="medium" selected>Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div>
              <label for="todoDueDate">Due date</label>
              <input type="date" id="todoDueDate" />
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addTodoBtn">+ Add task</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Tasks</h2>
          </div>
          <div class="list" id="todoList">
            <!-- todo items -->
          </div>
          <p class="muted" id="noTodoMsg" style="margin-top:0.3rem; display:none;">
            No tasks yet. Add one above.
          </p>
        </div>
      </section>

      <!-- SHOPPING -->
      <section class="page" id="page-shopping">
        <div class="page-header">
          <h1>Shopping</h1>
          <small>Multiple lists + notes per item</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Lists</h2>
            <button class="secondary" id="addShoppingListBtn">+ New list</button>
          </div>
          <div class="chips" id="shoppingListsContainer"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add item</h2>
          </div>
          <div class="row">
            <div>
              <label for="shoppingText">Item</label>
              <input type="text" id="shoppingText" placeholder="Example: chicken breast, yogurt, creatine..." />
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addShoppingBtn">+ Add item</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Items</h2>
          </div>
          <div class="list" id="shoppingList"></div>
          <p class="muted" id="noShoppingMsg" style="margin-top:0.3rem; display:none;">
            No items yet. Add one above.
          </p>
        </div>
      </section>

      <!-- WORKOUTS (simple for now) -->
      <section class="page" id="page-workouts">
        <div class="page-header">
          <h1>Workouts</h1>
          <small>Simple log (big revamp coming next)</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add workout</h2>
          </div>
          <div class="row">
            <div>
              <label for="workoutName">Workout name</label>
              <input type="text" id="workoutName" placeholder="Example: Train A ‚Äì Chest & Triceps" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="workoutNotes">Notes (optional)</label>
              <textarea id="workoutNotes" placeholder="Short notes about this session..."></textarea>
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addWorkoutBtn">+ Add workout</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>History</h2>
          </div>
          <div class="list" id="workoutList"></div>
          <p class="muted" id="noWorkoutMsg" style="margin-top:0.3rem; display:none;">
            No workouts logged yet.
          </p>
        </div>
      </section>

      <!-- FINANCE -->
      <section class="page" id="page-finance">
        <div class="page-header">
          <h1>Finance</h1>
          <small>Transactions + accounts</small>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Add transaction</h2>
            </div>
            <div class="row">
              <div>
                <label for="financeType">Type</label>
                <select id="financeType">
                  <option value="expense">Expense</option>
                  <option value="income">Income</option>
                </select>
              </div>
              <div>
                <label for="financeAmount">Amount</label>
                <input type="number" step="0.01" id="financeAmount" placeholder="0.00" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeAccount">Account</label>
                <select id="financeAccount"></select>
              </div>
              <div>
                <label for="financeCategory">Category</label>
                <input type="text" id="financeCategory" placeholder="Food, Transport, Gym..." />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeMethod">Method</label>
                <input type="text" id="financeMethod" placeholder="Cash, card, scan..." />
              </div>
              <div>
                <label for="financeDate">Date</label>
                <input type="date" id="financeDate" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeNote">Note (optional)</label>
                <input type="text" id="financeNote" placeholder="Short note..." />
              </div>
            </div>
            <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
              <button class="primary" id="addFinanceBtn">+ Add</button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Accounts</h2>
              <button class="secondary" id="addAccountBtn">+ Account</button>
            </div>
            <div class="list" id="accountsList"></div>
            <p class="muted" id="noAccountsMsg" style="margin-top:0.3rem; display:none;">
              No accounts yet. Add one above (e.g. "Main THB", "BRL savings", "USD card").
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Transactions</h2>
          </div>
          <div class="list" id="financeList"></div>
          <p class="muted" id="noFinanceMsg" style="margin-top:0.3rem; display:none;">
            No transactions yet.
          </p>
        </div>
      </section>

      <!-- NOTES placeholder -->
      <section class="page" id="page-notes">
        <div class="page-header">
          <h1>Notes</h1>
          <small>Quick notes & freehand ideas (coming soon)</small>
        </div>
        <div class="card">
          <p class="muted">
            This page will become your quick notepad: fast text notes and later a
            freehand/drawing mode. For now it's a placeholder so the structure is ready.
          </p>
        </div>
      </section>

      <!-- MEALS placeholder -->
      <section class="page" id="page-meals">
        <div class="page-header">
          <h1>Meal Tracker</h1>
          <small>Macros and food logs (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            In future versions, this page will let you log your meals and calculate macros.
            It might even support reading from images. For now, it's just a stub.
          </p>
        </div>
      </section>

      <!-- CALENDAR placeholder -->
      <section class="page" id="page-calendar">
        <div class="page-header">
          <h1>Calendar</h1>
          <small>Important days & recurring bills (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            The idea: show only what's important for you ‚Äì tasks, recurring bills, and key
            reminders ‚Äì instead of every small birthday. We'll connect this to To-do and Finance later.
          </p>
        </div>
      </section>

      <!-- ANALYTICS placeholder -->
      <section class="page" id="page-analytics">
        <div class="page-header">
          <h1>Analytics</h1>
          <small>Crossing all your data (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            Here you'll eventually see things like: expenses vs weight, shopping vs workout
            frequency, and other KPIs. For now this is a placeholder so the navigation feels complete.
          </p>
        </div>
      </section>

      <!-- SETTINGS placeholder -->
      <section class="page" id="page-settings">
        <div class="page-header">
          <h1>Settings</h1>
          <small>Theme, backup & more (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            In the future this page will hold dark mode toggle, data export/import,
            and backup options. For now, it's a simple stub.
          </p>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal for editing todo and shopping notes -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="modal">
      <div class="modal-header">
        <h3 id="modalTitle">Edit</h3>
        <button class="icon-btn" id="modalCloseBtn">‚úï</button>
      </div>
      <div id="modalBody"></div>
      <div class="modal-actions">
        <button class="secondary" id="modalCancelBtn">Cancel</button>
        <button class="primary" id="modalSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Simple state
    const STORAGE_KEY = "myhub_v0_4";

    function defaultState() {
      return {
        currentPage: "home",
        todoLists: ["General"],
        currentTodoList: "General",
        todos: [],
        shoppingLists: [
          { id: "default-shopping", name: "Regular shopping", items: [] }
        ],
        currentShoppingListId: "default-shopping",
        workouts: [],
        accounts: [
          { id: "acc-main", name: "Main THB" }
        ],
        finance: []
      };
    }

    let state = loadState();

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return defaultState();
      try {
        const parsed = JSON.parse(raw);
        const base = defaultState();
        return {
          ...base,
          ...parsed
        };
      } catch (e) {
        console.error("Error loading state", e);
        return defaultState();
      }
    }

    // Helpers
    function $(id) {
      return document.getElementById(id);
    }

    function formatDate(d) {
      if (!d) return "";
      try {
        const dt = new Date(d);
        if (Number.isNaN(dt.getTime())) return d;
        return dt.toLocaleDateString();
      } catch {
        return d;
      }
    }

    function confirmDelete() {
      return window.confirm("Delete this item?");
    }

    // Navigation
    const navItems = document.querySelectorAll(".nav-item");
    const pages = document.querySelectorAll(".page");

    function setPage(pageId) {
      state.currentPage = pageId;
      saveState();
      pages.forEach((p) =>
        p.id === "page-" + pageId
          ? p.classList.add("active")
          : p.classList.remove("active")
      );
      navItems.forEach((btn) => {
        btn.dataset.page === pageId
          ? btn.classList.add("active")
          : btn.classList.remove("active");
      });
    }

    navItems.forEach((btn) => {
      btn.addEventListener("click", () => {
        const page = btn.dataset.page;
        setPage(page);
      });
    });

    // Sidebar toggle
    const sidebar = $("sidebar");
    $("sidebarToggle").addEventListener("click", () => {
      sidebar.classList.toggle("expanded");
    });

    // =========== TODO ===========

    const todoListsContainer = $("todoListsContainer");
    const todoListEl = $("todoList");
    const noTodoMsg = $("noTodoMsg");

    function renderTodoLists() {
      todoListsContainer.innerHTML = "";
      state.todoLists.forEach((name) => {
        const chip = document.createElement("button");
        chip.className =
          "chip" + (name === state.currentTodoList ? " active" : "");
        chip.textContent = name;
        chip.addEventListener("click", () => {
          state.currentTodoList = name;
          saveState();
          renderTodoLists();
          renderTodos();
        });
        todoListsContainer.appendChild(chip);
      });
    }

    function addTodoList() {
      const name = prompt("New list name:");
      if (!name) return;
      if (!state.todoLists.includes(name)) state.todoLists.push(name);
      state.currentTodoList = name;
      saveState();
      renderTodoLists();
      renderTodos();
    }

    $("addTodoListBtn").addEventListener("click", addTodoList);

    function addTodo() {
      const text = $("todoText").value.trim();
      const priority = $("todoPriority").value;
      const dueDate = $("todoDueDate").value;
      if (!text) return;
      const todo = {
        id: "todo-" + Date.now() + "-" + Math.random().toString(16).slice(2),
        list: state.currentTodoList,
        title: text,
        priority,
        dueDate,
        status: "todo",
        createdAt: new Date().toISOString()
      };
      state.todos.push(todo);
      $("todoText").value = "";
      $("todoDueDate").value = "";
      $("todoText").focus();
      saveState();
      renderTodos();
    }

    $("addTodoBtn").addEventListener("click", addTodo);
    $("todoText").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addTodo();
      }
    });

    function updateTodoStatus(id, status) {
      const t = state.todos.find((t) => t.id === id);
      if (!t) return;
      t.status = status;
      saveState();
      renderTodos();
    }

    function deleteTodo(id) {
      if (!confirmDelete()) return;
      state.todos = state.todos.filter((t) => t.id !== id);
      saveState();
      renderTodos();
    }

    // Modal for editing todo
    const modalBackdrop = $("modalBackdrop");
    const modal = $("modal");
    const modalTitle = $("modalTitle");
    const modalBody = $("modalBody");
    const modalSaveBtn = $("modalSaveBtn");
    const modalCancelBtn = $("modalCancelBtn");
    const modalCloseBtn = $("modalCloseBtn");

    let modalContext = null; // { type: 'todo'|'shopping-note', id, listId }

    function openModalTodo(todo) {
      modalContext = { type: "todo", id: todo.id };
      modalTitle.textContent = "Edit task";
      modalBody.innerHTML = `
        <div class="row">
          <div>
            <label>Title</label>
            <input type="text" id="modalTodoTitle" value="${escapeHtml(
              todo.title
            )}" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Priority</label>
            <select id="modalTodoPriority">
              <option value="high" ${
                todo.priority === "high" ? "selected" : ""
              }>High</option>
              <option value="medium" ${
                todo.priority === "medium" ? "selected" : ""
              }>Medium</option>
              <option value="low" ${
                todo.priority === "low" ? "selected" : ""
              }>Low</option>
            </select>
          </div>
          <div>
            <label>Due date</label>
            <input type="date" id="modalTodoDueDate" value="${
              todo.dueDate || ""
            }" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Status</label>
            <select id="modalTodoStatus">
              <option value="todo" ${
                todo.status === "todo" ? "selected" : ""
              }>Not done</option>
              <option value="half" ${
                todo.status === "half" ? "selected" : ""
              }>Half</option>
              <option value="done" ${
                todo.status === "done" ? "selected" : ""
              }>Done</option>
            </select>
          </div>
        </div>
      `;
      modalBackdrop.classList.add("active");
    }

    function openModalShoppingNote(item, listId) {
      modalContext = { type: "shopping-note", id: item.id, listId };
      modalTitle.textContent = "Item notes";
      modalBody.innerHTML = `
        <div class="row">
          <div>
            <label>Item</label>
            <input type="text" id="modalShoppingName" value="${escapeHtml(
              item.text
            )}" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Notes</label>
            <textarea id="modalShoppingNote" placeholder="Add details, brand, conditions...">${
              item.note || ""
            }</textarea>
          </div>
        </div>
      `;
      modalBackdrop.classList.add("active");
    }

    function closeModal() {
      modalBackdrop.classList.remove("active");
      modalContext = null;
    }

    modalCancelBtn.addEventListener("click", closeModal);
    modalCloseBtn.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    modalSaveBtn.addEventListener("click", () => {
      if (!modalContext) return;
      if (modalContext.type === "todo") {
        const t = state.todos.find((tt) => tt.id === modalContext.id);
        if (!t) return;
        t.title = $("modalTodoTitle").value.trim() || t.title;
        t.priority = $("modalTodoPriority").value;
        t.dueDate = $("modalTodoDueDate").value;
        t.status = $("modalTodoStatus").value;
        saveState();
        renderTodos();
      } else if (modalContext.type === "shopping-note") {
        const list = state.shoppingLists.find(
          (l) => l.id === modalContext.listId
        );
        if (!list) return;
        const item = list.items.find((i) => i.id === modalContext.id);
        if (!item) return;
        item.text = $("modalShoppingName").value.trim() || item.text;
        item.note = $("modalShoppingNote").value.trim();
        saveState();
        renderShopping();
      }
      closeModal();
    });

    function escapeHtml(str) {
      return (str || "").replace(/[&<>"']/g, (c) => {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;"
        };
        return map[c] || c;
      });
    }

    function renderTodos() {
      const todos = state.todos.filter(
        (t) => t.list === state.currentTodoList
      );
      if (!todos.length) {
        todoListEl.innerHTML = "";
        noTodoMsg.style.display = "block";
        return;
      }
      noTodoMsg.style.display = "none";

      // sort: high priority + due date
      const priorityOrder = { high: 0, medium: 1, low: 2 };
      todos.sort((a, b) => {
        if (a.status === "done" && b.status !== "done") return 1;
        if (b.status === "done" && a.status !== "done") return -1;
        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        }
        if (a.dueDate && b.dueDate) {
          return new Date(a.dueDate) - new Date(b.dueDate);
        }
        if (a.dueDate && !b.dueDate) return -1;
        if (!a.dueDate && b.dueDate) return 1;
        return 0;
      });

      todoListEl.innerHTML = "";
      todos.forEach((t) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = t.status === "done";
        checkbox.addEventListener("change", () => {
          updateTodoStatus(t.id, checkbox.checked ? "done" : "todo");
        });

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title" + (t.status === "done" ? " done" : "");
        title.textContent = t.title;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const p = document.createElement("span");
        p.className =
          "pill " +
          (t.priority === "high"
            ? "pill-high"
            : t.priority === "low"
            ? "pill-low"
            : "pill-medium");
        p.textContent =
          t.priority.charAt(0).toUpperCase() + t.priority.slice(1);
        meta.appendChild(p);

        if (t.dueDate) {
          const due = document.createElement("span");
          due.className = "pill";
          due.textContent = "Due " + formatDate(t.dueDate);
          meta.appendChild(due);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);

        main.appendChild(checkbox);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit";
        editBtn.addEventListener("click", () => openModalTodo(t));

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () => deleteTodo(t.id));

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        todoListEl.appendChild(item);
      });
    }

    // =========== SHOPPING ===========

    const shoppingListsContainer = $("shoppingListsContainer");
    const shoppingListEl = $("shoppingList");
    const noShoppingMsg = $("noShoppingMsg");

    function renderShoppingLists() {
      shoppingListsContainer.innerHTML = "";
      state.shoppingLists.forEach((list) => {
        const chip = document.createElement("button");
        chip.className =
          "chip" +
          (list.id === state.currentShoppingListId ? " active" : "");
        chip.textContent = list.name;
        chip.addEventListener("click", () => {
          state.currentShoppingListId = list.id;
          saveState();
          renderShoppingLists();
          renderShopping();
        });
        shoppingListsContainer.appendChild(chip);
      });
    }

    function addShoppingList() {
      const name = prompt("New shopping list name:");
      if (!name) return;
      const id = "shoplist-" + Date.now();
      state.shoppingLists.push({ id, name, items: [] });
      state.currentShoppingListId = id;
      saveState();
      renderShoppingLists();
      renderShopping();
    }

    $("addShoppingListBtn").addEventListener("click", addShoppingList);

    function addShoppingItem() {
      const text = $("shoppingText").value.trim();
      if (!text) return;
      const list = state.shoppingLists.find(
        (l) => l.id === state.currentShoppingListId
      );
      if (!list) return;
      list.items.push({
        id: "shop-" + Date.now() + "-" + Math.random().toString(16).slice(2),
        text,
        done: false,
        note: ""
      });
      $("shoppingText").value = "";
      $("shoppingText").focus();
      saveState();
      renderShopping();
    }

    $("addShoppingBtn").addEventListener("click", addShoppingItem);
    $("shoppingText").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addShoppingItem();
      }
    });

    function toggleShoppingItem(listId, itemId) {
      const list = state.shoppingLists.find((l) => l.id === listId);
      if (!list) return;
      const item = list.items.find((i) => i.id === itemId);
      if (!item) return;
      item.done = !item.done;
      saveState();
      renderShopping();
    }

    function deleteShoppingItem(listId, itemId) {
      if (!confirmDelete()) return;
      const list = state.shoppingLists.find((l) => l.id === listId);
      if (!list) return;
      list.items = list.items.filter((i) => i.id !== itemId);
      saveState();
      renderShopping();
    }

    function renderShopping() {
      const list = state.shoppingLists.find(
        (l) => l.id === state.currentShoppingListId
      );
      if (!list || !list.items.length) {
        shoppingListEl.innerHTML = "";
        noShoppingMsg.style.display = "block";
        return;
      }
      noShoppingMsg.style.display = "none";

      shoppingListEl.innerHTML = "";
      list.items.forEach((item) => {
        const row = document.createElement("div");
        row.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.done;
        checkbox.addEventListener("change", () =>
          toggleShoppingItem(list.id, item.id)
        );

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className =
          "item-title" + (item.done ? " done" : "");
        title.textContent = item.text;

        const meta = document.createElement("div");
        meta.className = "item-meta";
        if (item.note) {
          const pill = document.createElement("span");
          pill.className = "pill";
          pill.textContent = "Note";
          meta.appendChild(pill);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);

        main.appendChild(checkbox);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

                const noteBtn = document.createElement("button");
        noteBtn.className = "icon-btn";
        noteBtn.textContent = "üìù";
        noteBtn.title = "Notes";
        noteBtn.addEventListener("click", () =>
          openModalShoppingNote(item, list.id)
        );

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () =>
          deleteShoppingItem(list.id, item.id)
        );

        actions.appendChild(noteBtn);
        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(actions);
        shoppingListEl.appendChild(row);
      });
    }

    // =========== WORKOUTS (simple) ===========

    const workoutListEl = $("workoutList");
    const noWorkoutMsg = $("noWorkoutMsg");

    function addWorkout() {
      const name = $("workoutName").value.trim();
      const notes = $("workoutNotes").value.trim();
      if (!name) return;
      const w = {
        id: "w-" + Date.now(),
        name,
        notes,
        date: new Date().toISOString()
      };
      state.workouts.unshift(w);
      $("workoutName").value = "";
      $("workoutNotes").value = "";
      saveState();
      renderWorkouts();
    }

    $("addWorkoutBtn").addEventListener("click", addWorkout);
    $("workoutName").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addWorkout();
      }
    });

    function deleteWorkout(id) {
      if (!confirmDelete()) return;
      state.workouts = state.workouts.filter((w) => w.id !== id);
      saveState();
      renderWorkouts();
    }

    function renderWorkouts() {
      if (!state.workouts.length) {
        workoutListEl.innerHTML = "";
        noWorkoutMsg.style.display = "block";
        return;
      }
      noWorkoutMsg.style.display = "none";
      workoutListEl.innerHTML = "";
      state.workouts.forEach((w) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = w.name;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const d = document.createElement("span");
        d.className = "pill";
        d.textContent = formatDate(w.date);
        meta.appendChild(d);

        if (w.notes) {
          const n = document.createElement("span");
          n.className = "pill";
          n.textContent = "Notes";
          meta.appendChild(n);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () => deleteWorkout(w.id));

        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        workoutListEl.appendChild(item);
      });
    }

    // =========== FINANCE ===========

    const accountsListEl = $("accountsList");
    const noAccountsMsg = $("noAccountsMsg");
    const financeListEl = $("financeList");
    const noFinanceMsg = $("noFinanceMsg");
    const financeAccountSelect = $("financeAccount");

    function renderAccounts() {
      const accounts = state.accounts;
      accountsListEl.innerHTML = "";
      financeAccountSelect.innerHTML = "";

      if (!accounts.length) {
        noAccountsMsg.style.display = "block";
      } else {
        noAccountsMsg.style.display = "none";
      }

      accounts.forEach((acc) => {
        // list item
        const row = document.createElement("div");
        row.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = acc.name;

        textWrap.appendChild(title);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete account";
        delBtn.addEventListener("click", () => deleteAccount(acc.id));

        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(actions);
        accountsListEl.appendChild(row);

        // select option
        const opt = document.createElement("option");
        opt.value = acc.id;
        opt.textContent = acc.name;
        financeAccountSelect.appendChild(opt);
      });

      if (!state.accounts.length) return;
      if (!financeAccountSelect.value) {
        financeAccountSelect.value = state.accounts[0].id;
      }
    }

    function addAccount() {
      const name = prompt("Account name (e.g. Main THB, BRL savings, USD card):");
      if (!name) return;
      const acc = {
        id: "acc-" + Date.now(),
        name: name.trim()
      };
      state.accounts.push(acc);
      saveState();
      renderAccounts();
    }

    $("addAccountBtn").addEventListener("click", addAccount);

    function deleteAccount(id) {
      const used = state.finance.some((tx) => tx.accountId === id);
      if (used) {
        alert("This account has transactions. You can't delete it yet.");
        return;
      }
      if (!confirmDelete()) return;
      state.accounts = state.accounts.filter((a) => a.id !== id);
      saveState();
      renderAccounts();
    }

    function addFinance() {
      const type = $("financeType").value;
      const amount = parseFloat($("financeAmount").value);
      if (!amount || Number.isNaN(amount)) return;

      const accountId =
        $("financeAccount").value ||
        (state.accounts[0] && state.accounts[0].id);
      if (!accountId) {
        alert("Please create an account first.");
        return;
      }

      const category = $("financeCategory").value.trim();
      const method = $("financeMethod").value.trim();
      let date = $("financeDate").value;
      if (!date) {
        date = new Date().toISOString();
      } else {
        date = new Date(date + "T00:00:00").toISOString();
      }
      const note = $("financeNote").value.trim();

      const tx = {
        id: "tx-" + Date.now(),
        type,
        amount,
        accountId,
        category,
        method,
        date,
        note
      };
      state.finance.unshift(tx);

      $("financeAmount").value = "";
      $("financeCategory").value = "";
      $("financeMethod").value = "";
      $("financeDate").value = "";
      $("financeNote").value = "";
      saveState();
      renderFinance();
    }

    $("addFinanceBtn").addEventListener("click", addFinance);
    $("financeAmount").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addFinance();
      }
    });

    function deleteFinance(id) {
      if (!confirmDelete()) return;
      state.finance = state.finance.filter((tx) => tx.id !== id);
      saveState();
      renderFinance();
    }

    function renderFinance() {
      const txs = state.finance;
      if (!txs.length) {
        financeListEl.innerHTML = "";
        noFinanceMsg.style.display = "block";
        return;
      }
      noFinanceMsg.style.display = "none";

      const accountMap = {};
      state.accounts.forEach((a) => {
        accountMap[a.id] = a.name;
      });

      financeListEl.innerHTML = "";
      txs.forEach((tx) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const textWrap = document.createElement("div");
        textWrap.className = "item-text";

        const title = document.createElement("div");
        title.className = "item-title";
        const sign = tx.type === "income" ? "+" : "-";
        title.textContent = `${sign}${tx.amount.toFixed(2)} (${tx.category || "No category"})`;

        const meta = document.createElement("div");
        meta.className = "item-meta";

        const typeTag = document.createElement("span");
        typeTag.className =
          "tag " + (tx.type === "income" ? "tag-income" : "tag-expense");
        typeTag.textContent = tx.type === "income" ? "Income" : "Expense";
        meta.appendChild(typeTag);

        const accTag = document.createElement("span");
        accTag.className = "tag";
        accTag.textContent = accountMap[tx.accountId] || "Unknown account";
        meta.appendChild(accTag);

        const methodTag = document.createElement("span");
        methodTag.className = "tag";
        methodTag.textContent = tx.method || "Method ?";
        meta.appendChild(methodTag);

        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = formatDate(tx.date);
        meta.appendChild(dateTag);

        if (tx.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Note";
          meta.appendChild(noteTag);
        }

        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete transaction";
        delBtn.addEventListener("click", () => deleteFinance(tx.id));

        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        financeListEl.appendChild(item);
      });
    }

    // =========== INIT ===========

    function init() {
      renderTodoLists();
      renderTodos();
      renderShoppingLists();
      renderShopping();
      renderWorkouts();
      renderAccounts();
      renderFinance();

      setPage(state.currentPage || "home");
    }

    init();
  </script>
</body>
</html>
