<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MyHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050608;
      --bg-elevated: #11131b;
      --bg-elevated-soft: #151826;
      --accent: #4caf50;
      --accent-soft: rgba(76, 175, 80, 0.18);
      --accent-alt: #00bcd4;
      --danger: #f44336;
      --text: #f5f5f5;
      --text-muted: #a0a4b8;
      --border-subtle: #26293a;
      --radius-lg: 16px;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #151827 0, #050608 45%);
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      display: flex;
      min-height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
    }

    .sidebar {
      width: 70px;
      background: linear-gradient(180deg, #11131b 0%, #050608 100%);
      border-right: 1px solid var(--border-subtle);
      padding: 16px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transition: width 0.2s ease;
    }

    /* Slight expansion only, not huge */
    .sidebar.expanded {
      width: 110px;
    }

    .logo {
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: radial-gradient(circle at 20% 0, #00e676, #00bcd4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #020308;
      box-shadow: 0 0 20px rgba(0, 188, 212, 0.6);
    }

    .nav-toggle {
      border: none;
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-muted);
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      margin-top: 4px;
      transition: 0.18s ease;
    }

    .nav-toggle:hover {
      background: rgba(255, 255, 255, 0.08);
      color: var(--accent-alt);
    }

    .nav {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      width: 100%;
    }

    .nav-item {
      width: 100%;
      border-radius: 999px;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-muted);
      display: flex;
      flex-direction: column; /* icon + label vertical by default too */
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: 0.18s ease;
      padding: 8px 0;
      gap: 4px;
    }

    .nav-emoji {
      flex-shrink: 0;
    }

    .nav-label {
      display: none;
      font-size: 11px;
      white-space: nowrap;
    }

    /* When expanded, show labels under icons */
    .sidebar.expanded .nav-item {
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding-inline: 0;
    }

    .sidebar.expanded .nav-label {
      display: block;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.03);
      color: var(--accent-alt);
      transform: translateY(-1px);
    }

    .nav-item.nav-active {
      background: var(--accent-soft);
      color: var(--accent);
      box-shadow: 0 0 12px rgba(76, 175, 80, 0.4);
    }

    .version {
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .main {
      flex: 1;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-radius: var(--radius-lg);
      background: linear-gradient(90deg, #141827, #0b0d14);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
    }

    #pageTitle {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.03em;
    }

    .page {
      flex: 1;
      border-radius: var(--radius-lg);
      background: rgba(8, 10, 18, 0.96);
      border: 1px solid var(--border-subtle);
      padding: 16px;
      display: none;
      overflow-y: auto;
    }

    .page.active {
      display: block;
    }

    .hidden {
      display: none !important;
    }

    .section-title {
      margin: 0 0 10px;
      font-size: 15px;
      font-weight: 600;
    }

    .card {
      border-radius: var(--radius-lg);
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      padding: 12px;
      margin-bottom: 12px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #151826;
      border: 1px solid #26293a;
      color: var(--text-muted);
    }

    .chip-highlight {
      background: rgba(0, 188, 212, 0.12);
      color: #e0f7fa;
      border-color: rgba(0, 188, 212, 0.5);
    }

    .input-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .input-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-row-inline {
      display: flex;
      gap: 8px;
    }

    .input-row-inline > * {
      flex: 1;
    }

    label {
      font-size: 11px;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px 9px;
      border-radius: 999px;
      border: 1px solid #26293a;
      background: #101320;
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: 0.16s ease;
    }

    textarea {
      border-radius: 10px;
      resize: vertical;
      min-height: 70px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent-alt);
      box-shadow: 0 0 0 1px rgba(0, 188, 212, 0.4);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      background: var(--accent-soft);
      color: var(--accent);
      transition: 0.16s ease;
    }

    .btn:hover {
      background: rgba(76, 175, 80, 0.32);
      transform: translateY(-1px);
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    .btn-secondary {
      background: rgba(0, 188, 212, 0.12);
      color: #b2ebf2;
    }

    .btn-secondary:hover {
      background: rgba(0, 188, 212, 0.24);
    }

    .btn-icon {
      padding-inline: 10px;
      font-size: 16px;
    }

    .btn-danger {
      background: rgba(244, 67, 54, 0.14);
      color: #ffcdd2;
    }

    .btn-danger:hover {
      background: rgba(244, 67, 54, 0.25);
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .empty-msg {
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
      margin-top: 4px;
    }

    .item {
      border-radius: 12px;
      padding: 8px 9px;
      background: var(--bg-elevated-soft);
      border: 1px solid #25283a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .item-main {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }

    .item-checkbox {
      flex-shrink: 0;
    }

    .item-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .item-title {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      cursor: pointer;
    }

    .item-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .item-actions {
      display: flex;
      flex-shrink: 0;
      gap: 4px;
    }

    .icon-btn {
      border-radius: 999px;
      border: none;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text-muted);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .icon-btn:hover {
      background: rgba(255, 255, 255, 0.07);
      color: var(--accent-alt);
    }

    .icon-btn.danger {
      color: #ff8a80;
    }

    .tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #181b2a;
      color: var(--text-muted);
    }

    .tag-income {
      background: rgba(76, 175, 80, 0.16);
      color: #c8e6c9;
    }

    .tag-expense {
      background: rgba(244, 67, 54, 0.16);
      color: #ffcdd2;
    }

    .selected-account {
      border-color: var(--accent-alt);
      box-shadow: 0 0 0 1px rgba(0, 188, 212, 0.6);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .filter-pill {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid #26293a;
      background: #121622;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .filter-pill label {
      font-size: 11px;
    }

    .filter-pill select,
    .filter-pill input {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
    }

    /* Workout rows */
    .workout-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
      border-radius: 10px;
      padding: 6px 8px;
      background: #101320;
    }

    .workout-row-top {
      width: 100%;
    }

    .workout-row-bottom {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .workout-row-bottom input[type="number"] {
      padding: 6px 7px;
      font-size: 12px;
    }

    .workout-row-bottom .workout-done {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .workout-row-bottom .icon-btn {
      width: 26px;
      height: 26px;
      flex-shrink: 0;
      font-size: 14px;
    }

    /* Workout favorites grid */
    .favorites-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .favorite-card {
      flex: 1 1 calc(50% - 8px);
      min-width: 110px;
      height: 70px;
      border-radius: 14px;
      border: 1px solid #273041;
      background: radial-gradient(circle at top, rgba(0, 188, 212, 0.25), #101320);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 13px;
      color: #e0f7fa;
      cursor: pointer;
      padding: 4px;
      box-shadow: 0 0 12px rgba(0, 188, 212, 0.3);
      transition: 0.16s ease;
    }

    .favorite-card:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 0 18px rgba(0, 188, 212, 0.6);
    }

    @media (min-width: 600px) {
      .favorite-card {
        flex-basis: calc(33.33% - 8px);
      }
    }

    .favorites-empty {
      font-size: 11px;
      color: var(--text-muted);
      font-style: italic;
      margin-bottom: 8px;
    }

    @media (min-width: 900px) {
      .sidebar.expanded {
        width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo">H</div>
      <button id="navToggle" class="nav-toggle" title="Expand menu">‚ò∞</button>
      <nav class="nav">
        <button class="nav-item nav-active" data-page="home" title="Home">
          <span class="nav-emoji">üè†</span><span class="nav-label">Home</span>
        </button>
        <button class="nav-item" data-page="todo" title="To-Do">
          <span class="nav-emoji">‚úÖ</span><span class="nav-label">To-Do</span>
        </button>
        <button class="nav-item" data-page="shopping" title="Shopping">
          <span class="nav-emoji">üõí</span><span class="nav-label">Shopping</span>
        </button>
        <button class="nav-item" data-page="workouts" title="Workouts">
          <span class="nav-emoji">üèãÔ∏è</span><span class="nav-label">Workouts</span>
        </button>
        <button class="nav-item" data-page="finance" title="Finances">
          <span class="nav-emoji">üí∞</span><span class="nav-label">Finances</span>
        </button>
        <button class="nav-item" data-page="notes" title="Notes">
          <span class="nav-emoji">üìù</span><span class="nav-label">Notes</span>
        </button>
        <button class="nav-item" data-page="meals" title="Meals">
          <span class="nav-emoji">üçΩÔ∏è</span><span class="nav-label">Meals</span>
        </button>
        <button class="nav-item" data-page="calendar" title="Calendar">
          <span class="nav-emoji">üìÖ</span><span class="nav-label">Calendar</span>
        </button>
        <button class="nav-item" data-page="analytics" title="Analytics">
          <span class="nav-emoji">üìä</span><span class="nav-label">Analytics</span>
        </button>
      </nav>
      <div class="version">v<span id="appVersion">0.8.0</span></div>
    </aside>

    <main class="main">
      <header class="header">
        <h1 id="pageTitle">Home</h1>
      </header>

      <!-- HOME -->
      <section class="page active" data-page="home">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Quick task</div>
          </div>
          <div class="input-grid">
            <div class="input-row">
              <label for="homeQuickTaskInput">Task</label>
              <input id="homeQuickTaskInput" type="text" placeholder="e.g. Buy vegetables, send email‚Ä¶" />
            </div>
          </div>
          <button id="homeQuickTaskBtn" class="btn">
            ‚ûï Add quick task
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Overview</div>
          </div>
          <div class="chip-row">
            <span class="chip">‚úÖ To-do</span>
            <span class="chip">üõí Shopping</span>
            <span class="chip">üèãÔ∏è Workouts</span>
            <span class="chip">üí∞ Finance</span>
            <span class="chip chip-highlight">More coming soon‚Ä¶</span>
          </div>
        </div>
      </section>

      <!-- TO-DO -->
      <section class="page hidden" data-page="todo">
        <h2 class="section-title">To-do lists</h2>

        <div class="card">
          <div class="input-grid">
            <!-- Row 1: list dropdown -->
            <div class="input-row">
              <label for="todoListSelect">List</label>
              <select id="todoListSelect"></select>
            </div>

            <!-- Row 2: new list name + + button -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="todoListName">New list</label>
                <input id="todoListName" type="text" placeholder="e.g. Work, Personal‚Ä¶" />
              </div>
              <div class="input-row" style="align-self: flex-end;">
                <button id="todoNewListBtn" class="btn btn-secondary btn-icon">‚ûï</button>
              </div>
            </div>

            <!-- Row 3: Task title -->
            <div class="input-row">
              <label for="todoTitleInput">Task</label>
              <input id="todoTitleInput" type="text" placeholder="What do you need to do?" />
            </div>

            <!-- Row 4: Priority + due date -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="todoPrioritySelect">Priority</label>
                <select id="todoPrioritySelect">
                  <option value="high">High</option>
                  <option value="medium" selected>Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
              <div class="input-row">
                <label for="todoDueDate">Due date</label>
                <input id="todoDueDate" type="date" />
              </div>
            </div>

            <!-- Row 5: Add button -->
            <div class="input-row" style="align-items: flex-end;">
              <button id="addTodoBtn" class="btn">‚ûï Add task</button>
            </div>
          </div>

          <!-- Filters toggle -->
          <div class="input-row" style="margin-bottom: 8px;">
            <button id="todoFiltersToggle" class="btn btn-secondary btn-icon">
              ‚öôÔ∏è Filters
            </button>
          </div>

          <!-- Filters panel (hidden by default) -->
          <div id="todoFiltersPanel" style="display: none;">
            <div class="pill-row">
              <div class="filter-pill">
                <label for="todoSearchInput">Search</label>
                <input id="todoSearchInput" type="text" placeholder="Text‚Ä¶" />
              </div>
              <div class="filter-pill">
                <label for="todoFilterPriority">Priority</label>
                <select id="todoFilterPriority">
                  <option value="all">All</option>
                  <option value="high">High</option>
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
              <div class="filter-pill">
                <label for="todoFilterStatus">Status</label>
                <select id="todoFilterStatus">
                  <option value="all">All</option>
                  <option value="open">Open</option>
                  <option value="inprogress">In progress</option>
                  <option value="done">Done</option>
                </select>
              </div>
              <div class="filter-pill">
                <label for="todoFilterList">List</label>
                <select id="todoFilterList">
                  <option value="all">All</option>
                </select>
              </div>
            </div>
          </div>

          <div id="noTodosMsg" class="empty-msg">
            No tasks yet. Add your first one above.
          </div>
          <div id="todoList" class="list"></div>
        </div>
      </section>

      <!-- SHOPPING -->
      <section class="page hidden" data-page="shopping">
        <h2 class="section-title">Shopping lists</h2>

        <div class="card">
          <div class="input-grid">
            <!-- Row 1: list dropdown -->
            <div class="input-row">
              <label for="shoppingListSelect">List</label>
              <select id="shoppingListSelect"></select>
            </div>

            <!-- Row 2: new list name + + button -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="shoppingListName">New list</label>
                <input id="shoppingListName" type="text" placeholder="e.g. Weekly, Work‚Ä¶" />
              </div>
              <div class="input-row" style="align-self: flex-end;">
                <button id="shoppingNewListBtn" class="btn btn-secondary btn-icon">‚ûï</button>
              </div>
            </div>

            <!-- Row 3: item -->
            <div class="input-row">
              <label for="shoppingItemInput">Item</label>
              <input id="shoppingItemInput" type="text" placeholder="e.g. Chicken, yogurt, vegetables‚Ä¶" />
            </div>

            <!-- Row 4: Add button -->
            <div class="input-row" style="align-items: flex-end;">
              <button id="addShoppingBtn" class="btn">‚ûï Add item</button>
            </div>
          </div>

          <div id="shoppingEmptyMsg" class="empty-msg">
            No items yet. Add something above.
          </div>
          <div id="shoppingList" class="list"></div>
        </div>
      </section>

      <!-- WORKOUTS -->
      <section class="page hidden" data-page="workouts">
        <h2 class="section-title">Workouts</h2>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Current workout</div>
          </div>

          <!-- Favorite workouts grid -->
          <div id="workoutFavoritesContainer">
            <div id="workoutFavoritesEmpty" class="favorites-empty">
              No favorites yet. Tap ‚òÖ on a logged workout to save it here.
            </div>
            <div id="workoutFavorites" class="favorites-grid"></div>
          </div>

          <div class="input-grid">
            <div class="input-row">
              <label for="workoutName">Workout name</label>
              <input id="workoutName" type="text" placeholder="e.g. Push day, Legs B‚Ä¶" />
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label>Start</label>
                <div id="workoutStartLabel" class="empty-msg">Not started</div>
              </div>
              <div class="input-row">
                <label>Duration</label>
                <div id="workoutDurationLabel" class="empty-msg">‚Äì</div>
              </div>
            </div>
          </div>

          <div class="input-row-inline" style="margin-bottom: 8px;">
            <button id="startWorkoutBtn" class="btn btn-secondary">‚ñ∂ Start workout</button>
            <button id="saveWorkoutBtn" class="btn">üíæ Finish & save</button>
            <button id="addExerciseRowBtn" class="btn btn-secondary">‚ûï Add exercise row</button>
          </div>

          <div id="workoutExercises" class="list"></div>

          <!-- Notes moved to bottom -->
          <div class="input-grid">
            <div class="input-row">
              <label for="workoutNotes">Notes</label>
              <textarea id="workoutNotes" placeholder="Extra notes for this workout‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Logged workouts</div>
          </div>
          <div id="noWorkoutMsg" class="empty-msg">
            No workouts logged yet.
          </div>
          <div id="workoutList" class="list"></div>
        </div>
      </section>

      <!-- FINANCE -->
      <section class="page hidden" data-page="finance">
        <h2 class="section-title">Finances</h2>

        <!-- New transaction card FIRST -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">New transaction</div>
          </div>

          <div class="input-grid">
            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeAccount">Account</label>
                <select id="financeAccount"></select>
              </div>
              <div class="input-row">
                <label for="financeType">Type</label>
                <select id="financeType">
                  <option value="expense" selected>Expense</option>
                  <option value="income">Income</option>
                </select>
              </div>
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeAmount">Amount</label>
                <input id="financeAmount" type="number" step="0.01" min="0" placeholder="0.00" />
              </div>
              <div class="input-row">
                <label for="financeDate">Date</label>
                <input id="financeDate" type="date" />
              </div>
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeCategory">Category</label>
                <input id="financeCategory" type="text" placeholder="e.g. Food, Transport‚Ä¶" />
              </div>
              <div class="input-row">
                <label for="financeMethod">Method</label>
                <input id="financeMethod" type="text" placeholder="Cash, card, scan‚Ä¶" />
              </div>
            </div>

            <div class="input-row">
              <label for="financeNote">Note</label>
              <input id="financeNote" type="text" placeholder="Optional note‚Ä¶" />
            </div>

            <div class="input-row" style="align-items: flex-end;">
              <button id="addFinanceBtn" class="btn">
                ‚ûï Add transaction
              </button>
            </div>
          </div>

          <div class="pill-row">
            <div class="filter-pill">
              <label for="financeFilterCategory">Category filter</label>
              <select id="financeFilterCategory">
                <option value="all">All</option>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Rent">Rent</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div id="financeSummary" class="empty-msg"></div>

          <div id="noFinanceMsg" class="empty-msg">
            No transactions yet.
          </div>
          <div id="financeList" class="list"></div>
        </div>

        <!-- Accounts card moved to bottom -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Accounts</div>
            <button id="addAccountBtn" class="btn btn-secondary btn-icon">
              ‚ûï
            </button>
          </div>
          <div id="noAccountsMsg" class="empty-msg">
            No accounts yet. Add one above (e.g. THB main, BRL savings, USD).
          </div>
          <div id="accountsList" class="list"></div>
        </div>
      </section>

      <!-- NOTES (placeholder) -->
      <section class="page hidden" data-page="notes">
        <h2 class="section-title">Notes</h2>
      </section>

      <!-- MEALS (placeholder) -->
      <section class="page hidden" data-page="meals">
        <h2 class="section-title">Meals</h2>
      </section>

      <!-- CALENDAR (placeholder) -->
      <section class="page hidden" data-page="calendar">
        <h2 class="section-title">Calendar</h2>
      </section>

      <!-- ANALYTICS (placeholder) -->
      <section class="page hidden" data-page="analytics">
        <h2 class="section-title">Analytics</h2>
      </section>
    </main>
  </div>
  <script>
  // MyHub v0.9.0
  document.addEventListener("DOMContentLoaded", () => {
    const STORAGE_KEY = "myhub_state_v0_9";
  
    let appState = loadState();
    const versionEl = document.getElementById("appVersion");
    if (versionEl) versionEl.textContent = "0.9.0";
  
    // --------- STATE LOAD / SAVE ----------
    function defaultState() {
      return {
        version: "0.9.0",
        todos: {
          lists: [
            { id: "todo_personal", name: "Personal" },
            { id: "todo_work", name: "Work" }
          ],
          items: []
        },
        shopping: {
          lists: [{ id: "shop_general", name: "General" }],
          items: []
        },
        workouts: {
          logs: [],
          favorites: []
        },
        finance: {
          accounts: [
            { id: "acc_thb_main", name: "THB main", currency: "THB" }
          ],
          transactions: []
        },
        notes: {
          items: []
        }
      };
    }
  
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultState();
        const parsed = JSON.parse(raw);
  
        // Very light migrations
        const base = defaultState();
        if (!parsed.todos) parsed.todos = base.todos;
        if (!parsed.shopping) parsed.shopping = base.shopping;
        if (!parsed.workouts) parsed.workouts = base.workouts;
        if (!parsed.finance) parsed.finance = base.finance;
        if (!parsed.notes) parsed.notes = base.notes;
  
        return parsed;
      } catch (e) {
        console.warn("Failed to load state, using defaults", e);
        return defaultState();
      }
    }
  
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
      } catch (e) {
        console.warn("Failed saving state", e);
      }
    }
  
    function newId(prefix = "id") {
      return `${prefix}_${Date.now().toString(36)}_${Math.random()
        .toString(36)
        .slice(2, 8)}`;
    }
  
    // --------- NAVIGATION ----------
    const sidebar = document.querySelector(".sidebar");
    const navToggle = document.getElementById("navToggle");
    const navItems = document.querySelectorAll(".nav-item");
    const pages = document.querySelectorAll(".page");
    const pageTitleEl = document.getElementById("pageTitle");
  
    function showPage(pageName, push = true) {
      navItems.forEach(btn => {
        btn.classList.toggle(
          "nav-active",
          btn.dataset.page === pageName
        );
      });
      pages.forEach(sec => {
        sec.classList.toggle(
          "active",
          sec.dataset.page === pageName
        );
        sec.classList.toggle(
          "hidden",
          sec.dataset.page !== pageName
        );
      });
      if (pageTitleEl) {
        const active = document.querySelector(
          `.nav-item[data-page="${pageName}"] .nav-label`
        );
        pageTitleEl.textContent =
          (active && active.textContent) ||
          (pageName.charAt(0).toUpperCase() + pageName.slice(1));
      }
      if (push && history && history.pushState) {
        history.pushState({ page: pageName }, "", `#${pageName}`);
      }
    }
  
    navItems.forEach(btn => {
      btn.addEventListener("click", () => {
        const page = btn.dataset.page;
        showPage(page);
      });
    });
  
    if (navToggle) {
      navToggle.addEventListener("click", () => {
        sidebar.classList.toggle("expanded");
      });
    }
  
    window.addEventListener("popstate", e => {
      const page = e.state?.page || "home";
      showPage(page, false);
    });
  
    const initialHash = location.hash.replace("#", "");
    const initialPage = initialHash || "home";
    showPage(initialPage, false);
    if (history && history.replaceState) {
      history.replaceState({ page: initialPage }, "", `#${initialPage}`);
    }
  
    // --------- HOME QUICK TASK ----------
    function initHomeQuickTask() {
      const input = document.getElementById("homeQuickTaskInput");
      const btn = document.getElementById("homeQuickTaskBtn");
      if (!input || !btn) return;
  
      btn.addEventListener("click", () => {
        const text = input.value.trim();
        if (!text) return;
        const list = appState.todos.lists[0] || null;
        const listId = list ? list.id : "todo_personal";
        const now = Date.now();
        appState.todos.items.push({
          id: newId("todo"),
          title: text,
          priority: "medium",
          dueDate: null,
          status: "open",
          listId,
          createdAt: now,
          updatedAt: now,
          doneAt: null,
          link: ""
        });
        saveState();
        input.value = "";
        renderTodoLists();
      });
  
      input.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          btn.click();
        }
      });
    }
  
    // --------- TO-DO ----------
    const DONE_RETENTION_DAYS = 3;
  
    let todoListSelect,
      todoListName,
      todoNewListBtn,
      todoTitleInput,
      todoPrioritySelect,
      todoDueDate,
      addTodoBtn,
      todoSearchInput,
      todoFilterPriority,
      todoFilterStatus,
      todoFilterList,
      todoFiltersToggle,
      todoFiltersPanel,
      todoListEl,
      noTodosMsgEl;
  
    function initTodo() {
      todoListSelect = document.getElementById("todoListSelect");
      todoListName = document.getElementById("todoListName");
      todoNewListBtn = document.getElementById("todoNewListBtn");
      todoTitleInput = document.getElementById("todoTitleInput");
      todoPrioritySelect = document.getElementById("todoPrioritySelect");
      todoDueDate = document.getElementById("todoDueDate");
      addTodoBtn = document.getElementById("addTodoBtn");
      todoSearchInput = document.getElementById("todoSearchInput");
      todoFilterPriority = document.getElementById("todoFilterPriority");
      todoFilterStatus = document.getElementById("todoFilterStatus");
      todoFilterList = document.getElementById("todoFilterList");
      todoFiltersToggle = document.getElementById("todoFiltersToggle");
      todoFiltersPanel = document.getElementById("todoFiltersPanel");
      todoListEl = document.getElementById("todoList");
      noTodosMsgEl = document.getElementById("noTodosMsg");
  
      if (!todoListSelect) return;
  
      if (!appState.todos.lists || appState.todos.lists.length === 0) {
        appState.todos.lists = defaultState().todos.lists;
      }
  
      // Make sure items have link field
      appState.todos.items.forEach(i => {
        if (typeof i.link === "undefined") i.link = "";
      });
  
      todoNewListBtn.addEventListener("click", () => {
        const name = todoListName.value.trim();
        if (!name) return;
        const id = newId("todoList");
        appState.todos.lists.push({ id, name });
        saveState();
        todoListName.value = "";
        populateTodoListSelectors(id);
        renderTodoLists();
      });
  
      todoListSelect.addEventListener("change", renderTodoLists);
  
      addTodoBtn.addEventListener("click", () => {
        addTodoFromForm();
      });
  
      todoTitleInput.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          addTodoFromForm();
        }
      });
  
      if (todoSearchInput) {
        todoSearchInput.addEventListener("input", renderTodoLists);
      }
      if (todoFilterPriority) {
        todoFilterPriority.addEventListener("change", renderTodoLists);
      }
      if (todoFilterStatus) {
        todoFilterStatus.addEventListener("change", renderTodoLists);
      }
      if (todoFilterList) {
        todoFilterList.addEventListener("change", renderTodoLists);
      }
  
      if (todoFiltersToggle && todoFiltersPanel) {
        todoFiltersToggle.addEventListener("click", () => {
          const visible = todoFiltersPanel.style.display === "block";
          todoFiltersPanel.style.display = visible ? "none" : "block";
        });
      }
  
      populateTodoListSelectors();
      cleanupOldDoneTodos();
      renderTodoLists();
    }
  
    function populateTodoListSelectors(selectedId) {
      const lists = appState.todos.lists;
      if (todoListSelect) {
        todoListSelect.innerHTML = "";
        lists.forEach(list => {
          const opt = document.createElement("option");
          opt.value = list.id;
          opt.textContent = list.name;
          todoListSelect.appendChild(opt);
        });
        if (selectedId) todoListSelect.value = selectedId;
      }
      if (todoFilterList) {
        const prev = todoFilterList.value;
        todoFilterList.innerHTML = "";
        const allOpt = document.createElement("option");
        allOpt.value = "all";
        allOpt.textContent = "All";
        todoFilterList.appendChild(allOpt);
        lists.forEach(list => {
          const opt = document.createElement("option");
          opt.value = list.id;
          opt.textContent = list.name;
          todoFilterList.appendChild(opt);
        });
        if (prev) todoFilterList.value = prev;
      }
    }
  
    function addTodoFromForm() {
      const title = todoTitleInput.value.trim();
      if (!title) return;
      const listId = todoListSelect.value || appState.todos.lists[0]?.id;
      const priority = todoPrioritySelect.value || "medium";
      const dueDateVal = todoDueDate.value || null;
      const now = Date.now();
      appState.todos.items.push({
        id: newId("todo"),
        title,
        priority,
        dueDate: dueDateVal,
        status: "open",
        listId,
        createdAt: now,
        updatedAt: now,
        doneAt: null,
        link: ""
      });
      saveState();
      todoTitleInput.value = "";
      todoDueDate.value = "";
      renderTodoLists();
    }
  
    function cleanupOldDoneTodos() {
      const cutoff =
        Date.now() - DONE_RETENTION_DAYS * 24 * 60 * 60 * 1000;
      appState.todos.items = appState.todos.items.filter(item => {
        if (item.status !== "done") return true;
        if (!item.doneAt) return true;
        return item.doneAt > cutoff;
      });
      saveState();
    }
  
    function renderTodoLists() {
      if (!todoListEl) return;
      cleanupOldDoneTodos();
  
      const searchText = (todoSearchInput?.value || "")
        .toLowerCase()
        .trim();
      const filterPriority = todoFilterPriority?.value || "all";
      const filterStatus = todoFilterStatus?.value || "all";
      const filterList = todoFilterList?.value || "all";
  
      let items = [...appState.todos.items];
  
      items = items.filter(item => {
        if (filterList !== "all" && item.listId !== filterList) return false;
        if (filterPriority !== "all" && item.priority !== filterPriority)
          return false;
        if (filterStatus !== "all" && item.status !== filterStatus)
          return false;
        if (searchText) {
          if (!item.title.toLowerCase().includes(searchText)) {
            return false;
          }
        }
        return true;
      });
  
      items.sort((a, b) => {
        const orderStatus = val => {
          if (val === "open") return 0;
          if (val === "inprogress") return 1;
          if (val === "done") return 2;
          return 0;
        };
        const sDiff = orderStatus(a.status) - orderStatus(b.status);
        if (sDiff !== 0) return sDiff;
  
        const prioNum = p => {
          if (p === "high") return 0;
          if (p === "medium") return 1;
          return 2;
        };
        const pDiff = prioNum(a.priority) - prioNum(b.priority);
        if (pDiff !== 0) return pDiff;
  
        const da = a.dueDate || "";
        const db = b.dueDate || "";
        if (da && db) return da.localeCompare(db);
        if (da && !db) return -1;
        if (!da && db) return 1;
  
        return (a.createdAt || 0) - (b.createdAt || 0);
      });
  
      todoListEl.innerHTML = "";
      if (items.length === 0) {
        if (noTodosMsgEl) noTodosMsgEl.style.display = "block";
        return;
      }
      if (noTodosMsgEl) noTodosMsgEl.style.display = "none";
  
      items.forEach(item => {
        const li = document.createElement("div");
        li.className = "item";
        li.draggable = true;
        li.dataset.id = item.id;
  
        li.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", item.id);
        });
        li.addEventListener("dragover", e => {
          e.preventDefault();
        });
        li.addEventListener("drop", e => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          if (!draggedId || draggedId === item.id) return;
          reorderTodoItems(draggedId, item.id);
        });
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const cbWrap = document.createElement("div");
        cbWrap.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.status === "done";
        cb.indeterminate = item.status === "inprogress";
        cb.addEventListener("click", e => {
          e.preventDefault();
          cycleTodoStatus(item.id);
        });
        cbWrap.appendChild(cb);
        main.appendChild(cbWrap);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = item.title;
        if (item.status === "done") {
          titleEl.style.textDecoration = "line-through";
          titleEl.style.opacity = "0.7";
        }
        if (item.status === "inprogress") {
          titleEl.style.fontStyle = "italic";
        }
        titleEl.addEventListener("click", () => {
          editTodoItem(item.id);
        });
        textWrap.appendChild(titleEl);
  
        const metaRow = document.createElement("div");
        metaRow.className = "item-meta";
  
        const list = appState.todos.lists.find(
          l => l.id === item.listId
        );
        if (list) {
          const tag = document.createElement("span");
          tag.className = "tag";
          tag.textContent = list.name;
          metaRow.appendChild(tag);
        }
  
        const prTag = document.createElement("span");
        prTag.className = "tag";
        prTag.textContent = item.priority;
        if (item.priority === "high") {
          prTag.style.background = "rgba(244,67,54,0.2)";
          prTag.style.color = "#ffcdd2";
        } else if (item.priority === "low") {
          prTag.style.background = "rgba(0,188,212,0.16)";
          prTag.style.color = "#b2ebf2";
        }
        metaRow.appendChild(prTag);
  
        if (item.dueDate) {
          const dTag = document.createElement("span");
          dTag.className = "tag";
          dTag.textContent = item.dueDate;
          metaRow.appendChild(dTag);
        }
  
        if (item.status === "inprogress") {
          const st = document.createElement("span");
          st.className = "tag";
          st.textContent = "In progress";
          metaRow.appendChild(st);
        } else if (item.status === "done") {
          const st = document.createElement("span");
          st.className = "tag";
          st.textContent = "Done";
          metaRow.appendChild(st);
        }
  
        if (item.link) {
          const linkTag = document.createElement("span");
          linkTag.className = "tag";
          linkTag.textContent = `üîó ${item.link}`;
          metaRow.appendChild(linkTag);
        }
  
        textWrap.appendChild(metaRow);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const linkBtn = document.createElement("button");
        linkBtn.className = "icon-btn";
        linkBtn.textContent = "üîó";
        linkBtn.title = "Add / edit link or reference";
        linkBtn.addEventListener("click", () => {
          const val =
            prompt(
              "Link / reference (e.g. 'Shopping: Weekly list', 'Finance: THB main')",
              item.link || ""
            ) || "";
          item.link = val.trim();
          item.updatedAt = Date.now();
          saveState();
          renderTodoLists();
        });
        actions.appendChild(linkBtn);
  
        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit task";
        editBtn.addEventListener("click", () => {
          editTodoItem(item.id);
        });
        actions.appendChild(editBtn);
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete task";
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this task?")) return;
          appState.todos.items = appState.todos.items.filter(
            t => t.id !== item.id
          );
          saveState();
          renderTodoLists();
        });
        actions.appendChild(delBtn);
  
        li.appendChild(main);
        li.appendChild(actions);
        todoListEl.appendChild(li);
      });
    }
  
    function reorderTodoItems(draggedId, targetId) {
      const items = appState.todos.items;
      const draggedIndex = items.findIndex(i => i.id === draggedId);
      const targetIndex = items.findIndex(i => i.id === targetId);
      if (draggedIndex < 0 || targetIndex < 0) return;
      const [dragged] = items.splice(draggedIndex, 1);
      items.splice(targetIndex, 0, dragged);
      saveState();
      renderTodoLists();
    }
  
    function cycleTodoStatus(id) {
      const item = appState.todos.items.find(t => t.id === id);
      if (!item) return;
      const now = Date.now();
      if (item.status === "open") {
        item.status = "inprogress";
        item.doneAt = null;
      } else if (item.status === "inprogress") {
        item.status = "done";
        item.doneAt = now;
      } else {
        item.status = "open";
        item.doneAt = null;
      }
      item.updatedAt = now;
      saveState();
      renderTodoLists();
    }
  
    function editTodoItem(id) {
      const item = appState.todos.items.find(t => t.id === id);
      if (!item) return;
      const newTitle = prompt("Edit task", item.title);
      if (newTitle === null) return;
      const trimmed = newTitle.trim();
      if (!trimmed) return;
      item.title = trimmed;
  
      const newDue =
        prompt(
          "Due date (YYYY-MM-DD, leave blank for none)",
          item.dueDate || ""
        ) || "";
      item.dueDate = newDue.trim() || null;
  
      const newPrio =
        prompt("Priority (high / medium / low)", item.priority) ||
        item.priority;
      const p = newPrio.toLowerCase();
      if (["high", "medium", "low"].includes(p)) {
        item.priority = p;
      }
  
      item.updatedAt = Date.now();
      saveState();
      renderTodoLists();
    }
  
    // --------- SHOPPING ----------
    let shoppingListSelect,
      shoppingListName,
      shoppingNewListBtn,
      shoppingItemInput,
      addShoppingBtn,
      shoppingListEl,
      shoppingEmptyMsgEl;
  
    function initShopping() {
      shoppingListSelect = document.getElementById("shoppingListSelect");
      shoppingListName = document.getElementById("shoppingListName");
      shoppingNewListBtn = document.getElementById("shoppingNewListBtn");
      shoppingItemInput = document.getElementById("shoppingItemInput");
      addShoppingBtn = document.getElementById("addShoppingBtn");
      shoppingListEl = document.getElementById("shoppingList");
      shoppingEmptyMsgEl = document.getElementById("shoppingEmptyMsg");
  
      if (!shoppingListSelect) return;
  
      if (!appState.shopping.lists || appState.shopping.lists.length === 0) {
        appState.shopping.lists = defaultState().shopping.lists;
      }
  
      appState.shopping.items.forEach(i => {
        if (typeof i.link === "undefined") i.link = "";
      });
  
      shoppingNewListBtn.addEventListener("click", () => {
        const name = shoppingListName.value.trim();
        if (!name) return;
        const id = newId("shopList");
        appState.shopping.lists.push({ id, name });
        saveState();
        shoppingListName.value = "";
        populateShoppingListSelector(id);
        renderShoppingItems();
      });
  
      shoppingListSelect.addEventListener("change", renderShoppingItems);
  
      addShoppingBtn.addEventListener("click", () => {
        addShoppingItemFromForm();
      });
  
      shoppingItemInput.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          addShoppingItemFromForm();
        }
      });
  
      populateShoppingListSelector();
      renderShoppingItems();
    }
  
    function populateShoppingListSelector(selectedId) {
      if (!shoppingListSelect) return;
      shoppingListSelect.innerHTML = "";
      appState.shopping.lists.forEach(list => {
        const opt = document.createElement("option");
        opt.value = list.id;
        opt.textContent = list.name;
        shoppingListSelect.appendChild(opt);
      });
      if (selectedId) shoppingListSelect.value = selectedId;
    }
  
    function addShoppingItemFromForm() {
      const text = shoppingItemInput.value.trim();
      if (!text) return;
      const listId =
        shoppingListSelect.value || appState.shopping.lists[0]?.id;
      const now = Date.now();
      appState.shopping.items.push({
        id: newId("shop"),
        title: text,
        notes: "",
        checked: false,
        listId,
        createdAt: now,
        link: ""
      });
      saveState();
      shoppingItemInput.value = "";
      renderShoppingItems();
    }
  
    function renderShoppingItems() {
      if (!shoppingListEl) return;
      const activeListId =
        shoppingListSelect.value || appState.shopping.lists[0]?.id;
      const items = appState.shopping.items.filter(
        i => i.listId === activeListId
      );
  
      shoppingListEl.innerHTML = "";
      if (items.length === 0) {
        if (shoppingEmptyMsgEl) shoppingEmptyMsgEl.style.display = "block";
        return;
      }
      if (shoppingEmptyMsgEl) shoppingEmptyMsgEl.style.display = "none";
  
      items.forEach(item => {
        const row = document.createElement("div");
        row.className = "item";
        row.draggable = true;
        row.dataset.id = item.id;
  
        row.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", item.id);
        });
        row.addEventListener("dragover", e => {
          e.preventDefault();
        });
        row.addEventListener("drop", e => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          if (!draggedId || draggedId === item.id) return;
          reorderShoppingItems(draggedId, item.id, activeListId);
        });
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const cbWrap = document.createElement("div");
        cbWrap.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.checked;
        cb.addEventListener("change", () => {
          item.checked = cb.checked;
          saveState();
        });
        cbWrap.appendChild(cb);
        main.appendChild(cbWrap);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = item.title;
        if (item.checked) {
          titleEl.style.textDecoration = "line-through";
          titleEl.style.opacity = "0.7";
        }
        titleEl.addEventListener("click", () => {
          const newTitle =
            prompt("Edit item", item.title) || item.title;
          const trimmed = newTitle.trim();
          if (!trimmed) return;
          item.title = trimmed;
          saveState();
          renderShoppingItems();
        });
        textWrap.appendChild(titleEl);
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        if (item.notes) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = item.notes;
          meta.appendChild(noteTag);
        }
  
        if (item.link) {
          const linkTag = document.createElement("span");
          linkTag.className = "tag";
          linkTag.textContent = `üîó ${item.link}`;
          meta.appendChild(linkTag);
        }
  
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const linkBtn = document.createElement("button");
        linkBtn.className = "icon-btn";
        linkBtn.textContent = "üîó";
        linkBtn.title = "Add / edit link or reference";
        linkBtn.addEventListener("click", () => {
          const val =
            prompt(
              "Link / reference (e.g. 'Finance: THB main', 'To-do: pay bill')",
              item.link || ""
            ) || "";
          item.link = val.trim();
          saveState();
          renderShoppingItems();
        });
        actions.appendChild(linkBtn);
  
        const noteBtn = document.createElement("button");
        noteBtn.className = "icon-btn";
        noteBtn.textContent = "üí¨";
        noteBtn.title = "Add / edit note";
        noteBtn.addEventListener("click", () => {
          const newNote =
            prompt(
              "Note for this item:",
              item.notes || ""
            ) || "";
          item.notes = newNote.trim();
          saveState();
          renderShoppingItems();
        });
        actions.appendChild(noteBtn);
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete item";
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this shopping item?")) return;
          appState.shopping.items = appState.shopping.items.filter(
            i => i.id !== item.id
          );
          saveState();
          renderShoppingItems();
        });
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
        shoppingListEl.appendChild(row);
      });
    }
  
    function reorderShoppingItems(draggedId, targetId, listId) {
      const arr = appState.shopping.items.filter(
        i => i.listId === listId
      );
      const others = appState.shopping.items.filter(
        i => i.listId !== listId
      );
      const draggedIndex = arr.findIndex(i => i.id === draggedId);
      const targetIndex = arr.findIndex(i => i.id === targetId);
      if (draggedIndex < 0 || targetIndex < 0) return;
      const [dragged] = arr.splice(draggedIndex, 1);
      arr.splice(targetIndex, 0, dragged);
      appState.shopping.items = [...others, ...arr];
      saveState();
      renderShoppingItems();
    }
  
    // --------- WORKOUTS ----------
    let workoutNameInput,
      workoutStartLabel,
      workoutDurationLabel,
      startWorkoutBtn,
      saveWorkoutBtn,
      addExerciseRowBtn,
      workoutExercisesEl,
      workoutNotesEl,
      workoutFavoritesEl,
      workoutFavoritesEmptyEl,
      workoutListEl,
      noWorkoutMsgEl;
  
    let workoutStartTime = null;
    let workoutTimer = null;
  
    function initWorkouts() {
      workoutNameInput = document.getElementById("workoutName");
      workoutStartLabel = document.getElementById("workoutStartLabel");
      workoutDurationLabel = document.getElementElementById
        ? document.getElementById("workoutDurationLabel")
        : document.getElementById("workoutDurationLabel");
      workoutDurationLabel = document.getElementById("workoutDurationLabel");
  
      startWorkoutBtn = document.getElementById("startWorkoutBtn");
      saveWorkoutBtn = document.getElementById("saveWorkoutBtn");
      addExerciseRowBtn = document.getElementById("addExerciseRowBtn");
      workoutExercisesEl = document.getElementById("workoutExercises");
      workoutNotesEl = document.getElementById("workoutNotes");
      workoutFavoritesEl = document.getElementById("workoutFavorites");
      workoutFavoritesEmptyEl = document.getElementById("workoutFavoritesEmpty");
      workoutListEl = document.getElementById("workoutList");
      noWorkoutMsgEl = document.getElementById("noWorkoutMsg");
  
      if (!workoutExercisesEl) return;
  
      if (!appState.workouts.logs) appState.workouts.logs = [];
      if (!appState.workouts.favorites) appState.workouts.favorites = [];
  
      startWorkoutBtn.addEventListener("click", () => {
        if (!workoutStartTime) {
          workoutStartTime = Date.now();
          if (workoutStartLabel) {
            workoutStartLabel.textContent = new Date(
              workoutStartTime
            ).toLocaleTimeString();
          }
          if (workoutTimer) clearInterval(workoutTimer);
          workoutTimer = setInterval(updateWorkoutDuration, 30 * 1000);
          updateWorkoutDuration();
        }
      });
  
      saveWorkoutBtn.addEventListener("click", () => {
        saveCurrentWorkout();
      });
  
      addExerciseRowBtn.addEventListener("click", () => {
        addWorkoutRow();
      });
  
      // start with 8 rows
      for (let i = 0; i < 8; i++) addWorkoutRow();
  
      renderWorkoutFavorites();
      renderWorkoutLogs();
    }
  
    function updateWorkoutDuration() {
      if (!workoutStartTime || !workoutDurationLabel) return;
      const diffMs = Date.now() - workoutStartTime;
      const mins = Math.round(diffMs / 60000);
      if (mins <= 0) {
        workoutDurationLabel.textContent = "0 min";
      } else {
        workoutDurationLabel.textContent = `${mins} min`;
      }
    }
  
    function addWorkoutRow(exercise = null) {
      const row = document.createElement("div");
      row.className = "workout-row";
  
      const top = document.createElement("div");
      top.className = "workout-row-top";
      const nameInput = document.createElement("input");
      nameInput.type = "text";
      nameInput.placeholder = "Exercise name";
      top.appendChild(nameInput);
  
      const bottom = document.createElement("div");
      bottom.className = "workout-row-bottom";
  
      const setsInput = document.createElement("input");
      setsInput.type = "number";
      setsInput.min = "0";
      setsInput.placeholder = "Sets";
  
      const repsInput = document.createElement("input");
      repsInput.type = "number";
      repsInput.min = "0";
      repsInput.placeholder = "Reps";
  
      const weightInput = document.createElement("input");
      weightInput.type = "number";
      weightInput.min = "0";
      weightInput.step = "0.5";
      weightInput.placeholder = "Weight";
  
      const doneCb = document.createElement("input");
      doneCb.type = "checkbox";
      doneCb.className = "workout-done";
      doneCb.title = "Done";
  
      const delBtn = document.createElement("button");
      delBtn.className = "icon-btn danger";
      delBtn.textContent = "üóë";
      delBtn.title = "Remove row";
      delBtn.addEventListener("click", () => {
        row.remove();
      });
  
      bottom.appendChild(setsInput);
      bottom.appendChild(repsInput);
      bottom.appendChild(weightInput);
      bottom.appendChild(doneCb);
      bottom.appendChild(delBtn);
  
      row.appendChild(top);
      row.appendChild(bottom);
      workoutExercisesEl.appendChild(row);
  
      if (exercise) {
        nameInput.value = exercise.name || "";
        setsInput.value =
          exercise.sets != null ? exercise.sets : "";
        repsInput.value =
          exercise.reps != null ? exercise.reps : "";
        weightInput.value =
          exercise.weight != null ? exercise.weight : "";
        doneCb.checked = !!exercise.done;
      }
    }
  
    function getCurrentWorkoutExercises() {
      const rows = workoutExercisesEl.querySelectorAll(".workout-row");
      const list = [];
      rows.forEach(row => {
        const [nameInput] = row.querySelectorAll(".workout-row-top input");
        const [
          setsInput,
          repsInput,
          weightInput,
          doneCb
        ] = row.querySelectorAll(".workout-row-bottom input");
        const name = nameInput.value.trim();
        const sets = setsInput.value
          ? parseInt(setsInput.value, 10)
          : null;
        const reps = repsInput.value
          ? parseInt(repsInput.value, 10)
          : null;
        const weight = weightInput.value
          ? parseFloat(weightInput.value)
          : null;
        const done = doneCb.checked;
        if (!name && sets == null && reps == null && weight == null) return;
        list.push({ name, sets, reps, weight, done });
      });
      return list;
    }
  
    function saveCurrentWorkout() {
      const name =
        workoutNameInput.value.trim() || "Workout";
      const exercises = getCurrentWorkoutExercises();
      if (exercises.length === 0) {
        alert("Add at least one exercise row to save.");
        return;
      }
      const end = Date.now();
      const start = workoutStartTime || end;
      const diffMs = end - start;
      const mins = Math.round(diffMs / 60000);
      const notes = workoutNotesEl.value.trim();
      const log = {
        id: newId("wlog"),
        name,
        start,
        end,
        durationMinutes: mins,
        notes,
        exercises
      };
      appState.workouts.logs.unshift(log);
      saveState();
      resetCurrentWorkout();
      renderWorkoutLogs();
      renderWorkoutFavorites();
    }
  
    function resetCurrentWorkout() {
      if (workoutNameInput) workoutNameInput.value = "";
      if (workoutNotesEl) workoutNotesEl.value = "";
      if (workoutStartLabel) workoutStartLabel.textContent = "Not started";
      if (workoutDurationLabel) workoutDurationLabel.textContent = "‚Äì";
      workoutStartTime = null;
      if (workoutTimer) {
        clearInterval(workoutTimer);
        workoutTimer = null;
      }
      workoutExercisesEl.innerHTML = "";
      for (let i = 0; i < 8; i++) addWorkoutRow();
    }
  
    function renderWorkoutLogs() {
      if (!workoutListEl) return;
      const logs = appState.workouts.logs || [];
      workoutListEl.innerHTML = "";
      if (logs.length === 0) {
        if (noWorkoutMsgEl) noWorkoutMsgEl.style.display = "block";
        return;
      }
      if (noWorkoutMsgEl) noWorkoutMsgEl.style.display = "none";
  
      logs.forEach(log => {
        const card = document.createElement("div");
        card.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = log.name;
        textWrap.appendChild(title);
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = new Date(
          log.start
        ).toLocaleDateString();
        meta.appendChild(dateTag);
  
        const dTag = document.createElement("span");
        dTag.className = "tag";
        dTag.textContent = `${log.durationMinutes || 0} min`;
        meta.appendChild(dTag);
  
        const exTag = document.createElement("span");
        exTag.className = "tag";
        exTag.textContent = `${log.exercises.length} exercises`;
        meta.appendChild(exTag);
  
        if (log.notes) {
          const nTag = document.createElement("span");
          nTag.className = "tag";
          nTag.textContent = "Notes";
          meta.appendChild(nTag);
        }
  
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const loadBtn = document.createElement("button");
        loadBtn.className = "icon-btn";
        loadBtn.textContent = "‚Ü∫";
        loadBtn.title = "Load as current workout";
        loadBtn.addEventListener("click", () => {
          loadWorkoutToCurrent(log);
        });
        actions.appendChild(loadBtn);
  
        const favBtn = document.createElement("button");
        favBtn.className = "icon-btn";
        favBtn.textContent = "‚òÖ";
        favBtn.title = "Save as favorite";
        favBtn.addEventListener("click", () => {
          addFavoriteFromLog(log);
        });
        actions.appendChild(favBtn);
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete workout";
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this logged workout?")) return;
          appState.workouts.logs = appState.workouts.logs.filter(
            w => w.id !== log.id
          );
          saveState();
          renderWorkoutLogs();
          renderWorkoutFavorites();
        });
        actions.appendChild(delBtn);
  
        card.appendChild(main);
        card.appendChild(actions);
        workoutListEl.appendChild(card);
      });
    }
  
    function renderWorkoutFavorites() {
      if (!workoutFavoritesEl || !workoutFavoritesEmptyEl) return;
      const favs = appState.workouts.favorites || [];
      workoutFavoritesEl.innerHTML = "";
      if (favs.length === 0) {
        workoutFavoritesEmptyEl.style.display = "block";
        return;
      }
      workoutFavoritesEmptyEl.style.display = "none";
  
      favs.slice(0, 6).forEach(fav => {
        const card = document.createElement("div");
        card.className = "favorite-card";
        card.textContent = fav.name || "Workout";
        card.title = "Tap to load in current workout";
        card.addEventListener("click", () => {
          loadFavoriteToCurrent(fav);
        });
        workoutFavoritesEl.appendChild(card);
      });
    }
  
    function addFavoriteFromLog(log) {
      const template = {
        id: newId("wfav"),
        name: log.name,
        exercises: log.exercises.map(e => ({ ...e }))
      };
      appState.workouts.favorites.unshift(template);
      appState.workouts.favorites =
        appState.workouts.favorites.slice(0, 8);
      saveState();
      renderWorkoutFavorites();
    }
  
    function loadFavoriteToCurrent(fav) {
      resetCurrentWorkout();
      if (workoutNameInput) workoutNameInput.value = fav.name;
      workoutExercisesEl.innerHTML = "";
      fav.exercises.forEach(ex => addWorkoutRow(ex));
      const needed = Math.max(0, 8 - fav.exercises.length);
      for (let i = 0; i < needed; i++) addWorkoutRow();
    }
  
    function loadWorkoutToCurrent(log) {
      resetCurrentWorkout();
      if (workoutNameInput) workoutNameInput.value = log.name;
      workoutExercisesEl.innerHTML = "";
      log.exercises.forEach(ex => addWorkoutRow(ex));
      const needed = Math.max(0, 8 - log.exercises.length);
      for (let i = 0; i < needed; i++) addWorkoutRow();
      if (workoutNotesEl) workoutNotesEl.value = log.notes || "";
    }
  
    // --------- FINANCE ----------
    let financeAccountSelect,
      financeTypeSelect,
      financeAmountInput,
      financeDateInput,
      financeCategoryInput,
      financeMethodInput,
      financeNoteInput,
      addFinanceBtn,
      financeFilterCategorySelect,
      financeSummaryEl,
      financeListEl,
      noFinanceMsgEl,
      addAccountBtn,
      accountsListEl,
      noAccountsMsgEl;
  
    let activeFinanceAccountId = null;
  
    function initFinance() {
      financeAccountSelect = document.getElementById("financeAccount");
      financeTypeSelect = document.getElementById("financeType");
      financeAmountInput = document.getElementById("financeAmount");
      financeDateInput = document.getElementById("financeDate");
      financeCategoryInput = document.getElementById("financeCategory");
      financeMethodInput = document.getElementById("financeMethod");
      financeNoteInput = document.getElementById("financeNote");
      addFinanceBtn = document.getElementById("addFinanceBtn");
      financeFilterCategorySelect = document.getElementById(
        "financeFilterCategory"
      );
      financeSummaryEl = document.getElementById("financeSummary");
      financeListEl = document.getElementById("financeList");
      noFinanceMsgEl = document.getElementById("noFinanceMsg");
      addAccountBtn = document.getElementById("addAccountBtn");
      accountsListEl = document.getElementById("accountsList");
      noAccountsMsgEl = document.getElementById("noAccountsMsg");
  
      if (!financeAccountSelect) return;
  
      if (!appState.finance.accounts || appState.finance.accounts.length === 0) {
        appState.finance.accounts = defaultState().finance.accounts;
      }
      if (!appState.finance.transactions)
        appState.finance.transactions = [];
  
      appState.finance.transactions.forEach(t => {
        if (typeof t.link === "undefined") t.link = "";
      });
  
      addFinanceBtn.addEventListener("click", () => {
        addFinanceTransaction();
      });
  
      financeAmountInput.addEventListener("keydown", e => {
        if (e.key === "Enter") {
          e.preventDefault();
          addFinanceTransaction();
        }
      });
  
      if (financeFilterCategorySelect) {
        financeFilterCategorySelect.addEventListener(
          "change",
          renderFinance
        );
      }
  
      addAccountBtn.addEventListener("click", () => {
        const name = prompt(
          "Account name (e.g. THB main, BRL savings, USD)",
          ""
        );
        if (!name) return;
        const currency =
          prompt("Currency (THB, BRL, USD‚Ä¶)", "THB") || "THB";
        const id = newId("acc");
        appState.finance.accounts.push({
          id,
          name: name.trim(),
          currency: currency.trim().toUpperCase()
        });
        saveState();
        activeFinanceAccountId = id;
        populateFinanceAccountSelect();
        renderAccounts();
        renderFinance();
      });
  
      financeAccountSelect.addEventListener("change", () => {
        activeFinanceAccountId = financeAccountSelect.value;
        renderFinance();
        renderAccounts();
      });
  
      populateFinanceAccountSelect();
      renderAccounts();
      renderFinance();
    }
  
    function populateFinanceAccountSelect() {
      financeAccountSelect.innerHTML = "";
      appState.finance.accounts.forEach(acc => {
        const opt = document.createElement("option");
        opt.value = acc.id;
        opt.textContent = `${acc.name} (${acc.currency})`;
        financeAccountSelect.appendChild(opt);
      });
      if (!activeFinanceAccountId) {
        activeFinanceAccountId =
          appState.finance.accounts[0]?.id || null;
      }
      if (activeFinanceAccountId)
        financeAccountSelect.value = activeFinanceAccountId;
    }
  
    function addFinanceTransaction() {
      const accountId =
        financeAccountSelect.value ||
        appState.finance.accounts[0]?.id;
      if (!accountId) {
        alert("Add an account first.");
        return;
      }
      const type = financeTypeSelect.value || "expense";
      const amountVal = parseFloat(
        financeAmountInput.value || "0"
      );
      if (!amountVal || amountVal <= 0) return;
      const dateStr =
        financeDateInput.value ||
        new Date().toISOString().slice(0, 10);
      const category = financeCategoryInput.value.trim() || "Other";
      const method = financeMethodInput.value.trim() || "";
      const note = financeNoteInput.value.trim() || "";
      const tx = {
        id: newId("tx"),
        accountId,
        type,
        amount: amountVal,
        date: dateStr,
        category,
        method,
        note,
        link: ""
      };
      appState.finance.transactions.unshift(tx);
      saveState();
  
      financeAmountInput.value = "";
      financeNoteInput.value = "";
      renderFinance();
    }
  
    function renderFinance() {
      if (!financeListEl) return;
      const txs = appState.finance.transactions || [];
      const filterCategory =
        financeFilterCategorySelect?.value || "all";
  
      let filtered = txs;
      if (filterCategory !== "all") {
        filtered = filtered.filter(
          t => t.category === filterCategory
        );
      }
      if (activeFinanceAccountId) {
        filtered = filtered.filter(
          t => t.accountId === activeFinanceAccountId
        );
      }
  
      financeListEl.innerHTML = "";
      if (filtered.length === 0) {
        if (noFinanceMsgEl) noFinanceMsgEl.style.display = "block";
      } else {
        if (noFinanceMsgEl) noFinanceMsgEl.style.display = "none";
      }
  
      filtered.forEach(tx => {
        const card = document.createElement("div");
        card.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        const acc = appState.finance.accounts.find(
          a => a.id === tx.accountId
        );
        const sign = tx.type === "income" ? "+" : "-";
        title.textContent = `${sign}${tx.amount.toFixed(2)} ${
          acc?.currency || ""
        }`;
        textWrap.appendChild(title);
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const typeTag = document.createElement("span");
        typeTag.className =
          "tag " +
          (tx.type === "income"
            ? "tag-income"
            : "tag-expense");
        typeTag.textContent =
          tx.type === "income" ? "Income" : "Expense";
        meta.appendChild(typeTag);
  
        const catTag = document.createElement("span");
        catTag.className = "tag";
        catTag.textContent = tx.category;
        meta.appendChild(catTag);
  
        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = tx.date;
        meta.appendChild(dateTag);
  
        if (tx.method) {
          const mTag = document.createElement("span");
          mTag.className = "tag";
          mTag.textContent = tx.method;
          meta.appendChild(mTag);
        }
  
        if (tx.note) {
          const nTag = document.createElement("span");
          nTag.className = "tag";
          nTag.textContent = "Note";
          meta.appendChild(nTag);
        }
  
        if (tx.link) {
          const linkTag = document.createElement("span");
          linkTag.className = "tag";
          linkTag.textContent = `üîó ${tx.link}`;
          meta.appendChild(linkTag);
        }
  
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const linkBtn = document.createElement("button");
        linkBtn.className = "icon-btn";
        linkBtn.textContent = "üîó";
        linkBtn.title = "Add / edit link or reference";
        linkBtn.addEventListener("click", () => {
          const val =
            prompt(
              "Link / reference (e.g. 'To-do: pay bill', 'Shopping: weekly groceries')",
              tx.link || ""
            ) || "";
          tx.link = val.trim();
          saveState();
          renderFinance();
        });
        actions.appendChild(linkBtn);
  
        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit transaction";
        editBtn.addEventListener("click", () => {
          editTransaction(tx.id);
        });
        actions.appendChild(editBtn);
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete transaction";
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this transaction?")) return;
          appState.finance.transactions =
            appState.finance.transactions.filter(
              t => t.id !== tx.id
            );
          saveState();
          renderFinance();
          renderAccounts();
        });
        actions.appendChild(delBtn);
  
        card.appendChild(main);
        card.appendChild(actions);
        financeListEl.appendChild(card);
      });
  
      renderFinanceSummary();
      renderAccounts();
    }
  
    function renderFinanceSummary() {
      if (!financeSummaryEl) return;
      const now = new Date();
      const monthStr = now.toISOString().slice(0, 7); // YYYY-MM
      let txs = appState.finance.transactions || [];
      txs = txs.filter(t => t.date && t.date.startsWith(monthStr));
      if (activeFinanceAccountId) {
        txs = txs.filter(t => t.accountId === activeFinanceAccountId);
      }
      let income = 0;
      let expense = 0;
      txs.forEach(t => {
        if (t.type === "income") income += t.amount;
        else expense += t.amount;
      });
      const net = income - expense;
      const acc = appState.finance.accounts.find(
        a => a.id === activeFinanceAccountId
      );
      const currency =
        acc?.currency || appState.finance.accounts[0]?.currency || "";
      financeSummaryEl.textContent =
        txs.length === 0
          ? "No transactions this month yet."
          : `This month ‚Ä¢ Income: +${income.toFixed(
              2
            )} ${currency} ‚Ä¢ Expense: -${expense.toFixed(
              2
            )} ${currency} ‚Ä¢ Net: ${net.toFixed(2)} ${currency}`;
    }
  
    function renderAccounts() {
      if (!accountsListEl) return;
      const accounts = appState.finance.accounts || [];
      accountsListEl.innerHTML = "";
      if (accounts.length === 0) {
        if (noAccountsMsgEl) noAccountsMsgEl.style.display = "block";
        return;
      }
      if (noAccountsMsgEl) noAccountsMsgEl.style.display = "none";
  
      accounts.forEach(acc => {
        const bal = computeAccountBalance(acc.id);
        const row = document.createElement("div");
        row.className = "item";
        if (acc.id === activeFinanceAccountId) {
          row.classList.add("selected-account");
        }
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = `${acc.name}`;
        textWrap.appendChild(title);
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const curTag = document.createElement("span");
        curTag.className = "tag";
        curTag.textContent = acc.currency;
        meta.appendChild(curTag);
  
        const balTag = document.createElement("span");
        balTag.className = "tag";
        balTag.textContent = `Bal: ${bal.toFixed(
          2
        )} ${acc.currency}`;
        meta.appendChild(balTag);
  
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        row.appendChild(main);
  
        row.addEventListener("click", () => {
          activeFinanceAccountId = acc.id;
          populateFinanceAccountSelect();
          renderAccounts();
          renderFinance();
        });
  
        accountsListEl.appendChild(row);
      });
    }
  
    function computeAccountBalance(accountId) {
      let bal = 0;
      (appState.finance.transactions || []).forEach(tx => {
        if (tx.accountId !== accountId) return;
        if (tx.type === "income") bal += tx.amount;
        else bal -= tx.amount;
      });
      return bal;
    }
  
    function editTransaction(id) {
      const tx = appState.finance.transactions.find(
        t => t.id === id
      );
      if (!tx) return;
      const amountStr =
        prompt("Amount", tx.amount.toString()) ||
        tx.amount.toString();
      const amount = parseFloat(amountStr);
      if (!isNaN(amount) && amount > 0) {
        tx.amount = amount;
      }
      const cat =
        prompt("Category", tx.category) || tx.category;
      tx.category = cat.trim() || tx.category;
      const method =
        prompt("Method", tx.method) || tx.method;
      tx.method = method.trim();
      const note =
        prompt("Note", tx.note || "") || tx.note || "";
      tx.note = note.trim();
      saveState();
      renderFinance();
      renderAccounts();
    }
  
    // --------- NOTES ----------
    function initNotes() {
      const notesPage = document.querySelector('.page[data-page="notes"]');
      if (!notesPage) return;
  
      if (!appState.notes) appState.notes = { items: [] };
  
      // Build UI dynamically
      notesPage.innerHTML = `
        <h2 class="section-title">Notes</h2>
        <div class="card">
          <div class="card-header">
            <div class="card-title">Quick note</div>
          </div>
          <div class="input-grid">
            <div class="input-row">
              <label for="noteTitleInput">Title</label>
              <input id="noteTitleInput" type="text" placeholder="Title (optional)" />
            </div>
            <div class="input-row">
              <label for="noteContentInput">Note</label>
              <textarea id="noteContentInput" placeholder="Type your note‚Ä¶"></textarea>
            </div>
            <div class="input-row" style="align-items:flex-end;">
              <button id="addNoteBtn" class="btn">‚ûï Add note</button>
            </div>
          </div>
          <div id="noNotesMsg" class="empty-msg">No notes yet.</div>
          <div id="notesList" class="list"></div>
        </div>
      `;
  
      const titleInput = document.getElementById("noteTitleInput");
      const contentInput = document.getElementById("noteContentInput");
      const addBtn = document.getElementById("addNoteBtn");
  
      addBtn.addEventListener("click", () => {
        const title = titleInput.value.trim();
        const content = contentInput.value.trim();
        if (!content) return;
        const now = Date.now();
        appState.notes.items.unshift({
          id: newId("note"),
          title,
          content,
          pinned: false,
          createdAt: now,
          updatedAt: now
        });
        saveState();
        titleInput.value = "";
        contentInput.value = "";
        renderNotes();
      });
  
      contentInput.addEventListener("keydown", e => {
        if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          addBtn.click();
        }
      });
  
      renderNotes();
    }
  
    function renderNotes() {
      const listEl = document.getElementById("notesList");
      const emptyEl = document.getElementById("noNotesMsg");
      if (!listEl) return;
  
      const notes = appState.notes?.items || [];
      listEl.innerHTML = "";
      if (notes.length === 0) {
        if (emptyEl) emptyEl.style.display = "block";
        return;
      }
      if (emptyEl) emptyEl.style.display = "none";
  
      const sorted = [...notes].sort((a, b) => {
        if (a.pinned && !b.pinned) return -1;
        if (!a.pinned && b.pinned) return 1;
        return (b.updatedAt || 0) - (a.updatedAt || 0);
      });
  
      sorted.forEach(note => {
        const card = document.createElement("div");
        card.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = note.title || "(no title)";
        textWrap.appendChild(title);
  
        const content = document.createElement("div");
        content.style.fontSize = "12px";
        content.style.whiteSpace = "pre-wrap";
        content.textContent = note.content;
        textWrap.appendChild(content);
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = new Date(
          note.updatedAt || note.createdAt
        ).toLocaleString();
        meta.appendChild(dateTag);
  
        if (note.pinned) {
          const pTag = document.createElement("span");
          pTag.className = "tag";
          pTag.textContent = "Pinned";
          meta.appendChild(pTag);
        }
  
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const pinBtn = document.createElement("button");
        pinBtn.className = "icon-btn";
        pinBtn.textContent = note.pinned ? "üìå" : "üìç";
        pinBtn.title = note.pinned ? "Unpin" : "Pin";
        pinBtn.addEventListener("click", () => {
          note.pinned = !note.pinned;
          note.updatedAt = Date.now();
          saveState();
          renderNotes();
        });
        actions.appendChild(pinBtn);
  
        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit note";
        editBtn.addEventListener("click", () => {
          const newTitle =
            prompt("Edit title", note.title || "") || note.title || "";
          const newContent =
            prompt("Edit content", note.content || "") ||
            note.content ||
            "";
          note.title = newTitle.trim();
          note.content = newContent;
          note.updatedAt = Date.now();
          saveState();
          renderNotes();
        });
        actions.appendChild(editBtn);
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete note";
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this note?")) return;
          appState.notes.items = appState.notes.items.filter(
            n => n.id !== note.id
          );
          saveState();
          renderNotes();
        });
        actions.appendChild(delBtn);
  
        card.appendChild(main);
        card.appendChild(actions);
        listEl.appendChild(card);
      });
    }
  
    // --------- INIT ALL ----------
    initHomeQuickTask();
    initTodo();
    initShopping();
    initWorkouts();
    initFinance();
    initNotes();
  });
  </script>
</body>
</html>

