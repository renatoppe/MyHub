<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MyHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050608;
      --bg-elevated: #11131b;
      --bg-elevated-soft: #151826;
      --accent: #4caf50;
      --accent-soft: rgba(76, 175, 80, 0.18);
      --accent-alt: #00bcd4;
      --danger: #f44336;
      --text: #f5f5f5;
      --text-muted: #a0a4b8;
      --border-subtle: #26293a;
      --radius-lg: 16px;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #151827 0, #050608 45%);
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      display: flex;
      min-height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
    }

    /*linha ref*/
    .sidebar {
      width: 70px;
      background: linear-gradient(180deg, #11131b 0%, #050608 100%);
      border-right: 1px solid var(--border-subtle);
      padding: 16px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transition: width 0.2s ease;
      position: sticky;
      top: 0;
      align-self: flex-start;
      height: 100vh;
    }

    /* Slight expansion only, not huge */
    .sidebar.expanded {
      width: 110px;
    }

    .logo {
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: radial-gradient(circle at 20% 0, #00e676, #00bcd4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #020308;
      box-shadow: 0 0 20px rgba(0, 188, 212, 0.6);
    }

    .nav-toggle {
      border: none;
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-muted);
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      margin-top: 4px;
      transition: 0.18s ease;
    }

    .nav-toggle:hover {
      background: rgba(255, 255, 255, 0.08);
      color: var(--accent-alt);
    }

    .nav {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      width: 100%;
    }

    .nav-item {
      width: 100%;
      border-radius: 999px;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-muted);
      display: flex;
      flex-direction: column; /* icon + label vertical by default too */
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: 0.18s ease;
      padding: 8px 0;
      gap: 4px;
    }

    .nav-emoji {
      flex-shrink: 0;
    }

    .nav-label {
      display: none;
      font-size: 11px;
      white-space: nowrap;
    }

    /* When expanded, show labels under icons */
    .sidebar.expanded .nav-item {
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding-inline: 0;
    }

    .sidebar.expanded .nav-label {
      display: block;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.03);
      color: var(--accent-alt);
      transform: translateY(-1px);
    }

    .nav-item.nav-active {
      background: var(--accent-soft);
      color: var(--accent);
      box-shadow: 0 0 12px rgba(76, 175, 80, 0.4);
    }

    .version {
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .main {
      flex: 1;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-radius: var(--radius-lg);
      background: linear-gradient(90deg, #141827, #0b0d14);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
    }

    #pageTitle {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.03em;
    }

    .page {
      flex: 1;
      border-radius: var(--radius-lg);
      background: rgba(8, 10, 18, 0.96);
      border: 1px solid var(--border-subtle);
      padding: 16px;
      display: none;
      overflow-y: auto;
    }

    .page.active {
      display: block;
    }

    .hidden {
      display: none !important;
    }

    .section-title {
      margin: 0 0 10px;
      font-size: 15px;
      font-weight: 600;
    }

    .card {
      border-radius: var(--radius-lg);
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      padding: 12px;
      margin-bottom: 12px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #151826;
      border: 1px solid #26293a;
      color: var(--text-muted);
    }

    .chip-highlight {
      background: rgba(0, 188, 212, 0.12);
      color: #e0f7fa;
      border-color: rgba(0, 188, 212, 0.5);
    }

    .input-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .input-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-row-inline {
      display: flex;
      gap: 8px;
    }

    .input-row-inline > * {
      flex: 1;
    }

    label {
      font-size: 11px;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px 9px;
      border-radius: 999px;
      border: 1px solid #26293a;
      background: #101320;
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: 0.16s ease;
    }

    textarea {
      border-radius: 10px;
      resize: vertical;
      min-height: 70px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent-alt);
      box-shadow: 0 0 0 1px rgba(0, 188, 212, 0.4);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      background: var(--accent-soft);
      color: var(--accent);
      transition: 0.16s ease;
    }

    .btn:hover {
      background: rgba(76, 175, 80, 0.32);
      transform: translateY(-1px);
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    .btn-secondary {
      background: rgba(0, 188, 212, 0.12);
      color: #b2ebf2;
    }

    .btn-secondary:hover {
      background: rgba(0, 188, 212, 0.24);
    }

    .btn-icon {
      padding-inline: 10px;
      font-size: 16px;
    }

    .btn-danger {
      background: rgba(244, 67, 54, 0.14);
      color: #ffcdd2;
    }

    .btn-danger:hover {
      background: rgba(244, 67, 54, 0.25);
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .empty-msg {
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
      margin-top: 4px;
    }

    .item {
      border-radius: 12px;
      padding: 8px 9px;
      background: var(--bg-elevated-soft);
      border: 1px solid #25283a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .item-main {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }

    .item-checkbox {
      flex-shrink: 0;
    }

    .item-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .item-title {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      cursor: pointer;
    }

    .item-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .item-actions {
      display: flex;
      flex-shrink: 0;
      gap: 4px;
    }

    .icon-btn {
      border-radius: 999px;
      border: none;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text-muted);
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .icon-btn:hover {
      background: rgba(255, 255, 255, 0.07);
      color: var(--accent-alt);
    }

    .icon-btn.danger {
      color: #ff8a80;
    }

    .tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #181b2a;
      color: var(--text-muted);
    }

    .tag-income {
      background: rgba(76, 175, 80, 0.16);
      color: #c8e6c9;
    }

    .tag-expense {
      background: rgba(244, 67, 54, 0.16);
      color: #ffcdd2;
    }

    .selected-account {
      border-color: var(--accent-alt);
      box-shadow: 0 0 0 1px rgba(0, 188, 212, 0.6);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .filter-pill {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid #26293a;
      background: #121622;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .filter-pill label {
      font-size: 11px;
    }

    .filter-pill select,
    .filter-pill input {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
    }

    /* Workout rows */
    .workout-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
      border-radius: 10px;
      padding: 6px 8px;
      background: #101320;
    }

    .workout-row-top {
      width: 100%;
    }

    .workout-row-bottom {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .workout-row-bottom input[type="number"] {
      padding: 6px 7px;
      font-size: 12px;
    }

    .workout-row-bottom .workout-done {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .workout-row-bottom .icon-btn {
      width: 26px;
      height: 26px;
      flex-shrink: 0;
      font-size: 14px;
    }

    /* Workout favorites grid */
    .favorites-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .favorite-card {
      flex: 1 1 calc(50% - 8px);
      min-width: 110px;
      height: 70px;
      border-radius: 14px;
      border: 1px solid #273041;
      background: radial-gradient(circle at top, rgba(0, 188, 212, 0.25), #101320);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 13px;
      color: #e0f7fa;
      cursor: pointer;
      padding: 4px;
      box-shadow: 0 0 12px rgba(0, 188, 212, 0.3);
      transition: 0.16s ease;
    }

    .notes-tabs {
      display: flex;
      gap: 6px;
    }
    
    .notes-tab {
      border-radius: 999px;
      border: 1px solid #26293a;
      background: #101320;
      color: var(--text-muted);
      font-size: 11px;
      padding: 4px 10px;
      cursor: pointer;
      transition: 0.16s ease;
    }
    
    .notes-tab-active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: rgba(76, 175, 80, 0.6);
    }
    
    #notesTextArea {
      width: 100%;
      min-height: 200px;
      border-radius: 10px;
      border: 1px solid #26293a;
      background: #101320;
      color: var(--text);
      font-size: 13px;
      padding: 8px 9px;
      resize: vertical;
    }
    
    .notes-toolbar {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }
    
    .notes-canvas-wrapper {
      border-radius: 12px;
      border: 1px solid #26293a;
      background: #000;
      overflow: hidden;
      position: relative;
      height: 260px; /* fits on mobile; canvas will auto-resize */
    }
    
    #notesCanvas {
      width: 100%;
      height: 100%;
      display: block;
      touch-action: none; /* important for drawing on mobile */
    }

    
    .favorite-card:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 0 18px rgba(0, 188, 212, 0.6);
    }

    @media (min-width: 600px) {
      .favorite-card {
        flex-basis: calc(33.33% - 8px);
      }
    }

    .favorites-empty {
      font-size: 11px;
      color: var(--text-muted);
      font-style: italic;
      margin-bottom: 8px;
    }

    @media (min-width: 900px) {
      .sidebar.expanded {
        width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo">H</div>
      <button id="navToggle" class="nav-toggle" title="Expand menu">‚ò∞</button>
      <nav class="nav">
        <button class="nav-item nav-active" data-page="home" title="Home">
          <span class="nav-emoji">üè†</span><span class="nav-label">Home</span>
        </button>
        <button class="nav-item" data-page="todo" title="To-Do">
          <span class="nav-emoji">‚úÖ</span><span class="nav-label">To-Do</span>
        </button>
        <button class="nav-item" data-page="shopping" title="Shopping">
          <span class="nav-emoji">üõí</span><span class="nav-label">Shopping</span>
        </button>
        <button class="nav-item" data-page="workouts" title="Workouts">
          <span class="nav-emoji">üèãÔ∏è</span><span class="nav-label">Workouts</span>
        </button>
        <button class="nav-item" data-page="finance" title="Finances">
          <span class="nav-emoji">üí∞</span><span class="nav-label">Finances</span>
        </button>
        <button class="nav-item" data-page="notes" title="Notes">
          <span class="nav-emoji">üìù</span><span class="nav-label">Notes</span>
        </button>
        <button class="nav-item" data-page="meals" title="Meals">
          <span class="nav-emoji">üçΩÔ∏è</span><span class="nav-label">Meals</span>
        </button>
        <button class="nav-item" data-page="calendar" title="Calendar">
          <span class="nav-emoji">üìÖ</span><span class="nav-label">Calendar</span>
        </button>
        <button class="nav-item" data-page="analytics" title="Analytics">
          <span class="nav-emoji">üìä</span><span class="nav-label">Analytics</span>
        </button>
      </nav>
      <div class="version">v<span id="appVersion">0.8.0</span></div>
    </aside>

    <main class="main">
      <header class="header">
        <h1 id="pageTitle">Home</h1>
      </header>

      <!-- HOME -->
      <section class="page active" data-page="home">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Quick task</div>
          </div>
          <div class="input-grid">
            <div class="input-row">
              <label for="homeQuickTaskInput">Task</label>
              <input id="homeQuickTaskInput" type="text" placeholder="e.g. Buy vegetables, send email‚Ä¶" />
            </div>
          </div>
          <button id="homeQuickTaskBtn" class="btn">
            ‚ûï Add quick task
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Overview</div>
          </div>
          <div class="chip-row">
            <span class="chip">‚úÖ To-do</span>
            <span class="chip">üõí Shopping</span>
            <span class="chip">üèãÔ∏è Workouts</span>
            <span class="chip">üí∞ Finance</span>
            <span class="chip chip-highlight">More coming soon‚Ä¶</span>
          </div>
        </div>
      </section>

      <!-- TO-DO -->
      <section class="page hidden" data-page="todo">
        <h2 class="section-title">To-do lists</h2>

        <div class="card">
          <div class="input-grid">
            <!-- Row 1: list dropdown -->
            <div class="input-row">
              <label for="todoListSelect">List</label>
              <select id="todoListSelect"></select>
            </div>

            <!-- Row 2: new list name + + button -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="todoListName">New list</label>
                <input id="todoListName" type="text" placeholder="e.g. Work, Personal‚Ä¶" />
              </div>
              <div class="input-row" style="align-self: flex-end;">
                <button id="todoNewListBtn" class="btn btn-secondary btn-icon">‚ûï</button>
              </div>
            </div>

            <!-- Row 3: Task title -->
            <div class="input-row">
              <label for="todoTitleInput">Task</label>
              <input id="todoTitleInput" type="text" placeholder="What do you need to do?" />
            </div>

            <!-- Row 4: Priority + due date -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="todoPrioritySelect">Priority</label>
                <select id="todoPrioritySelect">
                  <option value="high">High</option>
                  <option value="medium" selected>Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
              <div class="input-row">
                <label for="todoDueDate">Due date</label>
                <input id="todoDueDate" type="date" />
              </div>
            </div>

          <!-- Row 5: Filters + Add button on same line -->
          <div class="input-row-inline" style="align-items: flex-end; margin-bottom: 8px;">
            <div class="input-row" style="flex: 0 0 auto;">
              <button id="todoFiltersToggle" class="btn btn-secondary btn-icon" title="Filters">
                ‚öôÔ∏è
              </button>
              <!--testline
              <button id="addTodoBtn" class="btn">‚ûï Add task</button>-->
            </div>
            
            <div class="input-row" style="flex: 1; display: flex; justify-content: flex-end;">
              <button id="addTodoBtn" class="btn">‚ûï Add task</button>
            </div>
          </div>

          <!-- Filters panel (hidden by default) -->
          <div id="todoFiltersPanel" style="display: none;">
            <div class="pill-row">
              <div class="filter-pill">
                <label for="todoSearchInput">Search</label>
                <input id="todoSearchInput" type="text" placeholder="Text‚Ä¶" />
              </div>
              <div class="filter-pill">
                <label for="todoFilterPriority">Priority</label>
                <select id="todoFilterPriority">
                  <option value="all">All</option>
                  <option value="high">High</option>
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
              <div class="filter-pill">
                <label for="todoFilterStatus">Status</label>
                <select id="todoFilterStatus">
                  <option value="all">All</option>
                  <option value="open">Open</option>
                  <option value="inprogress">In progress</option>
                  <option value="done">Done</option>
                </select>
              </div>
              <div class="filter-pill">
                <label for="todoFilterList">List</label>
                <select id="todoFilterList">
                  <option value="all">All</option>
                </select>
              </div>
            </div>
          </div>

          <div id="noTodosMsg" class="empty-msg">
            No tasks yet. Add your first one above.
          </div>
          <div id="todoList" class="list"></div>
        </div>
      </section>

      <!-- SHOPPING -->
      <section class="page hidden" data-page="shopping">
        <h2 class="section-title">Shopping lists</h2>

        <div class="card">
          <div class="input-grid">
            <!-- Row 1: list dropdown -->
            <div class="input-row">
              <label for="shoppingListSelect">List</label>
              <select id="shoppingListSelect"></select>
            </div>

            <!-- Row 2: new list name + + button -->
            <div class="input-row-inline">
              <div class="input-row">
                <label for="shoppingListName">New list</label>
                <input id="shoppingListName" type="text" placeholder="e.g. Weekly, Work‚Ä¶" />
              </div>
              <div class="input-row" style="align-self: flex-end;">
                <button id="shoppingNewListBtn" class="btn btn-secondary btn-icon">‚ûï</button>
              </div>
            </div>

            <!-- Row 3: item -->
            <div class="input-row">
              <label for="shoppingItemInput">Item</label>
              <input id="shoppingItemInput" type="text" placeholder="e.g. Chicken, yogurt, vegetables‚Ä¶" />
            </div>

            <!-- Row 4: Add button -->
            <div class="input-row" style="align-items: flex-end;">
              <button id="addShoppingBtn" class="btn">‚ûï Add item</button>
            </div>
          </div>

          <div id="shoppingEmptyMsg" class="empty-msg">
            No items yet. Add something above.
          </div>
          <div id="shoppingList" class="list"></div>
        </div>
      </section>

      <!-- WORKOUTS -->
      <section class="page hidden" data-page="workouts">
        <h2 class="section-title">Workouts</h2>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Current workout</div>
          </div>

          <!-- Favorite workouts grid -->
          <div id="workoutFavoritesContainer">
            <div id="workoutFavoritesEmpty" class="favorites-empty">
              No favorites yet. Tap ‚òÖ on a logged workout to save it here.
            </div>
            <div id="workoutFavorites" class="favorites-grid"></div>
          </div>

          <div class="input-grid">
            <div class="input-row">
              <label for="workoutName">Workout name</label>
              <input id="workoutName" type="text" placeholder="e.g. Push day, Legs B‚Ä¶" />
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label>Start</label>
                <div id="workoutStartLabel" class="empty-msg">Not started</div>
              </div>
              <div class="input-row">
                <label>Duration</label>
                <div id="workoutDurationLabel" class="empty-msg">‚Äì</div>
              </div>
            </div>
          </div>

          <div class="input-row-inline" style="margin-bottom: 8px;">
            <button id="startWorkoutBtn" class="btn btn-secondary">‚ñ∂ Start workout</button>
            <button id="saveWorkoutBtn" class="btn">üíæ Finish & save</button>
            <button id="addExerciseRowBtn" class="btn btn-secondary">‚ûï Add exercise row</button>
          </div>

          <div id="workoutExercises" class="list"></div>

          <!-- Notes moved to bottom -->
          <div class="input-grid">
            <div class="input-row">
              <label for="workoutNotes">Notes</label>
              <textarea id="workoutNotes" placeholder="Extra notes for this workout‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Logged workouts</div>
          </div>
          <div id="noWorkoutMsg" class="empty-msg">
            No workouts logged yet.
          </div>
          <div id="workoutList" class="list"></div>
        </div>
      </section>

      <!-- FINANCE -->
      <section class="page hidden" data-page="finance">
        <h2 class="section-title">Finances</h2>

        <!-- New transaction card FIRST -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">New transaction</div>
          </div>

          <div class="input-grid">
            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeAccount">Account</label>
                <select id="financeAccount"></select>
              </div>
              <div class="input-row">
                <label for="financeType">Type</label>
                <select id="financeType">
                  <option value="expense" selected>Expense</option>
                  <option value="income">Income</option>
                </select>
              </div>
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeAmount">Amount</label>
                <input id="financeAmount" type="number" step="0.01" min="0" placeholder="0.00" />
              </div>
              <div class="input-row">
                <label for="financeDate">Date</label>
                <input id="financeDate" type="date" />
              </div>
            </div>

            <div class="input-row-inline">
              <div class="input-row">
                <label for="financeCategory">Category</label>
                <input id="financeCategory" type="text" placeholder="e.g. Food, Transport‚Ä¶" />
              </div>
              <div class="input-row">
                <label for="financeMethod">Method</label>
                <input id="financeMethod" type="text" placeholder="Cash, card, scan‚Ä¶" />
              </div>
            </div>

            <div class="input-row">
              <label for="financeNote">Note</label>
              <input id="financeNote" type="text" placeholder="Optional note‚Ä¶" />
            </div>

            <div class="input-row" style="align-items: flex-end;">
              <button id="addFinanceBtn" class="btn">
                ‚ûï Add transaction
              </button>
            </div>
          </div>

          <div class="pill-row">
            <div class="filter-pill">
              <label for="financeFilterCategory">Category filter</label>
              <select id="financeFilterCategory">
                <option value="all">All</option>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Rent">Rent</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div id="financeSummary" class="empty-msg"></div>

          <div id="noFinanceMsg" class="empty-msg">
            No transactions yet.
          </div>
          <div id="financeList" class="list"></div>
        </div>

        <!-- Accounts card moved to bottom -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Accounts</div>
            <button id="addAccountBtn" class="btn btn-secondary btn-icon">
              ‚ûï
            </button>
          </div>
          <div id="noAccountsMsg" class="empty-msg">
            No accounts yet. Add one above (e.g. THB main, BRL savings, USD).
          </div>
          <div id="accountsList" class="list"></div>
        </div>
      </section>

      <!-- NOTES (placeholder) -->
      <section class="page hidden" data-page="notes">
        <h2 class="section-title">Notes</h2>
      
        <div class="card">
          <div class="card-header">
            <div class="card-title">Notes</div>
            <div class="notes-tabs">
              <button id="notesTabText" class="notes-tab notes-tab-active">Text</button>
              <button id="notesTabCanvas" class="notes-tab">Canvas</button>
            </div>
          </div>
      
          <!-- TEXT MODE -->
          <div id="notesTextPane">
            <textarea id="notesTextArea" placeholder="Write your notes here‚Ä¶"></textarea>
          </div>
      
          <!-- CANVAS MODE -->
          <div id="notesCanvasPane" class="hidden">
            <div class="notes-toolbar">
              <button id="notesBoardDark" class="btn btn-secondary btn-icon" title="Dark board">
                ‚¨õ
              </button>
              <button id="notesBoardLight" class="btn btn-secondary btn-icon" title="Light board">
                ‚¨ú
              </button>
              <button id="notesCanvasClear" class="btn btn-secondary btn-icon" title="Clear">
                üßπ
              </button>
              <button id="notesCanvasSave" class="btn btn-secondary btn-icon" title="Save image">
                üíæ
              </button>
            </div>
            <div class="notes-canvas-wrapper">
              <canvas id="notesCanvas"></canvas>
            </div>
          </div>
        </div>
      </section>


      <!-- MEALS (placeholder) -->
      <section class="page hidden" data-page="meals">
        <h2 class="section-title">Meals</h2>
      </section>

      <!-- CALENDAR (placeholder) -->
      <section class="page hidden" data-page="calendar">
        <h2 class="section-title">Calendar</h2>
      </section>

      <!-- ANALYTICS (placeholder) -->
      <section class="page hidden" data-page="analytics">
        <h2 class="section-title">Analytics</h2>
      </section>
    </main>
  </div>
  <script>
  // ==============================
  // MyHub v0.9.3 - script.js
  // ==============================
  document.addEventListener("DOMContentLoaded", () => {
    const STORAGE_KEY = "myhub_state_v093";
  
    // -----------------------------
    // STATE & STORAGE
    // -----------------------------
    const defaultState = {
      theme: "dark",
  
      // To-do
      todoLists: ["General"],
      selectedTodoList: "General",
      todos: [],
  
      // Shopping
      shoppingLists: {
        General: []
      },
      selectedShoppingList: "General",
  
      // Workouts
      workouts: [],
      currentWorkout: null,
  
      // Finance
      financeTransactions: [],
      accounts: [],
  
      // Notes
      notesText: "",
  
      // Meals
      foodLibrary: {},   // we‚Äôll fill later
      meals: [],
  
      // Calendar focus (for later)
      calendarWeeklyFocus: {
        mon: "",
        tue: "",
        wed: "",
        thu: "",
        fri: "",
        sat: "",
        sun: ""
      }
    };
  
    let state = loadState();
  
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { ...defaultState };
        const parsed = JSON.parse(raw);
        return {
          ...defaultState,
          ...parsed
        };
      } catch (e) {
        console.error("Failed to load state", e);
        return { ...defaultState };
      }
    }
  
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("Failed to save state", e);
      }
    }
  
    // -----------------------------
    // THEME TOGGLE (üåô / ‚òÄÔ∏è)
    // -----------------------------
    const headerEl = document.querySelector(".header");
    let themeToggle;
    if (headerEl) {
      themeToggle = document.createElement("button");
      themeToggle.id = "themeToggle";
      themeToggle.className = "icon-btn";
      themeToggle.title = "Toggle theme";
      themeToggle.textContent = state.theme === "light" ? "üåô" : "‚òÄÔ∏è";
      headerEl.appendChild(themeToggle);
    }
  
    function applyTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
    }
  
    applyTheme(state.theme);
  
    if (themeToggle) {
      themeToggle.addEventListener("click", () => {
        const next = state.theme === "light" ? "dark" : "light";
        state.theme = next;
        saveState();
        applyTheme(next);
        themeToggle.textContent = next === "light" ? "üåô" : "‚òÄÔ∏è";
      });
    }
  
    // -----------------------------
    // NAVIGATION
    // -----------------------------
    const navItems = document.querySelectorAll(".nav-item");
    const pages = document.querySelectorAll(".page");
    const pageTitle = document.getElementById("pageTitle");
    const sidebar = document.querySelector(".sidebar");
    const navToggle = document.getElementById("navToggle");
  
    function showPage(pageName) {
      pages.forEach((p) => {
        if (p.dataset.page === pageName) {
          p.classList.add("active");
          p.classList.remove("hidden");
        } else {
          p.classList.remove("active");
          p.classList.add("hidden");
        }
      });
  
      navItems.forEach((btn) => {
        btn.classList.toggle("nav-active", btn.dataset.page === pageName);
      });
  
      if (pageTitle) {
        const activeNav = Array.from(navItems).find(
          (btn) => btn.dataset.page === pageName
        );
        pageTitle.textContent =
          (activeNav && activeNav.title) || pageName.charAt(0).toUpperCase() + pageName.slice(1);
      }
    }
  
    navItems.forEach((btn) => {
      btn.addEventListener("click", () => {
        showPage(btn.dataset.page);
      });
    });
  
    if (navToggle && sidebar) {
      navToggle.addEventListener("click", () => {
        sidebar.classList.toggle("expanded");
      });
    }
  
    showPage("home");
  
    function enableCanvasSidebarMode() {
      if (!sidebar) return;
      sidebar.classList.add("sidebar-collapsed");
    }
    function disableCanvasSidebarMode() {
      if (!sidebar) return;
      sidebar.classList.remove("sidebar-collapsed");
    }
  
    // -----------------------------
    // HOME - Quick Task
    // -----------------------------
    const homeQuickTaskInput = document.getElementById("homeQuickTaskInput");
    const homeQuickTaskBtn = document.getElementById("homeQuickTaskBtn");
  
    if (homeQuickTaskBtn && homeQuickTaskInput) {
      homeQuickTaskBtn.addEventListener("click", () => {
        const title = homeQuickTaskInput.value.trim();
        if (!title) return;
        const todo = {
          id: Date.now().toString(),
          list: state.selectedTodoList || "General",
          title,
          priority: "medium",
          dueDate: "",
          status: "open",
          createdAt: Date.now()
        };
        state.todos.push(todo);
        saveState();
        homeQuickTaskInput.value = "";
        renderTodos();
      });
  
      homeQuickTaskInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          homeQuickTaskBtn.click();
        }
      });
    }
  
    // -----------------------------
    // TO-DO
    // -----------------------------
    const todoListSelect = document.getElementById("todoListSelect");
    const todoNewListBtn = document.getElementById("todoNewListBtn");
    const todoTitleInput = document.getElementById("todoTitleInput");
    const todoPrioritySelect = document.getElementById("todoPrioritySelect");
    const todoDueDate = document.getElementById("todoDueDate");
    const addTodoBtn = document.getElementById("addTodoBtn");
  
    const todoFiltersToggle = document.getElementById("todoFiltersToggle");
    const todoFiltersPanel = document.getElementById("todoFiltersPanel");
    const todoSearchInput = document.getElementById("todoSearchInput");
    const todoFilterPriority = document.getElementById("todoFilterPriority");
    const todoFilterStatus = document.getElementById("todoFilterStatus");
    const todoFilterList = document.getElementById("todoFilterList");
  
    const todoListContainer = document.getElementById("todoList");
    const noTodosMsg = document.getElementById("noTodosMsg");
  
    function ensureTodoLists() {
      if (!state.todoLists || !state.todoLists.length) {
        state.todoLists = ["General"];
        state.selectedTodoList = "General";
      }
      if (!state.todoLists.includes(state.selectedTodoList)) {
        state.selectedTodoList = state.todoLists[0];
      }
    }
  
    function renderTodoListsDropdowns() {
      ensureTodoLists();
      if (todoListSelect) {
        todoListSelect.innerHTML = "";
        state.todoLists.forEach((name) => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          todoListSelect.appendChild(opt);
        });
        todoListSelect.value = state.selectedTodoList;
      }
      if (todoFilterList) {
        todoFilterList.innerHTML = "";
        const allOpt = document.createElement("option");
        allOpt.value = "all";
        allOpt.textContent = "All";
        todoFilterList.appendChild(allOpt);
        state.todoLists.forEach((name) => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          todoFilterList.appendChild(opt);
        });
        todoFilterList.value = "all";
      }
    }
  
    function priorityWeight(p) {
      if (p === "high") return 0;
      if (p === "medium") return 1;
      return 2;
    }
  
    function statusWeight(s) {
      if (s === "done") return 2;
      if (s === "inprogress") return 1;
      return 0;
    }
  
    function renderTodos() {
      if (!todoListContainer) return;
      ensureTodoLists();
  
      const currentList = state.selectedTodoList || "General";
      let items = state.todos.filter((t) => t.list === currentList);
  
      const search = (todoSearchInput?.value || "").toLowerCase();
      if (search) {
        items = items.filter((t) =>
          t.title.toLowerCase().includes(search)
        );
      }
  
      const filterP = todoFilterPriority?.value || "all";
      if (filterP !== "all") {
        items = items.filter((t) => t.priority === filterP);
      }
  
      const filterS = todoFilterStatus?.value || "all";
      if (filterS !== "all") {
        items = items.filter((t) => t.status === filterS);
      }
  
      const filterL = todoFilterList?.value || "all";
      if (filterL !== "all") {
        items = items.filter((t) => t.list === filterL);
      }
  
      items.sort((a, b) => {
        const sw = statusWeight(a.status) - statusWeight(b.status);
        if (sw !== 0) return sw;
        const pw = priorityWeight(a.priority) - priorityWeight(b.priority);
        if (pw !== 0) return pw;
        if (a.dueDate && b.dueDate) {
          return a.dueDate.localeCompare(b.dueDate);
        }
        if (a.dueDate && !b.dueDate) return -1;
        if (!a.dueDate && b.dueDate) return 1;
        return (a.createdAt || 0) - (b.createdAt || 0);
      });
  
      todoListContainer.innerHTML = "";
      if (!items.length) {
        if (noTodosMsg) noTodosMsg.style.display = "block";
        return;
      }
      if (noTodosMsg) noTodosMsg.style.display = "none";
  
      items.forEach((todo) => {
        const row = document.createElement("div");
        row.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const checkboxWrap = document.createElement("div");
        checkboxWrap.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = todo.status === "done";
        checkboxWrap.appendChild(cb);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = todo.title;
        if (todo.status === "done") {
          titleEl.style.textDecoration = "line-through";
          titleEl.style.opacity = "0.6";
        }
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const listTag = document.createElement("span");
        listTag.className = "tag";
        listTag.textContent = todo.list;
        meta.appendChild(listTag);
  
        const prTag = document.createElement("span");
        prTag.className = "tag";
        prTag.textContent =
          todo.priority.charAt(0).toUpperCase() + todo.priority.slice(1);
        meta.appendChild(prTag);
  
        if (todo.dueDate) {
          const dTag = document.createElement("span");
          dTag.className = "tag";
          dTag.textContent = `Due: ${todo.dueDate}`;
          meta.appendChild(dTag);
        }
  
        const stTag = document.createElement("span");
        stTag.className = "tag";
        stTag.textContent =
          todo.status === "open"
            ? "Open"
            : todo.status === "inprogress"
            ? "In progress"
            : "Done";
        meta.appendChild(stTag);
  
        textWrap.appendChild(titleEl);
        textWrap.appendChild(meta);
        main.appendChild(checkboxWrap);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
  
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
        todoListContainer.appendChild(row);
  
        cb.addEventListener("change", () => {
          todo.status = cb.checked ? "done" : "open";
          saveState();
          renderTodos();
        });
  
        titleEl.addEventListener("click", () => {
          // cycle open ‚Üí inprogress ‚Üí done
          if (todo.status === "open") todo.status = "inprogress";
          else if (todo.status === "inprogress") todo.status = "done";
          else todo.status = "open";
          saveState();
          renderTodos();
        });
  
        editBtn.addEventListener("click", () => {
          const newTitle = prompt("Edit task title:", todo.title);
          if (newTitle !== null) {
            todo.title = newTitle.trim() || todo.title;
          }
          const newDue = prompt(
            "Edit due date (YYYY-MM-DD or blank):",
            todo.dueDate || ""
          );
          if (newDue !== null) {
            todo.dueDate = newDue.trim();
          }
          saveState();
          renderTodos();
        });
  
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this task?")) return;
          state.todos = state.todos.filter((t) => t.id !== todo.id);
          saveState();
          renderTodos();
        });
      });
    }
  
    if (todoListSelect) {
      todoListSelect.addEventListener("change", () => {
        state.selectedTodoList = todoListSelect.value;
        saveState();
        renderTodos();
      });
    }
  
    if (todoNewListBtn) {
      todoNewListBtn.addEventListener("click", () => {
        const name = (prompt("New list name:") || "").trim();
        if (!name) return;
        if (!state.todoLists.includes(name)) {
          state.todoLists.push(name);
        }
        state.selectedTodoList = name;
        saveState();
        renderTodoListsDropdowns();
        renderTodos();
      });
    }
  
    if (addTodoBtn && todoTitleInput) {
      addTodoBtn.addEventListener("click", () => {
        const title = todoTitleInput.value.trim();
        if (!title) return;
        const priority = todoPrioritySelect?.value || "medium";
        const due = todoDueDate?.value || "";
        const todo = {
          id: Date.now().toString(),
          list: state.selectedTodoList || "General",
          title,
          priority,
          dueDate: due,
          status: "open",
          createdAt: Date.now()
        };
        state.todos.push(todo);
        saveState();
        todoTitleInput.value = "";
        renderTodos();
      });
  
      todoTitleInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") addTodoBtn.click();
      });
    }
  
    if (todoFiltersToggle && todoFiltersPanel) {
      todoFiltersToggle.addEventListener("click", () => {
        todoFiltersPanel.style.display =
          todoFiltersPanel.style.display === "none" || !todoFiltersPanel.style.display
            ? "block"
            : "none";
      });
    }
  
    [todoSearchInput, todoFilterPriority, todoFilterStatus, todoFilterList].forEach(
      (el) => {
        if (!el) return;
        el.addEventListener("input", renderTodos);
        el.addEventListener("change", renderTodos);
      }
    );
  
    renderTodoListsDropdowns();
    renderTodos();
  
    // -----------------------------
    // SHOPPING
    // -----------------------------
    const shoppingListSelect = document.getElementById("shoppingListSelect");
    const shoppingNewListBtn = document.getElementById("shoppingNewListBtn");
    const shoppingItemInput = document.getElementById("shoppingItemInput");
    const addShoppingBtn = document.getElementById("addShoppingBtn");
    const shoppingListContainer = document.getElementById("shoppingList");
    const shoppingEmptyMsg = document.getElementById("shoppingEmptyMsg");
  
    function ensureShoppingLists() {
      if (!state.shoppingLists || typeof state.shoppingLists !== "object") {
        state.shoppingLists = { General: [] };
        state.selectedShoppingList = "General";
      }
      const names = Object.keys(state.shoppingLists);
      if (!names.length) {
        state.shoppingLists = { General: [] };
        state.selectedShoppingList = "General";
      }
      if (!state.selectedShoppingList || !state.shoppingLists[state.selectedShoppingList]) {
        state.selectedShoppingList = Object.keys(state.shoppingLists)[0];
      }
    }
  
    function renderShoppingListDropdown() {
      ensureShoppingLists();
      if (!shoppingListSelect) return;
      shoppingListSelect.innerHTML = "";
      Object.keys(state.shoppingLists).forEach((name) => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        shoppingListSelect.appendChild(opt);
      });
      shoppingListSelect.value = state.selectedShoppingList;
    }
  
    function renderShoppingItems() {
      if (!shoppingListContainer) return;
      ensureShoppingLists();
      const listName = state.selectedShoppingList;
      const items = state.shoppingLists[listName] || [];
  
      shoppingListContainer.innerHTML = "";
      if (!items.length) {
        if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "block";
        return;
      }
      if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "none";
  
      items.forEach((item) => {
        const row = document.createElement("div");
        row.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const cbWrap = document.createElement("div");
        cbWrap.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!item.done;
        cbWrap.appendChild(cb);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = item.text;
        if (item.done) {
          titleEl.style.textDecoration = "line-through";
          titleEl.style.opacity = "0.6";
        }
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
        if (item.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Has note";
          meta.appendChild(noteTag);
        }
  
        textWrap.appendChild(titleEl);
        textWrap.appendChild(meta);
        main.appendChild(cbWrap);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const noteBtn = document.createElement("button");
        noteBtn.className = "icon-btn";
        noteBtn.textContent = "üìù";
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
  
        actions.appendChild(noteBtn);
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
        shoppingListContainer.appendChild(row);
  
        cb.addEventListener("change", () => {
          item.done = cb.checked;
          saveState();
          renderShoppingItems();
        });
  
        titleEl.addEventListener("click", () => {
          cb.checked = !cb.checked;
          item.done = cb.checked;
          saveState();
          renderShoppingItems();
        });
  
        noteBtn.addEventListener("click", () => {
          const newNote = prompt("Note for this item:", item.note || "");
          if (newNote !== null) {
            item.note = newNote.trim();
            saveState();
            renderShoppingItems();
          }
        });
  
        delBtn.addEventListener("click", () => {
          if (!confirm("Delete this item?")) return;
          state.shoppingLists[listName] = state.shoppingLists[listName].filter(
            (x) => x.id !== item.id
          );
          saveState();
          renderShoppingItems();
        });
      });
    }
  
    if (shoppingListSelect) {
      shoppingListSelect.addEventListener("change", () => {
        state.selectedShoppingList = shoppingListSelect.value;
        saveState();
        renderShoppingItems();
      });
    }
  
    if (shoppingNewListBtn) {
      shoppingNewListBtn.addEventListener("click", () => {
        const name = (prompt("New shopping list name:") || "").trim();
        if (!name) return;
        if (!state.shoppingLists[name]) {
          state.shoppingLists[name] = [];
        }
        state.selectedShoppingList = name;
        saveState();
        renderShoppingListDropdown();
        renderShoppingItems();
      });
    }
  
    if (addShoppingBtn && shoppingItemInput) {
      addShoppingBtn.addEventListener("click", () => {
        const text = shoppingItemInput.value.trim();
        if (!text) return;
        ensureShoppingLists();
        const listName = state.selectedShoppingList;
        state.shoppingLists[listName].push({
          id: Date.now().toString(),
          text,
          done: false,
          note: ""
        });
        shoppingItemInput.value = "";
        saveState();
        renderShoppingItems();
      });
  
      shoppingItemInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") addShoppingBtn.click();
      });
    }
  
    renderShoppingListDropdown();
    renderShoppingItems();
  
    // -----------------------------
    // WORKOUTS (basic, NOT full v2 yet)
    // -----------------------------
    const workoutNameInput = document.getElementById("workoutName");
    const workoutStartLabel = document.getElementById("workoutStartLabel");
    const workoutDurationLabel = document.getElementById("workoutDurationLabel");
    const startWorkoutBtn = document.getElementById("startWorkoutBtn");
    const saveWorkoutBtn = document.getElementById("saveWorkoutBtn");
    const addExerciseRowBtn = document.getElementById("addExerciseRowBtn");
    const workoutExercisesContainer = document.getElementById("workoutExercises");
    const workoutNotesInput = document.getElementById("workoutNotes");
    const workoutListContainer = document.getElementById("workoutList");
    const noWorkoutMsg = document.getElementById("noWorkoutMsg");
  
    function ensureCurrentWorkout() {
      if (!state.currentWorkout) {
        state.currentWorkout = {
          id: "current",
          name: "",
          date: new Date().toISOString().slice(0, 10),
          startTime: "",
          endTime: "",
          durationMinutes: 0,
          notes: "",
          exercises: []
        };
      }
    }
  
    function formatDuration(minutes) {
      if (!minutes || minutes <= 0) return "‚Äì";
      const h = Math.floor(minutes / 60);
      const m = minutes % 60;
      if (h > 0) return `${h}h ${m}m`;
      return `${m}m`;
    }
  
    function renderCurrentWorkout() {
      ensureCurrentWorkout();
      const cw = state.currentWorkout;
  
      if (workoutNameInput) workoutNameInput.value = cw.name || "";
      if (workoutNotesInput) workoutNotesInput.value = cw.notes || "";
  
      if (workoutStartLabel) {
        workoutStartLabel.textContent = cw.startTime || "Tap to set start";
      }
      if (workoutDurationLabel) {
        workoutDurationLabel.textContent = formatDuration(cw.durationMinutes);
      }
  
      if (workoutExercisesContainer) {
        workoutExercisesContainer.innerHTML = "";
        cw.exercises.forEach((ex, idx) => {
          const row = document.createElement("div");
          row.className = "workout-row";
  
          const top = document.createElement("div");
          top.className = "workout-row-top";
          const exNameInput = document.createElement("input");
          exNameInput.type = "text";
          exNameInput.placeholder = "Exercise name";
          exNameInput.value = ex.name || "";
          top.appendChild(exNameInput);
  
          const bottom = document.createElement("div");
          bottom.className = "workout-row-bottom";
  
          const setsInput = document.createElement("input");
          setsInput.type = "number";
          setsInput.min = "0";
          setsInput.placeholder = "Sets";
          setsInput.value = ex.sets || "";
  
          const repsInput = document.createElement("input");
          repsInput.type = "number";
          repsInput.min = "0";
          repsInput.placeholder = "Reps";
          repsInput.value = ex.reps || "";
  
          const weightInput = document.createElement("input");
          weightInput.type = "number";
          weightInput.min = "0";
          weightInput.placeholder = "Weight";
          weightInput.value = ex.weight || "";
  
          const doneCb = document.createElement("input");
          doneCb.type = "checkbox";
          doneCb.className = "workout-done";
          doneCb.checked = !!ex.done;
  
          const delBtn = document.createElement("button");
          delBtn.className = "icon-btn danger";
          delBtn.textContent = "üóë";
  
          bottom.appendChild(setsInput);
          bottom.appendChild(repsInput);
          bottom.appendChild(weightInput);
          bottom.appendChild(doneCb);
          bottom.appendChild(delBtn);
  
          row.appendChild(top);
          row.appendChild(bottom);
          workoutExercisesContainer.appendChild(row);
  
          exNameInput.addEventListener("input", () => {
            ex.name = exNameInput.value;
            saveState();
          });
          setsInput.addEventListener("input", () => {
            ex.sets = setsInput.value;
            saveState();
          });
          repsInput.addEventListener("input", () => {
            ex.reps = repsInput.value;
            saveState();
          });
          weightInput.addEventListener("input", () => {
            ex.weight = weightInput.value;
            saveState();
          });
          doneCb.addEventListener("change", () => {
            ex.done = doneCb.checked;
            saveState();
          });
          delBtn.addEventListener("click", () => {
            cw.exercises.splice(idx, 1);
            saveState();
            renderCurrentWorkout();
          });
        });
      }
    }
  
    function renderWorkoutLog() {
      if (!workoutListContainer) return;
      const items = state.workouts || [];
      workoutListContainer.innerHTML = "";
      if (!items.length) {
        if (noWorkoutMsg) noWorkoutMsg.style.display = "block";
        return;
      }
      if (noWorkoutMsg) noWorkoutMsg.style.display = "none";
  
      items
        .slice()
        .sort((a, b) => (a.date || "").localeCompare(b.date || ""))
        .forEach((w) => {
          const row = document.createElement("div");
          row.className = "item";
  
          const main = document.createElement("div");
          main.className = "item-main";
  
          const textWrap = document.createElement("div");
          textWrap.className = "item-text";
  
          const titleEl = document.createElement("div");
          titleEl.className = "item-title";
          titleEl.textContent = `${w.date || ""} ‚Äì ${w.name || "Workout"}`;
  
          const meta = document.createElement("div");
          meta.className = "item-meta";
  
          if (w.durationMinutes) {
            const dTag = document.createElement("span");
            dTag.className = "tag";
            dTag.textContent = formatDuration(w.durationMinutes);
            meta.appendChild(dTag);
          }
  
          const exTag = document.createElement("span");
          exTag.className = "tag";
          exTag.textContent = `${(w.exercises || []).length} exercise(s)`;
          meta.appendChild(exTag);
  
          textWrap.appendChild(titleEl);
          textWrap.appendChild(meta);
          main.appendChild(textWrap);
  
          const actions = document.createElement("div");
          actions.className = "item-actions";
          const delBtn = document.createElement("button");
          delBtn.className = "icon-btn danger";
          delBtn.textContent = "üóë";
          actions.appendChild(delBtn);
  
          row.appendChild(main);
          row.appendChild(actions);
          workoutListContainer.appendChild(row);
  
          delBtn.addEventListener("click", () => {
            if (!confirm("Delete this workout?")) return;
            state.workouts = state.workouts.filter((x) => x.id !== w.id);
            saveState();
            renderWorkoutLog();
          });
        });
    }
  
    if (startWorkoutBtn) {
      startWorkoutBtn.addEventListener("click", () => {
        ensureCurrentWorkout();
        const cw = state.currentWorkout;
        if (!cw.startTime) {
          // default: now
          const now = new Date();
          const hh = String(now.getHours()).padStart(2, "0");
          const mm = String(now.getMinutes()).padStart(2, "0");
          cw.startTime = `${hh}:${mm}`;
          cw.date = now.toISOString().slice(0, 10);
        } else {
          // allow editing start time
          const newStart = prompt(
            "Start time (HH:MM):",
            cw.startTime || ""
          );
          if (newStart !== null && newStart.trim()) {
            cw.startTime = newStart.trim();
          }
        }
        saveState();
        renderCurrentWorkout();
      });
    }
  
    if (workoutStartLabel) {
      workoutStartLabel.addEventListener("click", () => {
        ensureCurrentWorkout();
        const cw = state.currentWorkout;
        const newStart = prompt(
          "Start time (HH:MM):",
          cw.startTime || ""
        );
        if (newStart !== null) {
          cw.startTime = newStart.trim();
          saveState();
          renderCurrentWorkout();
        }
      });
    }
  
    if (workoutDurationLabel) {
      workoutDurationLabel.addEventListener("click", () => {
        ensureCurrentWorkout();
        const cw = state.currentWorkout;
        const newEnd = prompt(
          "End time (HH:MM):",
          cw.endTime || ""
        );
        if (newEnd !== null) {
          cw.endTime = newEnd.trim();
          cw.durationMinutes = computeDurationMinutes(cw.startTime, cw.endTime);
          saveState();
          renderCurrentWorkout();
        }
      });
    }
  
    function computeDurationMinutes(startStr, endStr) {
      if (!startStr || !endStr) return 0;
      const [sh, sm] = startStr.split(":").map((x) => parseInt(x || "0", 10));
      const [eh, em] = endStr.split(":").map((x) => parseInt(x || "0", 10));
      const start = sh * 60 + sm;
      let end = eh * 60 + em;
      if (end < start) end += 24 * 60;
      return end - start;
    }
  
    if (addExerciseRowBtn) {
      addExerciseRowBtn.addEventListener("click", () => {
        ensureCurrentWorkout();
        state.currentWorkout.exercises.push({
          id: Date.now().toString(),
          name: "",
          sets: "",
          reps: "",
          weight: "",
          done: false
        });
        saveState();
        renderCurrentWorkout();
      });
    }
  
    if (workoutNameInput) {
      workoutNameInput.addEventListener("input", () => {
        ensureCurrentWorkout();
        state.currentWorkout.name = workoutNameInput.value;
        saveState();
      });
    }
  
    if (workoutNotesInput) {
      workoutNotesInput.addEventListener("input", () => {
        ensureCurrentWorkout();
        state.currentWorkout.notes = workoutNotesInput.value;
        saveState();
      });
    }
  
    if (saveWorkoutBtn) {
      saveWorkoutBtn.addEventListener("click", () => {
        ensureCurrentWorkout();
        const cw = state.currentWorkout;
        if (!cw.name) {
          cw.name = "Workout";
        }
        if (!cw.startTime) {
          const now = new Date();
          const hh = String(now.getHours()).padStart(2, "0");
          const mm = String(now.getMinutes()).padStart(2, "0");
          cw.startTime = `${hh}:${mm}`;
          cw.date = now.toISOString().slice(0, 10);
        }
        if (!cw.endTime) {
          const now = new Date();
          const hh = String(now.getHours()).padStart(2, "0");
          const mm = String(now.getMinutes()).padStart(2, "0");
          cw.endTime = `${hh}:${mm}`;
        }
        cw.durationMinutes = computeDurationMinutes(cw.startTime, cw.endTime);
  
        const stored = {
          ...cw,
          id: Date.now().toString(),
          isCurrent: false
        };
  
        state.workouts.push(stored);
        state.currentWorkout = null;
        saveState();
        renderCurrentWorkout();
        renderWorkoutLog();
        alert("Workout saved!");
      });
    }
  
    renderCurrentWorkout();
    renderWorkoutLog();
  
    // -----------------------------
    // FINANCE
    // -----------------------------
    const financeAccountSelect = document.getElementById("financeAccount");
    const financeTypeSelect = document.getElementById("financeType");
    const financeAmountInput = document.getElementById("financeAmount");
    const financeDateInput = document.getElementById("financeDate");
    const financeCategoryInput = document.getElementById("financeCategory");
    const financeMethodInput = document.getElementById("financeMethod");
    const financeNoteInput = document.getElementById("financeNote");
    const addFinanceBtn = document.getElementById("addFinanceBtn");
    const financeListContainer = document.getElementById("financeList");
    const noFinanceMsg = document.getElementById("noFinanceMsg");
    const financeSummary = document.getElementById("financeSummary");
  
    const addAccountBtn = document.getElementById("addAccountBtn");
    const accountsListContainer = document.getElementById("accountsList");
    const noAccountsMsg = document.getElementById("noAccountsMsg");
  
    function ensureAccounts() {
      if (!Array.isArray(state.accounts)) {
        state.accounts = [];
      }
    }
  
    function renderAccounts() {
      ensureAccounts();
      if (accountsListContainer) {
        accountsListContainer.innerHTML = "";
        if (!state.accounts.length) {
          if (noAccountsMsg) noAccountsMsg.style.display = "block";
        } else {
          if (noAccountsMsg) noAccountsMsg.style.display = "none";
        }
        state.accounts.forEach((acc) => {
          const row = document.createElement("div");
          row.className = "item";
  
          const main = document.createElement("div");
          main.className = "item-main";
  
          const textWrap = document.createElement("div");
          textWrap.className = "item-text";
  
          const titleEl = document.createElement("div");
          titleEl.className = "item-title";
          titleEl.textContent = `${acc.name} (${acc.currency || ""})`;
  
          const meta = document.createElement("div");
          meta.className = "item-meta";
  
          const balTag = document.createElement("span");
          balTag.className = "tag";
          balTag.textContent = `Balance: ${acc.balance || 0}`;
          meta.appendChild(balTag);
  
          textWrap.appendChild(titleEl);
          textWrap.appendChild(meta);
          main.appendChild(textWrap);
  
          const actions = document.createElement("div");
          actions.className = "item-actions";
          const delBtn = document.createElement("button");
          delBtn.className = "icon-btn danger";
          delBtn.textContent = "üóë";
          actions.appendChild(delBtn);
  
          row.appendChild(main);
          row.appendChild(actions);
          accountsListContainer.appendChild(row);
  
          delBtn.addEventListener("click", () => {
            if (!confirm("Delete this account?")) return;
            state.accounts = state.accounts.filter((a) => a.id !== acc.id);
            saveState();
            renderAccounts();
            renderFinanceAccountsDropdown();
          });
        });
      }
    }
  
    function renderFinanceAccountsDropdown() {
      ensureAccounts();
      if (!financeAccountSelect) return;
      financeAccountSelect.innerHTML = "";
      if (!state.accounts.length) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "No account";
        financeAccountSelect.appendChild(opt);
        return;
      }
      state.accounts.forEach((acc) => {
        const opt = document.createElement("option");
        opt.value = acc.id;
        opt.textContent = acc.name;
        financeAccountSelect.appendChild(opt);
      });
    }
  
    if (addAccountBtn) {
      addAccountBtn.addEventListener("click", () => {
        ensureAccounts();
        const name = (prompt("Account name:") || "").trim();
        if (!name) return;
        const currency = (prompt("Currency (e.g. THB, BRL, USD):") || "").trim();
        const acc = {
          id: Date.now().toString(),
          name,
          currency,
          balance: 0
        };
        state.accounts.push(acc);
        saveState();
        renderAccounts();
        renderFinanceAccountsDropdown();
      });
    }
  
    function renderFinanceList() {
      if (!financeListContainer) return;
      const txs = state.financeTransactions || [];
  
      financeListContainer.innerHTML = "";
      if (!txs.length) {
        if (noFinanceMsg) noFinanceMsg.style.display = "block";
      } else {
        if (noFinanceMsg) noFinanceMsg.style.display = "none";
      }
  
      let totalIncome = 0;
      let totalExpense = 0;
  
      txs
        .slice()
        .sort((a, b) => (a.date || "").localeCompare(b.date || ""))
        .forEach((tx) => {
          if (tx.type === "income") totalIncome += tx.amount || 0;
          if (tx.type === "expense") totalExpense += tx.amount || 0;
  
          const row = document.createElement("div");
          row.className = "item";
  
          const main = document.createElement("div");
          main.className = "item-main";
  
          const textWrap = document.createElement("div");
          textWrap.className = "item-text";
  
          const titleEl = document.createElement("div");
          titleEl.className = "item-title";
          titleEl.textContent = `${tx.type === "income" ? "+" : "-"} ${tx.amount} ${tx.currency || ""} ‚Äì ${tx.category || ""}`;
  
          const meta = document.createElement("div");
          meta.className = "item-meta";
  
          if (tx.date) {
            const dTag = document.createElement("span");
            dTag.className = "tag";
            dTag.textContent = tx.date;
            meta.appendChild(dTag);
          }
  
          const typeTag = document.createElement("span");
          typeTag.className = "tag " + (tx.type === "income" ? "tag-income" : "tag-expense");
          typeTag.textContent = tx.type === "income" ? "Income" : "Expense";
          meta.appendChild(typeTag);
  
          if (tx.method) {
            const mTag = document.createElement("span");
            mTag.className = "tag";
            mTag.textContent = tx.method;
            meta.appendChild(mTag);
          }
  
          if (tx.note) {
            const nTag = document.createElement("span");
            nTag.className = "tag";
            nTag.textContent = "Note";
            meta.appendChild(nTag);
          }
  
          textWrap.appendChild(titleEl);
          textWrap.appendChild(meta);
          main.appendChild(textWrap);
  
          const actions = document.createElement("div");
          actions.className = "item-actions";
          const delBtn = document.createElement("button");
          delBtn.className = "icon-btn danger";
          delBtn.textContent = "üóë";
          actions.appendChild(delBtn);
  
          row.appendChild(main);
          row.appendChild(actions);
          financeListContainer.appendChild(row);
  
          delBtn.addEventListener("click", () => {
            if (!confirm("Delete this transaction?")) return;
            state.financeTransactions = state.financeTransactions.filter(
              (x) => x.id !== tx.id
            );
            saveState();
            renderFinanceList();
            renderFinanceSummary();
          });
        });
  
      if (financeSummary) {
        const net = totalIncome - totalExpense;
        financeSummary.textContent = `Income: ${totalIncome.toFixed(
          2
        )} | Expense: ${totalExpense.toFixed(2)} | Net: ${net.toFixed(2)}`;
      }
    }
  
    function renderFinanceSummary() {
      // summary already handled in renderFinanceList for now
    }
  
    if (addFinanceBtn) {
      addFinanceBtn.addEventListener("click", () => {
        const accountId = financeAccountSelect?.value || "";
        const type = financeTypeSelect?.value || "expense";
        const amount = parseFloat(financeAmountInput?.value || "0");
        const date = financeDateInput?.value || new Date().toISOString().slice(0, 10);
        const category = financeCategoryInput?.value || "";
        const method = financeMethodInput?.value || "";
        const note = financeNoteInput?.value || "";
  
        if (!amount || amount <= 0) return;
  
        const acc = state.accounts.find((a) => a.id === accountId);
  
        const tx = {
          id: Date.now().toString(),
          accountId,
          accountName: acc ? acc.name : "",
          type,
          amount,
          date,
          category,
          method,
          note,
          currency: acc?.currency || ""
        };
  
        state.financeTransactions.push(tx);
  
        if (acc) {
          if (type === "income") acc.balance += amount;
          else acc.balance -= amount;
        }
  
        saveState();
        renderFinanceList();
        renderAccounts();
  
        if (financeAmountInput) financeAmountInput.value = "";
        if (financeNoteInput) financeNoteInput.value = "";
      });
    }
  
    renderAccounts();
    renderFinanceAccountsDropdown();
    renderFinanceList();
  
    // -----------------------------
    // NOTES (Text + Canvas with colors)
    // -----------------------------
    const notesPage = document.querySelector('.page[data-page="notes"]');
    if (notesPage) {
      notesPage.innerHTML = `
        <h2 class="section-title">Notes</h2>
        <div class="card">
          <div class="card-header" style="justify-content:space-between; align-items:center;">
            <div class="card-title">Notes</div>
            <div style="display:flex; gap:6px;">
              <button id="notesTabText" class="btn btn-secondary btn-icon" title="Text notes">üìù</button>
              <button id="notesTabCanvas" class="btn btn-secondary btn-icon" title="Canvas">‚úèÔ∏è</button>
            </div>
          </div>
          <div id="notesTextSection" class="input-grid">
            <div class="input-row">
              <textarea id="notesText" placeholder="Write anything you don't want to forget..." style="min-height:180px;"></textarea>
            </div>
            <div class="input-row" style="align-items:flex-end; justify-content:space-between; display:flex;">
              <span id="notesSavedMsg" class="empty-msg" style="display:none;">Saved ‚úì</span>
              <button id="saveNotesTextBtn" class="btn">üíæ Save notes</button>
            </div>
          </div>
          <div id="notesCanvasSection" class="input-grid" style="display:none;">
            <div class="input-row-inline">
              <div class="input-row">
                <label>Color</label>
                <div id="notesColorPalette" style="display:flex; gap:6px; flex-wrap:wrap;">
                  <button data-color="#ffffff" class="icon-btn" title="White">‚¨ú</button>
                  <button data-color="#000000" class="icon-btn" title="Black">‚¨õ</button>
                  <button data-color="#f44336" class="icon-btn" title="Red">üü•</button>
                  <button data-color="#2196f3" class="icon-btn" title="Blue">üü¶</button>
                  <button data-color="#4caf50" class="icon-btn" title="Green">üü©</button>
                  <button data-color="erase" class="icon-btn" title="Eraser">üßΩ</button>
                </div>
              </div>
              <div class="input-row" style="align-items:flex-end; display:flex; gap:6px;">
                <button id="notesClearCanvas" class="btn btn-secondary">üßπ Clear</button>
                <button id="notesToggleCanvasSize" class="btn btn-secondary">
                  ‚§¢ Expand canvas
                </button>
              </div>
            </div>
            <div class="input-row">
              <div id="notesCanvasWrapper" style="width:100%; max-height:400px; overflow:hidden;">
                <canvas id="notesCanvas" style="border-radius:12px; background:#050608; border:1px solid #26293a; display:block;"></canvas>
              </div>
            </div>
          </div>
        </div>
      `;
  
      const notesTabText = document.getElementById("notesTabText");
      const notesTabCanvas = document.getElementById("notesTabCanvas");
      const notesTextSection = document.getElementById("notesTextSection");
      const notesCanvasSection = document.getElementById("notesCanvasSection");
  
      const notesText = document.getElementById("notesText");
      const saveNotesTextBtn = document.getElementById("saveNotesTextBtn");
      const notesSavedMsg = document.getElementById("notesSavedMsg");
      const notesCanvas = document.getElementById("notesCanvas");
      const notesCanvasWrapper = document.getElementById("notesCanvasWrapper");
      const notesColorPalette = document.getElementById("notesColorPalette");
      const notesToggleCanvasSize = document.getElementById("notesToggleCanvasSize");
      const notesClearCanvas = document.getElementById("notesClearCanvas");
  
      if (notesText) {
        notesText.value = state.notesText || "";
      }
  
      if (saveNotesTextBtn && notesText) {
        saveNotesTextBtn.addEventListener("click", () => {
          state.notesText = notesText.value;
          saveState();
          if (notesSavedMsg) {
            notesSavedMsg.style.display = "inline";
            setTimeout(() => {
              notesSavedMsg.style.display = "none";
            }, 1500);
          }
        });
      }
  
      function activateNotesTab(tab) {
        if (tab === "text") {
          notesTextSection.style.display = "block";
          notesCanvasSection.style.display = "none";
          disableCanvasSidebarMode();
        } else {
          notesTextSection.style.display = "none";
          notesCanvasSection.style.display = "block";
          // Do NOT auto-collapse sidebar here; only on expand
        }
      }
  
      if (notesTabText) {
        notesTabText.addEventListener("click", () => activateNotesTab("text"));
      }
      if (notesTabCanvas) {
        notesTabCanvas.addEventListener("click", () => activateNotesTab("canvas"));
      }
  
      activateNotesTab("text");
  
      if (notesCanvas && notesCanvasWrapper) {
        const ctx = notesCanvas.getContext("2d");
        let drawing = false;
        let lastX = 0;
        let lastY = 0;
        let strokeColor = "#ffffff";
        let expanded = false;
  
        function resizeCanvas() {
          const rect = notesCanvasWrapper.getBoundingClientRect();
          notesCanvas.width = Math.floor(rect.width - 4);
          const maxHeight = Math.min(380, window.innerHeight - 200);
          notesCanvas.height = expanded
            ? Math.min(380, maxHeight)
            : Math.min(240, maxHeight);
        }
  
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
  
        function startDraw(x, y) {
          drawing = true;
          lastX = x;
          lastY = y;
        }
  
        function drawTo(x, y) {
          if (!drawing) return;
          ctx.lineJoin = "round";
          ctx.lineCap = "round";
          if (strokeColor === "erase") {
            ctx.globalCompositeOperation = "destination-out";
            ctx.strokeStyle = "rgba(0,0,0,1)";
            ctx.lineWidth = 12;
          } else {
            ctx.globalCompositeOperation = "source-over";
            ctx.strokeStyle = strokeColor;
            ctx.lineWidth = 3;
          }
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(x, y);
          ctx.stroke();
          lastX = x;
          lastY = y;
        }
  
        function endDraw() {
          drawing = false;
        }
  
        notesCanvas.addEventListener("mousedown", (e) => {
          const rect = notesCanvas.getBoundingClientRect();
          startDraw(e.clientX - rect.left, e.clientY - rect.top);
        });
  
        notesCanvas.addEventListener("mousemove", (e) => {
          const rect = notesCanvas.getBoundingClientRect();
          drawTo(e.clientX - rect.left, e.clientY - rect.top);
        });
  
        notesCanvas.addEventListener("mouseup", endDraw);
        notesCanvas.addEventListener("mouseleave", endDraw);
  
        notesCanvas.addEventListener("touchstart", (e) => {
          e.preventDefault();
          const t = e.touches[0];
          const rect = notesCanvas.getBoundingClientRect();
          startDraw(t.clientX - rect.left, t.clientY - rect.top);
        });
  
        notesCanvas.addEventListener("touchmove", (e) => {
          e.preventDefault();
          const t = e.touches[0];
          const rect = notesCanvas.getBoundingClientClientRect?.() || notesCanvas.getBoundingClientRect();
          drawTo(t.clientX - rect.left, t.clientY - rect.top);
        });
  
        notesCanvas.addEventListener("touchend", endDraw);
        notesCanvas.addEventListener("touchcancel", endDraw);
  
        if (notesColorPalette) {
          notesColorPalette.querySelectorAll("button").forEach((btn) => {
            btn.addEventListener("click", () => {
              const color = btn.getAttribute("data-color");
              strokeColor = color;
            });
          });
        }
  
        if (notesClearCanvas) {
          notesClearCanvas.addEventListener("click", () => {
            ctx.clearRect(0, 0, notesCanvas.width, notesCanvas.height);
          });
        }
  
        if (notesToggleCanvasSize) {
          notesToggleCanvasSize.addEventListener("click", () => {
            expanded = !expanded;
            notesToggleCanvasSize.textContent = expanded
              ? "‚§° Shrink canvas"
              : "‚§¢ Expand canvas";
            resizeCanvas();
            if (expanded) {
              enableCanvasSidebarMode();
            } else {
              disableCanvasSidebarMode();
            }
          });
        }
      }
    }
  
    // -----------------------------
    // MEALS (basic ‚Äì library integration later)
    // -----------------------------
    // For now we keep Meals page as placeholder ‚Äì logic will be added when you paste your library
    // -----------------------------
    // CALENDAR & ANALYTICS are still placeholders for future versions.
  });
  </script>
</body>
</html>






