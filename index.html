<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MyHub v0.4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0b1020;
      --bg-alt: #141a2a;
      --card: #1a2135;
      --accent: #4f9cff;
      --accent-soft: rgba(79, 156, 255, 0.15);
      --text: #f5f7ff;
      --text-soft: #b5bddb;
      --danger: #ff4f6a;
      --success: #4fe39c;
      --border: #252c42;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      background: radial-gradient(circle at top left, #20284a 0, #050713 45%, #02030a 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
    }

    /* Layout */

    .app {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }
    .selected-account {
      box-shadow: 0 0 0 2px rgba(80, 140, 255, 0.8);
      border-radius: 14px;
    }

    .sidebar {
      background: rgba(6, 10, 30, 0.96);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 0.75rem 0.4rem;
      transition: width 0.2s ease;
      width: 60px;
      position: sticky;
      top: 0;
      height: 100vh;
      z-index: 10;
    }

    .sidebar.expanded {
      width: 190px;
    }

    .sidebar-header {
      display: flex;
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    #sidebarToggle {
      background: transparent;
      border: none;
      color: var(--text-soft);
      font-size: 1.1rem;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 999px;
      transition: background 0.15s;
    }

    #sidebarToggle:hover {
      background: rgba(255,255,255,0.06);
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.25rem;
    }

    .nav-section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-soft);
      margin: 0.4rem 0.2rem 0.15rem;
      opacity: 0.8;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.5rem;
      border-radius: 999px;
      border: none;
      width: 100%;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.15s, color 0.15s, transform 0.05s;
      position: relative;
    }

    .nav-item span.label {
      opacity: 0;
      white-space: nowrap;
      transition: opacity 0.15s;
      font-size: 0.8rem;
    }

    .sidebar.expanded .nav-item span.label {
      opacity: 1;
    }

    .nav-item .icon {
      font-size: 1.1rem;
      width: 1.6rem;
      text-align: center;
    }

    .nav-item.active {
      background: linear-gradient(90deg, #4f9cff33, #4fe39c33);
      color: var(--text);
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.04);
      color: #ffffff;
    }

    .nav-item:active {
      transform: scale(0.97);
    }

    main {
      flex: 1;
      padding: 0.75rem;
      min-height: 100vh;
    }

    .page {
      display: none;
      max-width: 980px;
      margin: 0 auto;
    }

    .page.active {
      display: block;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.8rem;
    }

    .page-header h1 {
      font-size: 1.15rem;
      font-weight: 600;
    }

    .page-header small {
      color: var(--text-soft);
      font-size: 0.8rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin: 0.5rem 0 0.75rem;
    }

    .chip {
      border-radius: 999px;
      padding: 0.2rem 0.7rem;
      border: 1px solid var(--border);
      background: rgba(10, 14, 35, 0.92);
      color: var(--text-soft);
      font-size: 0.75rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .chip.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--text);
    }

    .chip .small-btn {
      font-size: 0.7rem;
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
    }

    /* Cards / containers */

    .card {
      background: rgba(9, 13, 32, 0.96);
      border-radius: 1rem;
      padding: 0.75rem 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.03);
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.6);
      margin-bottom: 0.8rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.4rem;
    }

    .card-header h2 {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .card-header small {
      color: var(--text-soft);
      font-size: 0.75rem;
    }

    .row {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .row > * {
      flex: 1;
      min-width: 0;
    }

    label {
      font-size: 0.75rem;
      color: var(--text-soft);
      display: block;
      margin-bottom: 0.15rem;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 0.35rem 0.45rem;
      border-radius: 0.6rem;
      border: 1px solid var(--border);
      background: #050713;
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6d7591;
    }

    button.primary {
      background: linear-gradient(135deg, #4f9cff, #4fe39c);
      border: none;
      color: #050713;
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    button.primary:active {
      transform: scale(0.97);
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      color: var(--text-soft);
      padding: 0.4rem 0.7rem;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
    }

    button.secondary:active {
      transform: scale(0.97);
    }

    .muted {
      color: var(--text-soft);
      font-size: 0.78rem;
    }

    /* Lists */

    .list {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .item {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.4rem;
      padding: 0.4rem 0.5rem;
      border-radius: 0.7rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
      font-size: 0.8rem;
    }

    .item-main {
      display: flex;
      gap: 0.4rem;
      align-items: flex-start;
      flex: 1;
      min-width: 0;
    }

    .item-main input[type="checkbox"] {
      margin-top: 0.2rem;
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      word-break: break-word;
    }

    .item-title.done {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .item-meta {
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .pill {
      border-radius: 999px;
      padding: 0.05rem 0.5rem;
      font-size: 0.68rem;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.3);
    }

    .pill-high {
      border-color: #ff9b5f;
      color: #ffcfaa;
    }

    .pill-medium {
      border-color: #4f9cff;
      color: #b6d4ff;
    }

    .pill-low {
      border-color: #4fe39c;
      color: #b6f4d2;
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .icon-btn {
      border: none;
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-soft);
      border-radius: 999px;
      width: 1.6rem;
      height: 1.6rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .icon-btn.danger {
      background: rgba(255, 79, 106, 0.08);
      color: #ff9fb0;
    }

    .icon-btn:active {
      transform: scale(0.95);
    }

    /* Simple two-column layout for some pages */

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 0.75rem;
    }

    @media (max-width: 800px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
      }
      main {
        margin-left: 60px;
      }
      .sidebar.expanded + main {
        margin-left: 190px;
      }
    }

    /* Modal */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: #070a16;
      border-radius: 0.9rem;
      padding: 0.8rem;
      border: 1px solid var(--border);
      max-width: 380px;
      width: 100%;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .modal-header h3 {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.6rem;
    }

    /* Small tags */

    .tag {
      font-size: 0.7rem;
      padding: 0.05rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--text-soft);
      background: rgba(255, 255, 255, 0.02);
    }

    .tag-income {
      border-color: var(--success);
      color: #a7f5cf;
    }

    .tag-expense {
      border-color: var(--danger);
      color: #ffc6d1;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button id="sidebarToggle" title="Toggle sidebar">‚ò∞</button>
      </div>
      <nav class="nav">
        <button class="nav-item active" data-page="home">
          <span class="icon">üè†</span>
          <span class="label">Home</span>
        </button>
        <div class="nav-section-label">Core</div>
        <button class="nav-item" data-page="todo">
          <span class="icon">üìù</span>
          <span class="label">To-do</span>
        </button>
        <button class="nav-item" data-page="shopping">
          <span class="icon">üõí</span>
          <span class="label">Shopping</span>
        </button>
        <button class="nav-item" data-page="workouts">
          <span class="icon">üèãÔ∏è</span>
          <span class="label">Workouts</span>
        </button>
        <button class="nav-item" data-page="finance">
          <span class="icon">üí∞</span>
          <span class="label">Finance</span>
        </button>

        <div class="nav-section-label">Next</div>
        <button class="nav-item" data-page="notes">
          <span class="icon">üóí</span>
          <span class="label">Notes</span>
        </button>
        <button class="nav-item" data-page="meals">
          <span class="icon">üçΩ</span>
          <span class="label">Meal Tracker</span>
        </button>
        <button class="nav-item" data-page="calendar">
          <span class="icon">üìÖ</span>
          <span class="label">Calendar</span>
        </button>
        <button class="nav-item" data-page="analytics">
          <span class="icon">üìä</span>
          <span class="label">Analytics</span>
        </button>
        <button class="nav-item" data-page="settings">
          <span class="icon">‚öôÔ∏è</span>
          <span class="label">Settings</span>
        </button>
      </nav>
    </aside>

    <main>
      <!-- HOME -->
      <section class="page active" id="page-home">
        <div class="page-header">
          <h1>MyHub Overview</h1>
          <small>v0.4 ‚Äì prototype build</small>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Today</h2>
              <small>Quick glance</small>
            </div>
            <p class="muted">
              This dashboard will later show your key info: today's tasks, today's
              expenses, and last workout. For now, use the sidebar to navigate.
            </p>
          </div>
          <div class="card">
            <div class="card-header">
              <h2>Sections</h2>
            </div>
            <p class="muted" style="margin-bottom:0.4rem;">
              Available now:
            </p>
            <ul class="muted" style="font-size:0.8rem; margin-left:1rem;">
              <li>To-do lists with priorities and due dates</li>
              <li>Shopping lists with notes</li>
              <li>Simple workouts log</li>
              <li>Finance tracking with accounts</li>
            </ul>
            <p class="muted" style="margin-top:0.4rem;">
              Coming soon: Notes, Meal tracker, Calendar, and Analytics pages.
            </p>
          </div>
        </div>
      </section>

      <!-- TODO -->
      <section class="page" id="page-todo">
        <div class="page-header">
          <h1>To-do</h1>
          <small>Lists, priorities, due dates</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Lists</h2>
            <div>
              <button class="secondary" id="addTodoListBtn">+ New list</button>
            </div>
          </div>
          <div class="chips" id="todoListsContainer">
            <!-- todo lists chips -->
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add task</h2>
          </div>
          <div class="row">
            <div>
              <label for="todoText">Task</label>
              <input type="text" id="todoText" placeholder="Example: Buy chicken, plan lesson, call mom..." />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="todoPriority">Priority</label>
              <select id="todoPriority">
                <option value="high">High</option>
                <option value="medium" selected>Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div>
              <label for="todoDueDate">Due date</label>
              <input type="date" id="todoDueDate" />
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addTodoBtn">+ Add task</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Tasks</h2>
          </div>
          <div class="list" id="todoList">
            <!-- todo items -->
          </div>
          <p class="muted" id="noTodoMsg" style="margin-top:0.3rem; display:none;">
            No tasks yet. Add one above.
          </p>
        </div>
      </section>

      <!-- SHOPPING -->
      <section class="page" id="page-shopping">
        <div class="page-header">
          <h1>Shopping</h1>
          <small>Multiple lists + notes per item</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Lists</h2>
            <button class="secondary" id="addShoppingListBtn">+ New list</button>
          </div>
          <div class="chips" id="shoppingListsContainer"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add item</h2>
          </div>
          <div class="row">
            <div>
              <label for="shoppingText">Item</label>
              <input type="text" id="shoppingText" placeholder="Example: chicken breast, yogurt, creatine..." />
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addShoppingBtn">+ Add item</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Items</h2>
          </div>
          <div class="list" id="shoppingList"></div>
          <p class="muted" id="noShoppingMsg" style="margin-top:0.3rem; display:none;">
            No items yet. Add one above.
          </p>
        </div>
      </section>

      <!-- WORKOUTS (simple for now) -->
      <section class="page" id="page-workouts">
        <div class="page-header">
          <h1>Workouts</h1>
          <small>Simple log (big revamp coming next)</small>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Add workout</h2>
          </div>
          <div class="row">
            <div>
              <label for="workoutName">Workout name</label>
              <input type="text" id="workoutName" placeholder="Example: Train A ‚Äì Chest & Triceps" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="workoutNotes">Notes (optional)</label>
              <textarea id="workoutNotes" placeholder="Short notes about this session..."></textarea>
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
            <button class="primary" id="addWorkoutBtn">+ Add workout</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>History</h2>
          </div>
          <div class="list" id="workoutList"></div>
          <p class="muted" id="noWorkoutMsg" style="margin-top:0.3rem; display:none;">
            No workouts logged yet.
          </p>
        </div>
      </section>

      <!-- FINANCE -->
      <section class="page" id="page-finance">
        <div class="page-header">
          <h1>Finance</h1>
          <small>Transactions + accounts</small>
        </div>

        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2>Add transaction</h2>
            </div>
            <div class="row">
              <div>
                <label for="financeType">Type</label>
                <select id="financeType">
                  <option value="expense">Expense</option>
                  <option value="income">Income</option>
                </select>
              </div>
              <div>
                <label for="financeAmount">Amount</label>
                <input type="number" step="0.01" id="financeAmount" placeholder="0.00" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeAccount">Account</label>
                <select id="financeAccount"></select>
              </div>
              <div>
                <label for="financeCategory">Category</label>
                <input type="text" id="financeCategory" placeholder="Food, Transport, Gym..." />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeMethod">Method</label>
                <input type="text" id="financeMethod" placeholder="Cash, card, scan..." />
              </div>
              <div>
                <label for="financeDate">Date</label>
                <input type="date" id="financeDate" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="financeNote">Note (optional)</label>
                <input type="text" id="financeNote" placeholder="Short note..." />
              </div>
            </div>
            <div style="display:flex; justify-content:flex-end; margin-top:0.3rem;">
              <button class="primary" id="addFinanceBtn">+ Add</button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Accounts</h2>
              <button class="secondary" id="addAccountBtn">+ Account</button>
            </div>
            <div class="list" id="accountsList"></div>
            <p class="muted" id="noAccountsMsg" style="margin-top:0.3rem; display:none;">
              No accounts yet. Add one above (e.g. "Main THB", "BRL savings", "USD card").
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Transactions</h2>
          </div>
          <div class="list" id="financeList"></div>
          <p class="muted" id="noFinanceMsg" style="margin-top:0.3rem; display:none;">
            No transactions yet.
          </p>
        </div>
      </section>

      <!-- NOTES placeholder -->
      <section class="page" id="page-notes">
        <div class="page-header">
          <h1>Notes</h1>
          <small>Quick notes & freehand ideas (coming soon)</small>
        </div>
        <div class="card">
          <p class="muted">
            This page will become your quick notepad: fast text notes and later a
            freehand/drawing mode. For now it's a placeholder so the structure is ready.
          </p>
        </div>
      </section>

      <!-- MEALS placeholder -->
      <section class="page" id="page-meals">
        <div class="page-header">
          <h1>Meal Tracker</h1>
          <small>Macros and food logs (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            In future versions, this page will let you log your meals and calculate macros.
            It might even support reading from images. For now, it's just a stub.
          </p>
        </div>
      </section>

      <!-- CALENDAR placeholder -->
      <section class="page" id="page-calendar">
        <div class="page-header">
          <h1>Calendar</h1>
          <small>Important days & recurring bills (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            The idea: show only what's important for you ‚Äì tasks, recurring bills, and key
            reminders ‚Äì instead of every small birthday. We'll connect this to To-do and Finance later.
          </p>
        </div>
      </section>

      <!-- ANALYTICS placeholder -->
      <section class="page" id="page-analytics">
        <div class="page-header">
          <h1>Analytics</h1>
          <small>Crossing all your data (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            Here you'll eventually see things like: expenses vs weight, shopping vs workout
            frequency, and other KPIs. For now this is a placeholder so the navigation feels complete.
          </p>
        </div>
      </section>

      <!-- SETTINGS placeholder -->
      <section class="page" id="page-settings">
        <div class="page-header">
          <h1>Settings</h1>
          <small>Theme, backup & more (future)</small>
        </div>
        <div class="card">
          <p class="muted">
            In the future this page will hold dark mode toggle, data export/import,
            and backup options. For now, it's a simple stub.
          </p>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal for editing todo and shopping notes -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="modal">
      <div class="modal-header">
        <h3 id="modalTitle">Edit</h3>
        <button class="icon-btn" id="modalCloseBtn">‚úï</button>
      </div>
      <div id="modalBody"></div>
      <div class="modal-actions">
        <button class="secondary" id="modalCancelBtn">Cancel</button>
        <button class="primary" id="modalSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <script>
    // MyHub v0.4.2 ‚Äì single-file front-end logic
  
    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const STORAGE_KEY = "myhub-state-v04";
  
    function formatDate(iso) {
      if (!iso) return "No date";
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "No date";
      return d.toLocaleDateString();
    }
  
    function confirmDelete() {
      return confirm("Delete this item? This action cannot be undone.");
    }
  
    // ---------- State ----------
    const defaultState = {
      theme: "dark",
      currentPage: "home",
      // To-do
      todoLists: [
        { id: "list-personal", name: "Personal", createdAt: new Date().toISOString() }
      ],
      todos: [],
      // Shopping
      shoppingLists: [
        { id: "shop-main", name: "Main list", createdAt: new Date().toISOString() }
      ],
      shoppingItems: [],
      // Workouts
      workouts: [],
      // Finance
      accounts: [],
      finance: [],
      activeFinanceAccountId: null
    };
  
    let state;
  
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          state = structuredClone(defaultState);
          return;
        }
        const parsed = JSON.parse(raw);
        state = Object.assign(structuredClone(defaultState), parsed);
      } catch (e) {
        console.error("Error loading state", e);
        state = structuredClone(defaultState);
      }
    }
  
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("Error saving state", e);
      }
    }
  
    // ---------- Navigation ----------
    function setPage(page) {
      state.currentPage = page;
      saveState();
  
      $$(".page").forEach((el) => {
        if (el.dataset.page === page) {
          el.classList.remove("hidden");
        } else {
          el.classList.add("hidden");
        }
      });
  
      $$(".nav-item").forEach((el) => {
        if (el.dataset.page === page) {
          el.classList.add("nav-active");
        } else {
          el.classList.remove("nav-active");
        }
      });
  
      const headerTitle = $("pageTitle");
      if (headerTitle) {
        const mapping = {
          home: "Home",
          todo: "To-Do",
          shopping: "Shopping",
          workouts: "Workouts",
          finance: "Finances",
          notes: "Notes",
          meals: "Meals",
          calendar: "Calendar",
          analytics: "Analytics"
        };
        headerTitle.textContent = mapping[page] || "MyHub";
      }
    }
  
    // attach listeners to sidebar buttons
    function setupNav() {
      $$(".nav-item").forEach((btn) => {
        btn.addEventListener("click", () => {
          const page = btn.dataset.page;
          if (page) setPage(page);
        });
      });
  
      const homeQuick = $("homeQuickTaskBtn");
      if (homeQuick) {
        homeQuick.addEventListener("click", () => {
          const input = $("homeQuickTaskInput");
          if (!input) return;
          const text = input.value.trim();
          if (!text) return;
          addTodoFromHome(text);
          input.value = "";
        });
      }
    }
  
    // ---------- To-do Lists ----------
    const todoListSelect = $("todoListSelect");
    const todoListNameInput = $("todoListName");
    const todoNewListBtn = $("todoNewListBtn");
    const todoTitleInput = $("todoTitleInput");
    const todoPrioritySelect = $("todoPrioritySelect");
    const todoDueDateInput = $("todoDueDate");
    const todoListContainer = $("todoList");
    const todoEmptyMsg = $("noTodosMsg");
    const todoSearchInput = $("todoSearchInput");
    const todoFilterPriority = $("todoFilterPriority");
    const todoFilterStatus = $("todoFilterStatus");
    const todoFilterList = $("todoFilterList");
  
    function getActiveTodoListId() {
      return todoListSelect.value || (state.todoLists[0] && state.todoLists[0].id);
    }
  
    function renderTodoListOptions() {
      const selects = [todoListSelect, todoFilterList].filter(Boolean);
      selects.forEach((sel) => {
        sel.innerHTML = "";
        state.todoLists.forEach((list) => {
          const opt = document.createElement("option");
          opt.value = list.id;
          opt.textContent = list.name;
          sel.appendChild(opt);
        });
      });
  
      if (!state.todoLists.length) return;
      if (!todoListSelect.value) {
        todoListSelect.value = state.todoLists[0].id;
      }
    }
  
    function addTodoList() {
      const name = todoListNameInput.value.trim();
      if (!name) return;
      const id = "list-" + Date.now();
      state.todoLists.push({ id, name, createdAt: new Date().toISOString() });
      saveState();
      todoListNameInput.value = "";
      renderTodoListOptions();
      todoListSelect.value = id;
      renderTodos();
    }
  
    if (todoNewListBtn) {
      todoNewListBtn.addEventListener("click", addTodoList);
    }
  
    function addTodo() {
      const title = todoTitleInput.value.trim();
      if (!title) return;
      const listId = getActiveTodoListId();
      const priority = todoPrioritySelect.value || "medium";
      let dueIso = null;
      if (todoDueDateInput.value) {
        dueIso = new Date(todoDueDateInput.value + "T00:00:00").toISOString();
      }
      const todo = {
        id: "todo-" + Date.now(),
        listId,
        title,
        priority,
        dueDate: dueIso,
        status: "open", // open | inprogress | done
        createdAt: new Date().toISOString(),
        completedAt: null
      };
      state.todos.unshift(todo);
      saveState();
      todoTitleInput.value = "";
      renderTodos();
    }
  
    if (todoTitleInput) {
      todoTitleInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          addTodo();
        }
      });
    }
    $("addTodoBtn")?.addEventListener("click", addTodo);
  
    function updateTodoStatus(id, newStatus) {
      const t = state.todos.find((x) => x.id === id);
      if (!t) return;
      t.status = newStatus;
      t.completedAt = newStatus === "done" ? new Date().toISOString() : null;
      saveState();
      renderTodos();
    }
  
    function openEditTodo(todo) {
      const newTitle = prompt("Edit task title:", todo.title);
      if (newTitle === null) return;
      const trimmed = newTitle.trim();
      if (trimmed) todo.title = trimmed;
  
      const newDate = prompt(
        "Edit due date (YYYY-MM-DD) or leave blank:",
        todo.dueDate ? todo.dueDate.slice(0, 10) : ""
      );
      if (newDate !== null) {
        if (newDate.trim()) {
          todo.dueDate = new Date(newDate.trim() + "T00:00:00").toISOString();
        } else {
          todo.dueDate = null;
        }
      }
      saveState();
      renderTodos();
    }
  
    function deleteTodo(id) {
      if (!confirmDelete()) return;
      state.todos = state.todos.filter((t) => t.id !== id);
      saveState();
      renderTodos();
    }
  
    function applyTodoFilters(arr) {
      let result = [...arr];
  
      const q = (todoSearchInput?.value || "").trim().toLowerCase();
      if (q) {
        result = result.filter((t) => t.title.toLowerCase().includes(q));
      }
  
      const prio = todoFilterPriority?.value || "all";
      if (prio !== "all") {
        result = result.filter((t) => t.priority === prio);
      }
  
      const stat = todoFilterStatus?.value || "all";
      if (stat !== "all") {
        result = result.filter((t) => t.status === stat);
      }
  
      const listId = todoFilterList?.value || "all";
      if (listId !== "all") {
        result = result.filter((t) => t.listId === listId);
      }
  
      result.sort((a, b) => {
        // High priority first, then by due date, then open > inprogress > done
        const prioOrder = { high: 0, medium: 1, low: 2 };
        const pa = prioOrder[a.priority] ?? 1;
        const pb = prioOrder[b.priority] ?? 1;
        if (pa !== pb) return pa - pb;
  
        const da = a.dueDate ? new Date(a.dueDate).getTime() : Infinity;
        const db = b.dueDate ? new Date(b.dueDate).getTime() : Infinity;
        if (da !== db) return da - db;
  
        const statusOrder = { open: 0, inprogress: 1, done: 2 };
        return (statusOrder[a.status] ?? 0) - (statusOrder[b.status] ?? 0);
      });
  
      return result;
    }
  
    function renderTodos() {
      if (!todoListContainer) return;
      const all = state.todos;
      const filtered = applyTodoFilters(all);
  
      if (!filtered.length) {
        todoListContainer.innerHTML = "";
        if (todoEmptyMsg) todoEmptyMsg.style.display = "block";
        return;
      }
      if (todoEmptyMsg) todoEmptyMsg.style.display = "none";
  
      todoListContainer.innerHTML = "";
      filtered.forEach((t) => {
        const row = document.createElement("div");
        row.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        // left: checkbox
        const left = document.createElement("div");
        left.className = "item-checkbox";
  
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = t.status === "done";
        cb.addEventListener("change", () => {
          updateTodoStatus(t.id, cb.checked ? "done" : "open");
        });
        left.appendChild(cb);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = t.title;
        if (t.status === "done") {
          title.style.textDecoration = "line-through";
          title.style.opacity = "0.7";
        }
        // click title to edit
        title.addEventListener("click", () => openEditTodo(t));
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const prioTag = document.createElement("span");
        prioTag.className = "tag";
        prioTag.textContent =
          t.priority === "high"
            ? "High"
            : t.priority === "low"
            ? "Low"
            : "Medium";
        meta.appendChild(prioTag);
  
        if (t.dueDate) {
          const due = document.createElement("span");
          due.className = "tag";
          due.textContent = "Due " + formatDate(t.dueDate);
          meta.appendChild(due);
        }
  
        const listRef = state.todoLists.find((l) => l.id === t.listId);
        if (listRef) {
          const listTag = document.createElement("span");
          listTag.className = "tag";
          listTag.textContent = listRef.name;
          meta.appendChild(listTag);
        }
  
        if (t.status === "inprogress") {
          const st = document.createElement("span");
          st.className = "tag";
          st.textContent = "In progress";
          meta.appendChild(st);
        }
  
        textWrap.appendChild(title);
        textWrap.appendChild(meta);
  
        main.appendChild(left);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const inProgBtn = document.createElement("button");
        inProgBtn.className = "icon-btn";
        inProgBtn.textContent = "‚è≥";
        inProgBtn.title = "Mark in progress";
        inProgBtn.addEventListener("click", () =>
          updateTodoStatus(t.id, "inprogress")
        );
  
        const editBtn = document.createElement("button");
        editBtn.className = "icon-btn";
        editBtn.textContent = "‚úèÔ∏è";
        editBtn.title = "Edit";
        editBtn.addEventListener("click", () => openEditTodo(t));
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete";
        delBtn.addEventListener("click", () => deleteTodo(t.id));
  
        actions.appendChild(inProgBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
  
        todoListContainer.appendChild(row);
      });
    }
  
    todoListSelect?.addEventListener("change", () => renderTodos());
    todoSearchInput?.addEventListener("input", renderTodos);
    todoFilterPriority?.addEventListener("change", renderTodos);
    todoFilterStatus?.addEventListener("change", renderTodos);
    todoFilterList?.addEventListener("change", renderTodos);
  
    function addTodoFromHome(text) {
      const listId = state.todoLists[0]?.id;
      if (!listId) return;
      const todo = {
        id: "todo-" + Date.now(),
        listId,
        title: text,
        priority: "medium",
        dueDate: null,
        status: "open",
        createdAt: new Date().toISOString(),
        completedAt: null
      };
      state.todos.unshift(todo);
      saveState();
      renderTodos();
    }
  
    // ---------- Shopping Lists ----------
    const shoppingListSelect = $("shoppingListSelect");
    const shoppingListNameInput = $("shoppingListName");
    const shoppingNewListBtn = $("shoppingNewListBtn");
    const shoppingItemInput = $("shoppingItemInput");
    const shoppingListEl = $("shoppingList");
    const shoppingEmptyMsg = $("shoppingEmptyMsg");
    let draggingShoppingId = null;
  
    function getActiveShoppingListId() {
      return shoppingListSelect.value || (state.shoppingLists[0] && state.shoppingLists[0].id);
    }
  
    function renderShoppingListOptions() {
      shoppingListSelect.innerHTML = "";
      state.shoppingLists.forEach((list) => {
        const opt = document.createElement("option");
        opt.value = list.id;
        opt.textContent = list.name;
        shoppingListSelect.appendChild(opt);
      });
      if (!state.shoppingLists.length) return;
      if (!shoppingListSelect.value) {
        shoppingListSelect.value = state.shoppingLists[0].id;
      }
    }
  
    function addShoppingList() {
      const name = shoppingListNameInput.value.trim();
      if (!name) return;
      const id = "shop-" + Date.now();
      state.shoppingLists.push({
        id,
        name,
        createdAt: new Date().toISOString()
      });
      saveState();
      shoppingListNameInput.value = "";
      renderShoppingListOptions();
      shoppingListSelect.value = id;
      renderShopping();
    }
  
    shoppingNewListBtn?.addEventListener("click", addShoppingList);
  
    function addShoppingItem() {
      const title = shoppingItemInput.value.trim();
      if (!title) return;
      const listId = getActiveShoppingListId();
      const item = {
        id: "shop-item-" + Date.now(),
        listId,
        title,
        checked: false,
        note: "",
        createdAt: new Date().toISOString()
      };
      state.shoppingItems.push(item);
      saveState();
      shoppingItemInput.value = "";
      renderShopping();
    }
  
    shoppingItemInput?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addShoppingItem();
      }
    });
    $("addShoppingBtn")?.addEventListener("click", addShoppingItem);
  
    function deleteShoppingItem(listId, itemId) {
      if (!confirmDelete()) return;
      state.shoppingItems = state.shoppingItems.filter(
        (i) => i.id !== itemId
      );
      saveState();
      renderShopping();
    }
  
    function toggleShoppingItem(id) {
      const item = state.shoppingItems.find((i) => i.id === id);
      if (!item) return;
      item.checked = !item.checked;
      saveState();
      renderShopping();
    }
  
    function openModalShoppingNote(item, listId) {
      const newNote = prompt("Note for this item:", item.note || "");
      if (newNote === null) return;
      item.note = newNote.trim();
      saveState();
      renderShopping();
    }
  
    function reorderShopping(listId, fromId, toId) {
      if (!fromId || !toId || fromId === toId) return;
      const arr = state.shoppingItems;
      const fromIdx = arr.findIndex(
        (i) => i.id === fromId && i.listId === listId
      );
      const toIdx = arr.findIndex(
        (i) => i.id === toId && i.listId === listId
      );
      if (fromIdx === -1 || toIdx === -1) return;
      const [moved] = arr.splice(fromIdx, 1);
      arr.splice(toIdx, 0, moved);
      saveState();
      renderShopping();
    }
  
    function renderShopping() {
      if (!shoppingListEl) return;
      const listId = getActiveShoppingListId();
      const items = state.shoppingItems.filter((i) => i.listId === listId);
  
      if (!items.length) {
        shoppingListEl.innerHTML = "";
        if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "block";
        return;
      }
      if (shoppingEmptyMsg) shoppingEmptyMsg.style.display = "none";
  
      shoppingListEl.innerHTML = "";
      items.forEach((item) => {
        const row = document.createElement("div");
        row.className = "item";
        row.dataset.itemId = item.id;
        row.draggable = true;
  
        row.addEventListener("dragstart", () => {
          draggingShoppingId = item.id;
        });
        row.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        row.addEventListener("drop", (e) => {
          e.preventDefault();
          const targetId = row.dataset.itemId;
          reorderShopping(listId, draggingShoppingId, targetId);
          draggingShoppingId = null;
        });
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const left = document.createElement("div");
        left.className = "item-checkbox";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.checked;
        cb.addEventListener("change", () => toggleShoppingItem(item.id));
        left.appendChild(cb);
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = item.title;
        if (item.checked) {
          title.style.textDecoration = "line-through";
          title.style.opacity = "0.7";
        }
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
        if (item.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Note";
          meta.appendChild(noteTag);
        }
  
        textWrap.appendChild(title);
        textWrap.appendChild(meta);
  
        main.appendChild(left);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const noteBtn = document.createElement("button");
        noteBtn.className = "icon-btn";
        noteBtn.textContent = "üìù";
        noteBtn.title = "Add / edit note";
        noteBtn.addEventListener("click", () =>
          openModalShoppingNote(item, listId)
        );
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete item";
        delBtn.addEventListener("click", () =>
          deleteShoppingItem(listId, item.id)
        );
  
        actions.appendChild(noteBtn);
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
  
        shoppingListEl.appendChild(row);
      });
    }
  
    shoppingListSelect?.addEventListener("change", renderShopping);
  
    // ---------- Workouts (simple log) ----------
    const workoutListEl = $("workoutList");
    const noWorkoutMsg = $("noWorkoutMsg");
  
    function addWorkout() {
      const name = $("workoutName")?.value.trim();
      const notes = $("workoutNotes")?.value.trim();
      if (!name) return;
      const w = {
        id: "w-" + Date.now(),
        name,
        notes,
        date: new Date().toISOString()
      };
      state.workouts.unshift(w);
      $("workoutName").value = "";
      $("workoutNotes").value = "";
      saveState();
      renderWorkouts();
    }
  
    $("addWorkoutBtn")?.addEventListener("click", addWorkout);
    $("workoutName")?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addWorkout();
      }
    });
  
    function deleteWorkout(id) {
      if (!confirmDelete()) return;
      state.workouts = state.workouts.filter((w) => w.id !== id);
      saveState();
      renderWorkouts();
    }
  
    function renderWorkouts() {
      if (!workoutListEl) return;
      if (!state.workouts.length) {
        workoutListEl.innerHTML = "";
        if (noWorkoutMsg) noWorkoutMsg.style.display = "block";
        return;
      }
      if (noWorkoutMsg) noWorkoutMsg.style.display = "none";
  
      workoutListEl.innerHTML = "";
      state.workouts.forEach((w) => {
        const item = document.createElement("div");
        item.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = w.name;
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const d = document.createElement("span");
        d.className = "tag";
        d.textContent = formatDate(w.date);
        meta.appendChild(d);
  
        if (w.notes) {
          const n = document.createElement("span");
          n.className = "tag";
          n.textContent = "Notes";
          meta.appendChild(n);
        }
  
        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete workout";
        delBtn.addEventListener("click", () => deleteWorkout(w.id));
  
        actions.appendChild(delBtn);
  
        item.appendChild(main);
        item.appendChild(actions);
        workoutListEl.appendChild(item);
      });
    }
  
    // ---------- Finance + Accounts (improved) ----------
    const accountsListEl = $("accountsList");
    const noAccountsMsg = $("noAccountsMsg");
    const financeListEl = $("financeList");
    const noFinanceMsg = $("noFinanceMsg");
    const financeAccountSelect = $("financeAccount");
  
    function renderAccounts() {
      if (!accountsListEl || !financeAccountSelect) return;
  
      const accounts = state.accounts;
      accountsListEl.innerHTML = "";
      financeAccountSelect.innerHTML = "";
  
      if (!accounts.length) {
        if (noAccountsMsg) noAccountsMsg.style.display = "block";
        state.activeFinanceAccountId = null;
      } else {
        if (noAccountsMsg) noAccountsMsg.style.display = "none";
        if (!state.activeFinanceAccountId) {
          state.activeFinanceAccountId = accounts[0].id;
        }
      }
  
      accounts.forEach((acc) => {
        const balance = state.finance
          .filter((tx) => tx.accountId === acc.id)
          .reduce((sum, tx) => {
            return sum + (tx.type === "income" ? tx.amount : -tx.amount);
          }, 0);
  
        const row = document.createElement("div");
        row.className = "item";
        if (state.activeFinanceAccountId === acc.id) {
          row.classList.add("selected-account");
        }
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        title.textContent = acc.name;
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const balTag = document.createElement("span");
        balTag.className = "tag";
        balTag.textContent = `Balance: ${balance.toFixed(2)}`;
        meta.appendChild(balTag);
  
        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete account";
        delBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteAccount(acc.id);
        });
  
        actions.appendChild(delBtn);
  
        row.appendChild(main);
        row.appendChild(actions);
  
        row.addEventListener("click", () => {
          state.activeFinanceAccountId = acc.id;
          saveState();
          renderAccounts();
          renderFinance();
        });
  
        accountsListEl.appendChild(row);
  
        const opt = document.createElement("option");
        opt.value = acc.id;
        opt.textContent = acc.name;
        financeAccountSelect.appendChild(opt);
      });
  
      if (accounts.length) {
        financeAccountSelect.value =
          state.activeFinanceAccountId || accounts[0].id;
      }
    }
  
    function addAccount() {
      const name = prompt("Account name (e.g. THB main, BRL savings):");
      if (!name) return;
      const acc = {
        id: "acc-" + Date.now(),
        name: name.trim()
      };
      state.accounts.push(acc);
      saveState();
      renderAccounts();
    }
  
    $("addAccountBtn")?.addEventListener("click", addAccount);
  
    function deleteAccount(id) {
      const used = state.finance.some((tx) => tx.accountId === id);
      if (used) {
        alert("This account has transactions and can't be deleted yet.");
        return;
      }
      if (!confirmDelete()) return;
      state.accounts = state.accounts.filter((a) => a.id !== id);
      if (state.activeFinanceAccountId === id) {
        state.activeFinanceAccountId =
          state.accounts[0]?.id || null;
      }
      saveState();
      renderAccounts();
      renderFinance();
    }
  
    function addFinance() {
      const type = $("financeType")?.value || "expense";
      const amountVal = $("financeAmount")?.value;
      const amount = parseFloat(amountVal);
      if (!amount || Number.isNaN(amount)) return;
  
      const accountId =
        $("financeAccount")?.value ||
        state.activeFinanceAccountId ||
        (state.accounts[0] && state.accounts[0].id);
  
      if (!accountId) {
        alert("Please create an account first.");
        return;
      }
  
      const category = $("financeCategory")?.value.trim() || "";
      const method = $("financeMethod")?.value.trim() || "";
  
      let dateIso;
      const dateStr = $("financeDate")?.value;
      if (!dateStr) {
        dateIso = new Date().toISOString();
      } else {
        dateIso = new Date(dateStr + "T00:00:00").toISOString();
      }
  
      const note = $("financeNote")?.value.trim() || "";
  
      const tx = {
        id: "tx-" + Date.now(),
        type,
        amount,
        accountId,
        category,
        method,
        date: dateIso,
        note
      };
  
      state.finance.unshift(tx);
  
      $("financeAmount").value = "";
      $("financeCategory").value = "";
      $("financeMethod").value = "";
      $("financeDate").value = "";
      $("financeNote").value = "";
  
      saveState();
      renderAccounts();
      renderFinance();
    }
  
    $("addFinanceBtn")?.addEventListener("click", addFinance);
    $("financeAmount")?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addFinance();
      }
    });
  
    function deleteFinance(id) {
      if (!confirmDelete()) return;
      state.finance = state.finance.filter((tx) => tx.id !== id);
      saveState();
      renderAccounts();
      renderFinance();
    }
  
    function renderFinance() {
      if (!financeListEl) return;
  
      let txs = state.finance;
      if (state.activeFinanceAccountId) {
        txs = txs.filter(
          (tx) => tx.accountId === state.activeFinanceAccountId
        );
      }
  
      if (!txs.length) {
        financeListEl.innerHTML = "";
        if (noFinanceMsg) noFinanceMsg.style.display = "block";
        return;
      }
      if (noFinanceMsg) noFinanceMsg.style.display = "none";
  
      const accountMap = {};
      state.accounts.forEach((a) => {
        accountMap[a.id] = a.name;
      });
  
      financeListEl.innerHTML = "";
  
      txs.forEach((tx) => {
        const item = document.createElement("div");
        item.className = "item";
  
        const main = document.createElement("div");
        main.className = "item-main";
  
        const textWrap = document.createElement("div");
        textWrap.className = "item-text";
  
        const title = document.createElement("div");
        title.className = "item-title";
        const sign = tx.type === "income" ? "+" : "-";
        title.textContent = `${sign}${tx.amount.toFixed(2)} (${tx.category || "No category"})`;
  
        const meta = document.createElement("div");
        meta.className = "item-meta";
  
        const typeTag = document.createElement("span");
        typeTag.className =
          "tag " + (tx.type === "income" ? "tag-income" : "tag-expense");
        typeTag.textContent = tx.type === "income" ? "Income" : "Expense";
        meta.appendChild(typeTag);
  
        const accTag = document.createElement("span");
        accTag.className = "tag";
        accTag.textContent = accountMap[tx.accountId] || "Unknown account";
        meta.appendChild(accTag);
  
        const methodTag = document.createElement("span");
        methodTag.className = "tag";
        methodTag.textContent = tx.method || "Method ?";
        meta.appendChild(methodTag);
  
        const dateTag = document.createElement("span");
        dateTag.className = "tag";
        dateTag.textContent = formatDate(tx.date);
        meta.appendChild(dateTag);
  
        if (tx.note) {
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Note";
          meta.appendChild(noteTag);
        }
  
        textWrap.appendChild(title);
        textWrap.appendChild(meta);
        main.appendChild(textWrap);
  
        const actions = document.createElement("div");
        actions.className = "item-actions";
  
        const delBtn = document.createElement("button");
        delBtn.className = "icon-btn danger";
        delBtn.textContent = "üóë";
        delBtn.title = "Delete transaction";
        delBtn.addEventListener("click", () => deleteFinance(tx.id));
  
        actions.appendChild(delBtn);
  
        item.appendChild(main);
        item.appendChild(actions);
        financeListEl.appendChild(item);
      });
    }
  
    // ---------- Init ----------
    function init() {
      loadState();
  
      // show version text if there's a span
      const verEl = $("appVersion");
      if (verEl) verEl.textContent = "v0.4.2";
  
      setupNav();
  
      renderTodoListOptions();
      renderTodos();
  
      renderShoppingListOptions();
      renderShopping();
  
      renderWorkouts();
      renderAccounts();
      renderFinance();
  
      setPage(state.currentPage || "home");
    }
  
    window.addEventListener("load", init);
  </script>
</body>
</html>


