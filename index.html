<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MyHub v0.3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#020617" />
  <link rel="icon" href="icon-192.png" />
  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #0f172a;
      --bg-elevated-softer: #111827;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.18);
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #ef4444;
      --border: #1f2937;
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 6px;
      --shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617 0, #000 55%);
      color: var(--text);
      overscroll-behavior-y: none;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app-root {
      height: 100vh;
      width: 100%;
      max-width: 820px;
      display: flex;
      padding: 10px;
    }

    .app-shell {
      display: flex;
      gap: 8px;
      width: 100%;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #020617, #020617);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      border: 1px solid rgba(15, 23, 42, 0.9);
    }

    /* SIDEBAR */

    .sidebar {
      width: 220px;
      background: radial-gradient(circle at top, #020617, #020617 60%, #020617);
      border-right: 1px solid var(--border);
      padding: 10px 10px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
    }

    .sidebar-title {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .sidebar-badge {
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
    }

    .sidebar-version {
      font-size: 0.72rem;
      color: var(--text-soft);
      padding: 2px 4px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.7);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .sidebar-version-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .nav-section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #6b7280;
      margin-bottom: 4px;
      margin-top: 4px;
    }

    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 6px 8px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      color: var(--text-soft);
      background: transparent;
      transition: 0.16s ease;
    }

    .nav-item-icon {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border);
      font-size: 0.9rem;
    }

    .nav-item-label {
      flex: 1;
      text-align: left;
    }

    .nav-item.active {
      border-color: rgba(59, 130, 246, 0.7);
      background: radial-gradient(circle at left, #1e3a8a, #020617);
      color: #e5edff;
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.6);
      transform: translateY(-1px);
    }

    .nav-footer {
      margin-top: auto;
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .nav-footer span {
      opacity: 0.8;
    }

    /* COLLAPSED SIDEBAR FOR MOBILE */

    .sidebar-collapsed {
      width: 56px;
      padding-inline: 6px;
    }

    .sidebar-collapsed .nav-item-label,
    .sidebar-collapsed .nav-section-label,
    .sidebar-collapsed .sidebar-badge,
    .sidebar-collapsed .sidebar-version {
      display: none;
    }

    .sidebar-collapsed .sidebar-title {
      font-size: 0.9rem;
    }

    /* MAIN AREA */

    .app-main {
      flex: 1;
      background: radial-gradient(circle at top, #020617, #000 80%);
      padding: 8px 10px 10px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .topbar-title {
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .topbar-view-label {
      font-size: 0.92rem;
      font-weight: 500;
      color: #e5e7eb;
    }

    .btn,
    button {
      font-family: inherit;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 9px;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      cursor: pointer;
      transition: 0.16s ease;
    }

    .btn.icon {
      width: 30px;
      height: 30px;
      padding: 0;
      justify-content: center;
    }

    .btn.primary {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #eef2ff;
      border-color: rgba(59, 130, 246, 0.8);
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.7);
    }

    .btn.small {
      padding: 4px 8px;
      font-size: 0.72rem;
    }

    .btn:hover {
      transform: translateY(-0.5px);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.9);
    }

    .btn.primary:hover {
      box-shadow: 0 5px 16px rgba(37, 99, 235, 0.85);
    }

    .app-content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 6px;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    .card {
      background: radial-gradient(circle at top, #020617, #020617 70%, #020617);
      border-radius: var(--radius-lg);
      padding: 10px 11px 9px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.9);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 0.96rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      display: inline-flex;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background: var(--accent-soft);
      color: var(--accent);
    }

    .card-subtitle {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .row {
      display: flex;
      gap: 6px;
    }

    .row > * {
      flex: 1;
    }

    input,
    select,
    textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text);
      padding: 6px 8px;
      font-size: 0.8rem;
      outline: none;
      transition: 0.16s ease;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(59, 130, 246, 0.7);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .list-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.97);
      padding: 6px 7px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 0.78rem;
    }

    .list-item-main {
      flex: 1;
      min-width: 0;
    }

    .list-item-title {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .list-item-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 1px 6px;
      font-size: 0.68rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip.high {
      border-color: rgba(239, 68, 68, 0.7);
      color: #fecaca;
    }

    .chip.done {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .chip.half {
      border-color: rgba(234, 179, 8, 0.7);
      color: #fef3c7;
    }

    .chip.overdue {
      border-color: rgba(248, 113, 113, 0.85);
      color: #fecaca;
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .btn-ghost {
      border-radius: 999px;
      border: none;
      background: transparent;
      font-size: 0.7rem;
      color: var(--text-soft);
      cursor: pointer;
      padding: 2px 4px;
    }

    .btn-ghost.danger {
      color: var(--danger);
    }

    .filter-panel {
      margin-bottom: 6px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.99);
      padding: 6px;
      font-size: 0.76rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .filter-panel-row {
      display: flex;
      gap: 6px;
    }

    .filter-panel-row > * {
      flex: 1;
    }

    .filter-panel-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 2px;
    }

    .hidden {
      display: none !important;
    }

    /* Home dashboard */

    .home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 6px;
    }

    .home-module {
      border-radius: 14px;
      border: 1px solid var(--border);
      background: radial-gradient(circle at top left, #0b1120, #020617);
      padding: 8px 8px 6px;
      cursor: pointer;
      transition: 0.16s ease;
    }

    .home-module:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.9);
    }

    .home-module-title {
      font-size: 0.8rem;
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .home-module-count {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .today-tasks-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.76rem;
    }

    .today-tasks-item {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      padding: 4px 6px;
      border-radius: var(--radius-md);
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid var(--border);
    }

    .today-tasks-title {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .today-tasks-meta {
      font-size: 0.7rem;
      color: var(--text-soft);
      white-space: nowrap;
      padding-left: 4px;
    }

    /* To-do lists header */

    .todo-lists-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
    }

    .todo-lists-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .todo-list-chip {
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 0.7rem;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .todo-list-chip.active {
      border-color: rgba(59, 130, 246, 0.7);
      color: #dbeafe;
      background: rgba(15, 23, 42, 1);
    }

    .todo-list-chip span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* Sidebar overlay for mobile */

    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      z-index: 8;
    }

    .sidebar-mobile {
      position: fixed;
      top: 10px;
      bottom: 10px;
      left: 10px;
      z-index: 9;
      max-width: 260px;
    }

    .app-root.sidebar-open .sidebar-overlay {
      display: block;
    }

    /* Responsive */

    @media (max-width: 768px) {
      .app-root {
        padding: 6px;
      }

      .app-shell {
        border-radius: 16px;
      }

      .sidebar {
        display: none;
      }

      .sidebar.desktop-only {
        display: none;
      }

      .sidebar.mobile-sheet {
        display: flex;
      }

      .topbar-title {
        font-size: 0.85rem;
      }
    }

    @media (min-width: 769px) {
      .sidebar-overlay,
      .sidebar.mobile-sheet {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="app-root" id="app-root">
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="app-shell">
      <!-- DESKTOP SIDEBAR -->
      <aside class="sidebar desktop-only sidebar-collapsed" id="sidebar-desktop">
        <div class="sidebar-header">
          <div class="sidebar-title">MyHub</div>
        </div>
        <div class="sidebar-version">
          <span class="sidebar-version-dot"></span>
          v0.3 ¬∑ local only
        </div>

        <div class="nav-section-label">Core</div>
        <ul class="nav-list">
          <li class="nav-item active" data-view="home">
            <div class="nav-item-icon">üè†</div>
            <div class="nav-item-label">Home</div>
          </li>
          <li class="nav-item" data-view="todo">
            <div class="nav-item-icon">‚úÖ</div>
            <div class="nav-item-label">To-Do</div>
          </li>
          <li class="nav-item" data-view="shopping">
            <div class="nav-item-icon">üõí</div>
            <div class="nav-item-label">Shopping</div>
          </li>
          <li class="nav-item" data-view="workouts">
            <div class="nav-item-icon">üèãÔ∏è</div>
            <div class="nav-item-label">Workouts</div>
          </li>
          <li class="nav-item" data-view="finance">
            <div class="nav-item-icon">üí∞</div>
            <div class="nav-item-label">Finance</div>
          </li>
        </ul>

        <div class="nav-footer">
          <span>MyHub</span>
          <span>v0.3</span>
        </div>
      </aside>

      <!-- MOBILE SIDEBAR SHEET -->
      <aside class="sidebar mobile-sheet sidebar-collapsed" id="sidebar-mobile">
        <div class="sidebar-header">
          <div class="sidebar-title">MyHub</div>
        </div>
        <div class="sidebar-version">
          <span class="sidebar-version-dot"></span>
          v0.3 ¬∑ local only
        </div>
        <div class="nav-section-label">Core</div>
        <ul class="nav-list">
          <li class="nav-item active" data-view="home">
            <div class="nav-item-icon">üè†</div>
            <div class="nav-item-label">Home</div>
          </li>
          <li class="nav-item" data-view="todo">
            <div class="nav-item-icon">‚úÖ</div>
            <div class="nav-item-label">To-Do</div>
          </li>
          <li class="nav-item" data-view="shopping">
            <div class="nav-item-icon">üõí</div>
            <div class="nav-item-label">Shopping</div>
          </li>
          <li class="nav-item" data-view="workouts">
            <div class="nav-item-icon">üèãÔ∏è</div>
            <div class="nav-item-label">Workouts</div>
          </li>
          <li class="nav-item" data-view="finance">
            <div class="nav-item-icon">üí∞</div>
            <div class="nav-item-label">Finance</div>
          </li>
        </ul>
        <div class="nav-footer">
          <span>MyHub</span>
          <span>v0.3</span>
        </div>
      </aside>

      <!-- MAIN AREA -->
      <div class="app-main">
        <div class="topbar">
          <div class="topbar-left">
            <button class="btn icon" id="btn-hamburger" title="Menu">
              ‚ò∞
            </button>
            <div>
              <div class="topbar-title">MyHub ‚Ä¢ Personal OS</div>
              <div class="topbar-view-label" id="current-view-label">
                Home
              </div>
            </div>
          </div>
          <button class="btn small" id="btn-quick-add">
            + Quick task
          </button>
        </div>

        <div class="app-content">
          <main>
            <!-- HOME -->
            <section id="home-section" class="active">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">
                    <span class="icon">üìÖ</span>
                    Today overview
                  </div>
                </div>
                <div class="card-subtitle">
                  A quick snapshot of your tasks, spending and routines for
                  today.
                </div>

                <div class="home-grid">
                  <div class="home-module" data-jump="todo">
                    <div class="home-module-title">
                      <span>To-Dos</span>
                      <span class="home-module-count" id="home-todo-count">
                        ‚Äì
                      </span>
                    </div>
                    <div class="card-subtitle">
                      Due or overdue tasks across all lists.
                    </div>
                  </div>

                  <div class="home-module" data-jump="finance">
                    <div class="home-module-title">
                      <span>Finance</span>
                      <span
                        class="home-module-count"
                        id="home-finance-count"
                      >
                        ‚Äì
                      </span>
                    </div>
                    <div class="card-subtitle">
                      Entries logged this month.
                    </div>
                  </div>

                  <div class="home-module" data-jump="workouts">
                    <div class="home-module-title">
                      <span>Workout</span>
                      <span
                        class="home-module-count"
                        id="home-workout-count"
                      >
                        ‚Äì
                      </span>
                    </div>
                    <div class="card-subtitle">
                      Last recorded workout day.
                    </div>
                  </div>

                  <div class="home-module" data-jump="shopping">
                    <div class="home-module-title">
                      <span>Shopping</span>
                      <span
                        class="home-module-count"
                        id="home-shopping-count"
                      >
                        ‚Äì
                      </span>
                    </div>
                    <div class="card-subtitle">
                      Items still pending in your active list.
                    </div>
                  </div>
                </div>

                <div class="card-subtitle" style="margin-top: 4px;">
                  Quick task for today (default list):
                </div>
                <form
                  id="quick-task-form"
                  class="row"
                  style="margin-bottom: 6px;"
                >
                  <input
                    type="text"
                    id="quick-task-text"
                    placeholder="Quick task (auto due today)"
                  />
                  <button type="submit" class="btn primary small">
                    Add
                  </button>
                </form>

                <ul class="today-tasks-list" id="today-tasks-list"></ul>
              </div>
            </section>

            <!-- TO-DO -->
            <section id="todo-section">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">
                    <span class="icon">‚úÖ</span>
                    To-Do Lists
                  </div>
                  <button
                    type="button"
                    id="todo-filter-toggle"
                    class="btn icon"
                    title="Filters"
                  >
                    üîç
                  </button>
                </div>

                <div class="todo-lists-header">
                  <div
                    class="todo-lists-chips"
                    id="todo-lists-container"
                  ></div>
                  <button
                    type="button"
                    id="todo-add-list"
                    class="btn small"
                  >
                    + List
                  </button>
                </div>

                <div
                  class="filter-panel hidden"
                  id="todo-filter-panel"
                >
                  <div class="filter-panel-row">
                    <select id="todo-filter-status">
                      <option value="all">Status: All</option>
                      <option value="todo">Not done</option>
                      <option value="half">Half done</option>
                      <option value="done">Done</option>
                    </select>
                    <select id="todo-filter-priority">
                      <option value="all">Priority: All</option>
                      <option value="high">High only</option>
                      <option value="medium">Medium</option>
                      <option value="low">Low</option>
                    </select>
                  </div>
                  <div class="filter-panel-row">
                    <select id="todo-filter-sort">
                      <option value="smart">
                        Sort: Smart (priority + due)
                      </option>
                      <option value="dueAsc">
                        Sort: Due date ‚Üë
                      </option>
                      <option value="dueDesc">
                        Sort: Due date ‚Üì
                      </option>
                    </select>
                    <input
                      type="text"
                      id="todo-filter-text"
                      placeholder="Search text"
                    />
                  </div>
                  <div class="filter-panel-actions">
                    <button
                      type="button"
                      id="todo-filter-clear"
                      class="btn small"
                    >
                      Clear
                    </button>
                    <button
                      type="button"
                      id="todo-filter-apply"
                      class="btn primary small"
                    >
                      Apply
                    </button>
                  </div>
                </div>

                <div class="card-subtitle">
                  v0.3: multiple lists + inline editing. Future versions will add
                  calendar links and deeper stats.
                </div>

                <form id="todo-form" style="margin-bottom: 8px;">
                  <input
                    type="text"
                    id="todo-text"
                    placeholder="New task..."
                    required
                    style="margin-bottom: 4px;"
                  />
                  <div class="row">
                    <select id="todo-priority">
                      <option value="medium">Medium priority</option>
                      <option value="high">High priority</option>
                      <option value="low">Low priority</option>
                    </select>
                    <input type="date" id="todo-due" />
                  </div>
                </form>

                <ul class="list" id="todo-list"></ul>
              </div>
            </section>

            <!-- SHOPPING -->
            <section id="shopping-section">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">
                    <span class="icon">üõí</span>
                    Shopping List
                  </div>
                </div>
                <div class="card-subtitle">
                  Single list with drag & drop. v0.4 will add multiple lists and
                  price tracking.
                </div>

                <form id="shopping-form" style="margin-bottom: 8px;">
                  <input
                    type="text"
                    id="shopping-text"
                    placeholder="New item..."
                    required
                  />
                </form>

                <ul class="list" id="shopping-list"></ul>
              </div>
            </section>

            <!-- WORKOUTS -->
            <section id="workouts-section">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">
                    <span class="icon">üèãÔ∏è</span>
                    Workouts (basic logs)
                  </div>
                </div>
                <div class="card-subtitle">
                  Simple per-day notes for now. Later this will become full
                  workout templates and graphs.
                </div>

                <form id="workout-form" style="margin-bottom: 8px;">
                  <input
                    type="text"
                    id="workout-text"
                    placeholder="Workout note (e.g., Workout B ‚Äì legs, 60min)"
                    required
                  />
                </form>

                <ul class="list" id="workout-list"></ul>
              </div>
            </section>

            <!-- FINANCE -->
            <section id="finance-section">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">
                    <span class="icon">üí∞</span>
                    Finance (basic logs)
                  </div>
                </div>
                <div class="card-subtitle">
                  v0.3 keeps simple logging. v0.5 will add accounts, recurring
                  bills and better analysis.
                </div>

                <form id="finance-form" style="margin-bottom: 8px;">
                  <div class="row" style="margin-bottom: 4px;">
                    <input
                      type="number"
                      step="0.01"
                      id="finance-amount"
                      placeholder="Amount"
                      required
                    />
                    <select id="finance-type">
                      <option value="expense">Expense</option>
                      <option value="income">Income</option>
                    </select>
                  </div>
                  <div class="row" style="margin-bottom: 4px;">
                    <input
                      type="text"
                      id="finance-category"
                      placeholder="Category (e.g., Food, Rent)"
                    />
                    <input type="date" id="finance-date" />
                  </div>
                  <input
                    type="text"
                    id="finance-note"
                    placeholder="Note (optional)"
                  />
                </form>

                <ul class="list" id="finance-list"></ul>
              </div>
            </section>
          </main>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =============================
    // Storage & State (v0.3)
    // =============================
    const STORAGE_KEY = "myhub-data-v0.3";

    const defaultState = {
      tasksLists: [],
      activeTaskListId: null,
      shoppingItems: [],
      workouts: [],
      finances: [],
    };

    function migrateLegacyState(parsed) {
      // v0.2 had: tasks (array), shoppingItems, workouts, finances
      const tasksLists = [];
      let activeTaskListId = null;

      if (Array.isArray(parsed.tasksLists) && parsed.tasksLists.length) {
        parsed.tasksLists.forEach((lst) => {
          tasksLists.push({
            id: lst.id || (crypto.randomUUID ? crypto.randomUUID() : Date.now().toString()),
            name: lst.name || "List",
            tasks: Array.isArray(lst.tasks) ? lst.tasks : [],
          });
        });
        activeTaskListId = parsed.activeTaskListId || (tasksLists[0] && tasksLists[0].id) || null;
      } else {
        const legacyTasks = Array.isArray(parsed.tasks) ? parsed.tasks : [];
        const defaultId = crypto.randomUUID ? crypto.randomUUID() : "list-main";
        tasksLists.push({
          id: defaultId,
          name: "Main",
          tasks: legacyTasks,
        });
        activeTaskListId = defaultId;
      }

      return {
        tasksLists,
        activeTaskListId,
        shoppingItems: Array.isArray(parsed.shoppingItems)
          ? parsed.shoppingItems
          : [],
        workouts: Array.isArray(parsed.workouts) ? parsed.workouts : [],
        finances: Array.isArray(parsed.finances) ? parsed.finances : [],
      };
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          // Try older version key
          const legacyRaw = localStorage.getItem("myhub-data-v0.2");
          if (legacyRaw) {
            const parsedLegacy = JSON.parse(legacyRaw);
            return migrateLegacyState(parsedLegacy);
          }
          return structuredClone(defaultState);
        }
        const parsed = JSON.parse(raw);
        return migrateLegacyState(parsed);
      } catch (e) {
        console.error("Failed to parse state:", e);
        return structuredClone(defaultState);
      }
    }

    let state = loadState();

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      refreshHomeDashboard();
    }

    function ensureAtLeastOneList() {
      if (!state.tasksLists.length) {
        const id = crypto.randomUUID ? crypto.randomUUID() : "list-main";
        state.tasksLists.push({
          id,
          name: "Personal",
          tasks: [],
        });
        state.activeTaskListId = id;
      } else if (!state.activeTaskListId) {
        state.activeTaskListId = state.tasksLists[0].id;
      }
    }

    function getActiveTaskList() {
      ensureAtLeastOneList();
      let list = state.tasksLists.find((l) => l.id === state.activeTaskListId);
      if (!list) {
        list = state.tasksLists[0];
        state.activeTaskListId = list.id;
      }
      return list;
    }

    function getActiveTasksArray() {
      return getActiveTaskList().tasks;
    }

    function getAllTasksAcrossLists() {
      return state.tasksLists.flatMap((l) =>
        (l.tasks || []).map((t) => ({ ...t, _listId: l.id }))
      );
    }

    // =============================
    // Navigation + Sidebar
    // =============================
    const appRoot = document.getElementById("app-root");
    const sidebarDesktop = document.getElementById("sidebar-desktop");
    const sidebarMobile = document.getElementById("sidebar-mobile");
    const sidebarOverlay = document.getElementById("sidebar-overlay");
    const hamburgerBtn = document.getElementById("btn-hamburger");
    const currentViewLabel = document.getElementById("current-view-label");
    const quickAddBtn = document.getElementById("btn-quick-add");

    const sections = {
      home: document.getElementById("home-section"),
      todo: document.getElementById("todo-section"),
      shopping: document.getElementById("shopping-section"),
      workouts: document.getElementById("workouts-section"),
      finance: document.getElementById("finance-section"),
    };

    let currentView = "home";

    function setActiveNav(view) {
      document
        .querySelectorAll(".nav-item")
        .forEach((el) =>
          el.classList.toggle(
            "active",
            el.getAttribute("data-view") === view
          )
        );
      const labelMap = {
        home: "Home",
        todo: "To-Do",
        shopping: "Shopping",
        workouts: "Workouts",
        finance: "Finance",
      };
      currentViewLabel.textContent = labelMap[view] || "MyHub";
    }

    function showView(view, push = true) {
      if (!sections[view]) view = "home";
      currentView = view;
      Object.entries(sections).forEach(([k, el]) => {
        el.classList.toggle("active", k === view);
      });
      setActiveNav(view);
      if (push) {
        history.pushState({ view }, "", "#" + view);
      }
      // Close mobile sidebar if open
      closeSidebar();
    }

    document.querySelectorAll(".nav-item").forEach((el) => {
      el.addEventListener("click", () => {
        const view = el.getAttribute("data-view");
        if (view !== currentView) {
          showView(view, true);
        }
      });
    });

    document.querySelectorAll(".home-module").forEach((mod) => {
      mod.addEventListener("click", () => {
        const view = mod.getAttribute("data-jump");
        showView(view, true);
      });
    });

    hamburgerBtn.addEventListener("click", () => {
      toggleSidebar();
    });

    sidebarOverlay.addEventListener("click", () => {
      closeSidebar();
    });

    function openSidebar() {
      appRoot.classList.add("sidebar-open");
    }

    function closeSidebar() {
      appRoot.classList.remove("sidebar-open");
    }

    function toggleSidebar() {
      if (appRoot.classList.contains("sidebar-open")) {
        closeSidebar();
      } else {
        openSidebar();
      }
    }

    // Simple edge swipe (mobile)
    let touchStartX = null;
    appRoot.addEventListener("touchstart", (e) => {
      if (e.touches.length !== 1) return;
      touchStartX = e.touches[0].clientX;
    });

    appRoot.addEventListener("touchend", (e) => {
      if (touchStartX == null) return;
      const dx = e.changedTouches[0].clientX - touchStartX;
      // open with swipe right from left edge
      if (!appRoot.classList.contains("sidebar-open")) {
        if (touchStartX < 24 && dx > 40) {
          openSidebar();
        }
      } else {
        // close with swipe left
        if (dx < -40) {
          closeSidebar();
        }
      }
      touchStartX = null;
    });

    window.addEventListener("popstate", (event) => {
      const view = event.state && event.state.view ? event.state.view : "home";
      showView(view, false);
    });

    // Initial view from hash
    window.addEventListener("DOMContentLoaded", () => {
      ensureAtLeastOneList();
      const hash = window.location.hash.replace("#", "");
      if (hash && sections[hash]) {
        showView(hash, true);
      } else {
        showView("home", true);
      }
      renderAll();
    });

    // Quick add button = open todo view & focus
    quickAddBtn.addEventListener("click", () => {
      showView("todo", true);
      setTimeout(() => {
        document.getElementById("todo-text").focus();
      }, 150);
    });

    // =============================
    // Helpers
    // =============================
    function todayISO() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function isOverdue(task) {
      if (!task.dueDate) return false;
      if (task.status === "done") return false;
      const today = todayISO();
      return task.dueDate < today;
    }

    // =============================
    // To-Do Lists & Tasks
    // =============================
    const todoListEl = document.getElementById("todo-list");
    const todoForm = document.getElementById("todo-form");
    const todoTextInput = document.getElementById("todo-text");
    const todoPriorityInput = document.getElementById("todo-priority");
    const todoDueInput = document.getElementById("todo-due");

    const todoListsContainer = document.getElementById("todo-lists-container");
    const todoAddListBtn = document.getElementById("todo-add-list");

    let todoFilters = {
      status: "all",
      priority: "all",
      sort: "smart",
      text: "",
    };

    const filterToggleBtn = document.getElementById("todo-filter-toggle");
    const filterPanel = document.getElementById("todo-filter-panel");
    const filterStatusEl = document.getElementById("todo-filter-status");
    const filterPriorityEl = document.getElementById("todo-filter-priority");
    const filterSortEl = document.getElementById("todo-filter-sort");
    const filterTextEl = document.getElementById("todo-filter-text");
    const filterClearBtn = document.getElementById("todo-filter-clear");
    const filterApplyBtn = document.getElementById("todo-filter-apply");

    filterToggleBtn.addEventListener("click", () => {
      filterPanel.classList.toggle("hidden");
    });

    filterClearBtn.addEventListener("click", () => {
      todoFilters = {
        status: "all",
        priority: "all",
        sort: "smart",
        text: "",
      };
      filterStatusEl.value = "all";
      filterPriorityEl.value = "all";
      filterSortEl.value = "smart";
      filterTextEl.value = "";
      renderTasks();
    });

    filterApplyBtn.addEventListener("click", () => {
      todoFilters = {
        status: filterStatusEl.value,
        priority: filterPriorityEl.value,
        sort: filterSortEl.value,
        text: filterTextEl.value.trim().toLowerCase(),
      };
      renderTasks();
    });

    todoForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = todoTextInput.value.trim();
      if (!text) return;
      const list = getActiveTaskList();
      const task = {
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
        text,
        priority: todoPriorityInput.value,
        dueDate: todoDueInput.value || "",
        status: "todo", // todo | half | done
      };
      list.tasks.push(task);
      saveState();
      todoForm.reset();
      renderTasks();
    });

    todoAddListBtn.addEventListener("click", () => {
      const name = prompt("New list name:", "New list");
      if (!name) return;
      const trimmed = name.trim();
      if (!trimmed) return;
      const id = crypto.randomUUID ? crypto.randomUUID() : Date.now().toString();
      state.tasksLists.push({
        id,
        name: trimmed,
        tasks: [],
      });
      state.activeTaskListId = id;
      saveState();
      renderTodoListsUI();
      renderTasks();
    });

    function renderTodoListsUI() {
      ensureAtLeastOneList();
      todoListsContainer.innerHTML = "";
      state.tasksLists.forEach((lst) => {
        const span = document.createElement("button");
        span.type = "button";
        span.className =
          "todo-list-chip" +
          (lst.id === state.activeTaskListId ? " active" : "");
        const dot = document.createElement("span");
        dot.className = "dot";
        span.appendChild(dot);
        const name = document.createElement("span");
        name.textContent = lst.name;
        span.appendChild(name);
        span.addEventListener("click", () => {
          state.activeTaskListId = lst.id;
          saveState();
          renderTodoListsUI();
          renderTasks();
        });
        span.addEventListener("contextmenu", (e) => {
          e.preventDefault();
          const action = prompt(
            `Edit list:\n\n${lst.name}\n\nType a new name, or leave empty to delete this list (tasks will be lost).`,
            lst.name
          );
          if (action === null) return;
          const trimmed = action.trim();
          if (!trimmed) {
            if (
              state.tasksLists.length === 1 ||
              !confirm(
                "Delete this list and all its tasks? This cannot be undone."
              )
            ) {
              return;
            }
            state.tasksLists = state.tasksLists.filter(
              (l) => l.id !== lst.id
            );
            if (state.tasksLists.length) {
              state.activeTaskListId = state.tasksLists[0].id;
            } else {
              state.activeTaskListId = null;
            }
          } else {
            lst.name = trimmed;
          }
          saveState();
          renderTodoListsUI();
          renderTasks();
        });
        todoListsContainer.appendChild(span);
      });
    }

    function updateTaskStatus(id, status) {
      const list = getActiveTaskList();
      const t = list.tasks.find((t) => t.id === id);
      if (!t) return;
      t.status = status;
      saveState();
      renderTasks();
    }

    function deleteTask(id) {
      const list = getActiveTaskList();
      const t = list.tasks.find((x) => x.id === id);
      if (!t) return;
      const ok = confirm(`Delete this task?\n\n${t.text}`);
      if (!ok) return;
      list.tasks = list.tasks.filter((t) => t.id !== id);
      saveState();
      renderTasks();
    }

    function editTask(id) {
      const list = getActiveTaskList();
      const t = list.tasks.find((x) => x.id === id);
      if (!t) return;
      const newText = prompt("Edit task text:", t.text);
      if (newText === null) return;
      const trimmed = newText.trim();
      if (!trimmed) return;
      t.text = trimmed;
      saveState();
      renderTasks();
    }

    function sortedAndFilteredTasks() {
      const list = getActiveTaskList();
      let tasks = [...list.tasks];

      // Filter
      if (todoFilters.status !== "all") {
        tasks = tasks.filter((t) => t.status === todoFilters.status);
      }
      if (todoFilters.priority !== "all") {
        tasks = tasks.filter((t) => t.priority === todoFilters.priority);
      }
      if (todoFilters.text) {
        tasks = tasks.filter((t) =>
          t.text.toLowerCase().includes(todoFilters.text)
        );
      }

      // Sort
      const today = todayISO();
      tasks.sort((a, b) => {
        if (todoFilters.sort === "dueAsc" || todoFilters.sort === "dueDesc") {
          const ad = a.dueDate || "9999-12-31";
          const bd = b.dueDate || "9999-12-31";
          if (ad < bd) return todoFilters.sort === "dueAsc" ? -1 : 1;
          if (ad > bd) return todoFilters.sort === "dueAsc" ? 1 : -1;
          return 0;
        }

        // smart: priority, overdue, due-date, status
        const prioRank = { high: 0, medium: 1, low: 2 };
        const aPr = prioRank[a.priority] ?? 3;
        const bPr = prioRank[b.priority] ?? 3;
        if (aPr !== bPr) return aPr - bPr;

        const aOver = isOverdue(a) ? 0 : 1;
        const bOver = isOverdue(b) ? 0 : 1;
        if (aOver !== bOver) return aOver - bOver;

        const ad = a.dueDate || "9999-12-31";
        const bd = b.dueDate || "9999-12-31";
        if (ad < bd) return -1;
        if (ad > bd) return 1;

        const statusRank = { todo: 0, half: 1, done: 2 };
        const aSt = statusRank[a.status] ?? 3;
        const bSt = statusRank[b.status] ?? 3;
        return aSt - bSt;
      });

      return tasks;
    }

    function renderTasks() {
      renderTodoListsUI();
      todoListEl.innerHTML = "";
      const tasks = sortedAndFilteredTasks();
      if (!tasks.length) {
        const li = document.createElement("li");
        li.className = "card-subtitle";
        li.textContent = "No tasks in this list yet. Add your first one above.";
        todoListEl.appendChild(li);
        refreshHomeDashboard();
        return;
      }

      tasks.forEach((task) => {
        const li = document.createElement("li");
        li.className = "list-item";

        const main = document.createElement("div");
        main.className = "list-item-main";

        const title = document.createElement("div");
        title.className = "list-item-title";
        title.textContent = task.text;
        main.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "list-item-meta";

        const prChip = document.createElement("span");
        prChip.className = "chip " + (task.priority === "high" ? "high" : "");
        prChip.textContent =
          "Priority: " +
          task.priority.charAt(0).toUpperCase() +
          task.priority.slice(1);
        meta.appendChild(prChip);

        if (task.dueDate) {
          const dueChip = document.createElement("span");
          dueChip.className = "chip" + (isOverdue(task) ? " overdue" : "");
          dueChip.textContent =
            "Due: " + task.dueDate + (isOverdue(task) ? " (overdue)" : "");
          meta.appendChild(dueChip);
        }

        const stChip = document.createElement("span");
        stChip.className =
          "chip " +
          (task.status === "done"
            ? "done"
            : task.status === "half"
            ? "half"
            : "");
        stChip.textContent =
          task.status === "done"
            ? "Done"
            : task.status === "half"
            ? "Half done"
            : "Not done";
        meta.appendChild(stChip);

        main.appendChild(meta);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const btnTodo = document.createElement("button");
        btnTodo.className = "btn-ghost";
        btnTodo.textContent = "Not done";
        btnTodo.onclick = () => updateTaskStatus(task.id, "todo");

        const btnHalf = document.createElement("button");
        btnHalf.className = "btn-ghost";
        btnHalf.textContent = "Half";
        btnHalf.onclick = () => updateTaskStatus(task.id, "half");

        const btnDone = document.createElement("button");
        btnDone.className = "btn-ghost";
        btnDone.textContent = "Done";
        btnDone.onclick = () => updateTaskStatus(task.id, "done");

        const btnEdit = document.createElement("button");
        btnEdit.className = "btn-ghost";
        btnEdit.textContent = "Edit";
        btnEdit.onclick = () => editTask(task.id);

        const btnDel = document.createElement("button");
        btnDel.className = "btn-ghost danger";
        btnDel.textContent = "Delete";
        btnDel.onclick = () => deleteTask(task.id);

        actions.appendChild(btnTodo);
        actions.appendChild(btnHalf);
        actions.appendChild(btnDone);
        actions.appendChild(btnEdit);
        actions.appendChild(btnDel);

        li.appendChild(main);
        li.appendChild(actions);
        todoListEl.appendChild(li);
      });

      refreshHomeDashboard();
    }

    // =============================
    // Shopping with drag & drop
    // =============================
    const shoppingForm = document.getElementById("shopping-form");
    const shoppingInput = document.getElementById("shopping-text");
    const shoppingListEl = document.getElementById("shopping-list");

    shoppingForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = shoppingInput.value.trim();
      if (!text) return;
      state.shoppingItems.push({
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
        text,
        checked: false,
      });
      saveState();
      shoppingForm.reset();
      renderShopping();
    });

    function toggleShoppingItem(id) {
      const item = state.shoppingItems.find((i) => i.id === id);
      if (!item) return;
      item.checked = !item.checked;
      saveState();
      renderShopping();
    }

    function deleteShoppingItem(id) {
      const item = state.shoppingItems.find((i) => i.id === id);
      if (!item) return;
      const ok = confirm(`Delete this item?\n\n${item.text}`);
      if (!ok) return;
      state.shoppingItems = state.shoppingItems.filter((i) => i.id !== id);
      saveState();
      renderShopping();
    }

    function reorderShoppingItems(draggedId, targetId) {
      if (draggedId === targetId) return;
      const items = state.shoppingItems;
      const fromIndex = items.findIndex((i) => i.id === draggedId);
      const toIndex = items.findIndex((i) => i.id === targetId);
      if (fromIndex === -1 || toIndex === -1) return;
      const [moved] = items.splice(fromIndex, 1);
      items.splice(toIndex, 0, moved);
      saveState();
      renderShopping();
    }

    function renderShopping() {
      shoppingListEl.innerHTML = "";
      if (!state.shoppingItems.length) {
        const li = document.createElement("li");
        li.className = "card-subtitle";
        li.textContent = "Empty list. Add items above.";
        shoppingListEl.appendChild(li);
        refreshHomeDashboard();
        return;
      }

      state.shoppingItems.forEach((item) => {
        const li = document.createElement("li");
        li.className = "list-item";
        li.draggable = true;

        li.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", item.id);
        });

        li.addEventListener("dragover", (e) => {
          e.preventDefault();
        });

        li.addEventListener("drop", (e) => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          reorderShoppingItems(draggedId, item.id);
        });

        const main = document.createElement("div");
        main.className = "list-item-main";

        const title = document.createElement("div");
        title.className = "list-item-title";
        title.textContent = item.text;
        main.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "list-item-meta";
        const status = document.createElement("span");
        status.className = "chip " + (item.checked ? "done" : "");
        status.textContent = item.checked ? "Got it" : "Pending";
        meta.appendChild(status);
        main.appendChild(meta);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const btnToggle = document.createElement("button");
        btnToggle.className = "btn-ghost";
        btnToggle.textContent = item.checked ? "Uncheck" : "Check";
        btnToggle.onclick = () => toggleShoppingItem(item.id);

        const btnDel = document.createElement("button");
        btnDel.className = "btn-ghost danger";
        btnDel.textContent = "Delete";
        btnDel.onclick = () => deleteShoppingItem(item.id);

        actions.appendChild(btnToggle);
        actions.appendChild(btnDel);

        li.appendChild(main);
        li.appendChild(actions);
        shoppingListEl.appendChild(li);
      });

      refreshHomeDashboard();
    }

    // =============================
    // Workouts
    // =============================
    const workoutForm = document.getElementById("workout-form");
    const workoutInput = document.getElementById("workout-text");
    const workoutListEl = document.getElementById("workout-list");

    workoutForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = workoutInput.value.trim();
      if (!text) return;
      state.workouts.push({
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
        text,
        date: todayISO(),
      });
      saveState();
      workoutForm.reset();
      renderWorkouts();
    });

    function deleteWorkout(id) {
      const w = state.workouts.find((x) => x.id === id);
      if (!w) return;
      const ok = confirm(`Delete this workout log?\n\n${w.text}`);
      if (!ok) return;
      state.workouts = state.workouts.filter((w) => w.id !== id);
      saveState();
      renderWorkouts();
    }

    function renderWorkouts() {
      workoutListEl.innerHTML = "";
      if (!state.workouts.length) {
        const li = document.createElement("li");
        li.className = "card-subtitle";
        li.textContent = "No workouts logged yet.";
        workoutListEl.appendChild(li);
        refreshHomeDashboard();
        return;
      }

      const sorted = [...state.workouts].sort((a, b) =>
        a.date < b.date ? 1 : -1
      );
      sorted.forEach((w) => {
        const li = document.createElement("li");
        li.className = "list-item";

        const main = document.createElement("div");
        main.className = "list-item-main";

        const title = document.createElement("div");
        title.className = "list-item-title";
        title.textContent = w.text;
        main.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "list-item-meta";
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = "Date: " + (w.date || "?");
        meta.appendChild(chip);
        main.appendChild(meta);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const btnDel = document.createElement("button");
        btnDel.className = "btn-ghost danger";
        btnDel.textContent = "Delete";
        btnDel.onclick = () => deleteWorkout(w.id);

        actions.appendChild(btnDel);

        li.appendChild(main);
        li.appendChild(actions);
        workoutListEl.appendChild(li);
      });

      refreshHomeDashboard();
    }

    // =============================
    // Finance
    // =============================
    const financeForm = document.getElementById("finance-form");
    const financeAmount = document.getElementById("finance-amount");
    const financeType = document.getElementById("finance-type");
    const financeCategory = document.getElementById("finance-category");
    const financeDate = document.getElementById("finance-date");
    const financeNote = document.getElementById("finance-note");
    const financeListEl = document.getElementById("finance-list");

    financeForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const amount = parseFloat(financeAmount.value);
      if (isNaN(amount) || amount <= 0) return;
      const type = financeType.value;
      const cat = financeCategory.value.trim() || "Other";
      const date = financeDate.value || todayISO();
      const note = financeNote.value.trim();

      state.finances.push({
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
        amount,
        type,
        category: cat,
        date,
        note,
      });

      saveState();
      financeForm.reset();
      renderFinances();
    });

    function deleteFinance(id) {
      const f = state.finances.find((x) => x.id === id);
      if (!f) return;
      const sign = f.type === "expense" ? "-" : "+";
      const ok = confirm(
        `Delete this entry?\n\n${sign}${f.amount.toFixed(2)} ¬∑ ${
          f.category
        } ¬∑ ${f.date}`
      );
      if (!ok) return;
      state.finances = state.finances.filter((f) => f.id !== id);
      saveState();
      renderFinances();
    }

    function renderFinances() {
      financeListEl.innerHTML = "";
      if (!state.finances.length) {
        const li = document.createElement("li");
        li.className = "card-subtitle";
        li.textContent = "No entries yet.";
        financeListEl.appendChild(li);
        refreshHomeDashboard();
        return;
      }

      const sorted = [...state.finances].sort((a, b) =>
        a.date < b.date ? 1 : -1
      );
      sorted.forEach((f) => {
        const li = document.createElement("li");
        li.className = "list-item";

        const main = document.createElement("div");
        main.className = "list-item-main";

        const title = document.createElement("div");
        title.className = "list-item-title";
        const sign = f.type === "expense" ? "-" : "+";
        title.textContent = `${sign}${f.amount.toFixed(2)} ¬∑ ${f.category}`;
        main.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "list-item-meta";
        const dateChip = document.createElement("span");
        dateChip.className = "chip";
        dateChip.textContent = "Date: " + f.date;
        meta.appendChild(dateChip);

        const typeChip = document.createElement("span");
        typeChip.className =
          "chip " + (f.type === "expense" ? "overdue" : "done");
        typeChip.textContent =
          f.type === "expense" ? "Expense" : "Income";
        meta.appendChild(typeChip);

        if (f.note) {
          const noteChip = document.createElement("span");
          noteChip.className = "chip";
          noteChip.textContent = f.note;
          meta.appendChild(noteChip);
        }

        main.appendChild(meta);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const btnDel = document.createElement("button");
        btnDel.className = "btn-ghost danger";
        btnDel.textContent = "Delete";
        btnDel.onclick = () => deleteFinance(f.id);

        actions.appendChild(btnDel);

        li.appendChild(main);
        li.appendChild(actions);
        financeListEl.appendChild(li);
      });

      refreshHomeDashboard();
    }

    // =============================
    // Home Dashboard
    // =============================
    const todayTasksListEl = document.getElementById("today-tasks-list");
    const homeTodoCountEl = document.getElementById("home-todo-count");
    const homeFinanceCountEl = document.getElementById("home-finance-count");
    const homeWorkoutCountEl = document.getElementById("home-workout-count");
    const homeShoppingCountEl =
      document.getElementById("home-shopping-count");

    const quickTaskForm = document.getElementById("quick-task-form");
    const quickTaskInput = document.getElementById("quick-task-text");

    quickTaskForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = quickTaskInput.value.trim();
      if (!text) return;
      ensureAtLeastOneList();
      const list = getActiveTaskList();
      const task = {
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
        text,
        priority: "medium",
        dueDate: todayISO(),
        status: "todo",
      };
      list.tasks.push(task);
      saveState();
      quickTaskForm.reset();
      renderTasks();
      showView("home", true);
    });

    function refreshHomeDashboard() {
      const today = todayISO();

      // All tasks due today or overdue across all lists
      const allTasks = getAllTasksAcrossLists();
      const todayTasks = allTasks.filter((t) => {
        if (!t.dueDate) return false;
        if (t.status === "done") return false;
        return t.dueDate <= today;
      });

      homeTodoCountEl.textContent = todayTasks.length + " today";
      todayTasksListEl.innerHTML = "";

      if (!todayTasks.length) {
        const li = document.createElement("li");
        li.className = "card-subtitle";
        li.textContent = "No tasks due today. üéâ";
        todayTasksListEl.appendChild(li);
      } else {
        todayTasks
          .slice(0, 5)
          .sort((a, b) => (a.dueDate < b.dueDate ? -1 : 1))
          .forEach((t) => {
            const li = document.createElement("li");
            li.className = "today-tasks-item";
            const left = document.createElement("div");
            left.className = "today-tasks-title";
            left.textContent = t.text;
            const right = document.createElement("div");
            right.className = "today-tasks-meta";
            right.textContent =
              (t.dueDate === today ? "Today" : t.dueDate) +
              " ¬∑ " +
              (t.priority === "high"
                ? "High"
                : t.priority === "low"
                ? "Low"
                : "Medium");
            li.appendChild(left);
            li.appendChild(right);
            todayTasksListEl.appendChild(li);
          });
      }

      // Shopping count: pending items
      const pendingShopping = state.shoppingItems.filter(
        (i) => !i.checked
      ).length;
      homeShoppingCountEl.textContent = pendingShopping + " pending";

      // Finance: entries this month
      const now = new Date();
      const m = String(now.getMonth() + 1).padStart(2, "0");
      const y = now.getFullYear();
      const prefix = `${y}-${m}-`;
      const thisMonthFinances = state.finances.filter(
        (f) => f.date && f.date.startsWith(prefix)
      );
      homeFinanceCountEl.textContent =
        thisMonthFinances.length + " entries";

      // Workouts: last workout date
      if (!state.workouts.length) {
        homeWorkoutCountEl.textContent = "None yet";
      } else {
        const last = [...state.workouts].sort((a, b) =>
          a.date < b.date ? 1 : -1
        )[0];
        homeWorkoutCountEl.textContent = last.date || "Recent";
      }
    }

    // =============================
    // Initial render
    // =============================
    function renderAll() {
      renderTasks();
      renderShopping();
      renderWorkouts();
      renderFinances();
      refreshHomeDashboard();
    }
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("./service-worker.js")
          .catch(function (err) {
            console.log("Service worker registration failed:", err);
          });
      });
    }
  </script>
</body>
</html>
